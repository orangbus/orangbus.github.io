<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>laravel学习笔记 | OrangBus</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="shortcut icon" href="/orangbus.ico" type="image/jpg">
    <script><script>
			var _hmt = _hmt || [];
			(function() {
			  var hm = document.createElement("script");
			  hm.src = "https://hm.baidu.com/hm.js?75a195c58b50e00357efe9066f49f8b0";
			  var s = document.getElementsByTagName("script")[0]; 
			  s.parentNode.insertBefore(hm, s);
			})();
			</script>
			</script>
    <meta name="description" content="分享生活高效技能,保持勇敢，坚持有趣，生命不息，折腾不止！">
    <meta property="article:modified_time" content="2023-03-20T03:31:12.000Z">
    <meta property="og:site_name" content="OrangBus">
    <meta property="og:title" content="laravel学习笔记">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/Laravel/LaraCode.html">
    <meta name="twitter:title" content="laravel学习笔记">
    <meta name="twitter:url" content="/Laravel/LaraCode.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="keywords" content="html,css,jquery,thinkphp,laravel,docker,linux,manjaro">
    <meta name="auther" content="OrangBus">
    <link rel="preload" href="/assets/css/0.styles.8405cd42.css" as="style"><link rel="preload" href="/assets/js/app.ea451ed9.js" as="script"><link rel="preload" href="/assets/js/3.6c5e3284.js" as="script"><link rel="preload" href="/assets/js/87.92ca344e.js" as="script"><link rel="prefetch" href="/assets/js/10.36e3baf2.js"><link rel="prefetch" href="/assets/js/100.c62c728f.js"><link rel="prefetch" href="/assets/js/101.ae1ee2be.js"><link rel="prefetch" href="/assets/js/102.9cbe442f.js"><link rel="prefetch" href="/assets/js/103.865c8704.js"><link rel="prefetch" href="/assets/js/104.f2a95690.js"><link rel="prefetch" href="/assets/js/105.d1b44fe7.js"><link rel="prefetch" href="/assets/js/106.23035218.js"><link rel="prefetch" href="/assets/js/107.278448f9.js"><link rel="prefetch" href="/assets/js/108.a0ae7f91.js"><link rel="prefetch" href="/assets/js/109.cf958a7f.js"><link rel="prefetch" href="/assets/js/11.6e113d65.js"><link rel="prefetch" href="/assets/js/110.4abe4a81.js"><link rel="prefetch" href="/assets/js/111.d14fcb85.js"><link rel="prefetch" href="/assets/js/112.548bcab9.js"><link rel="prefetch" href="/assets/js/113.175d2143.js"><link rel="prefetch" href="/assets/js/114.ea5534cc.js"><link rel="prefetch" href="/assets/js/115.8fde4729.js"><link rel="prefetch" href="/assets/js/116.892c24fc.js"><link rel="prefetch" href="/assets/js/117.b6407011.js"><link rel="prefetch" href="/assets/js/118.e6b176a0.js"><link rel="prefetch" href="/assets/js/119.f5f2daa6.js"><link rel="prefetch" href="/assets/js/12.4a156561.js"><link rel="prefetch" href="/assets/js/120.9665106a.js"><link rel="prefetch" href="/assets/js/121.9796f87f.js"><link rel="prefetch" href="/assets/js/122.99ed8d50.js"><link rel="prefetch" href="/assets/js/123.178c8139.js"><link rel="prefetch" href="/assets/js/124.c5da5022.js"><link rel="prefetch" href="/assets/js/125.a471379a.js"><link rel="prefetch" href="/assets/js/126.b023af6d.js"><link rel="prefetch" href="/assets/js/127.1881be96.js"><link rel="prefetch" href="/assets/js/128.dc0cb30c.js"><link rel="prefetch" href="/assets/js/129.49a46e09.js"><link rel="prefetch" href="/assets/js/13.ffe35305.js"><link rel="prefetch" href="/assets/js/130.eb431321.js"><link rel="prefetch" href="/assets/js/131.d2e4e355.js"><link rel="prefetch" href="/assets/js/132.e06be357.js"><link rel="prefetch" href="/assets/js/133.a301aae1.js"><link rel="prefetch" href="/assets/js/134.d4f8d457.js"><link rel="prefetch" href="/assets/js/135.44b350c1.js"><link rel="prefetch" href="/assets/js/136.8c7e2989.js"><link rel="prefetch" href="/assets/js/137.1f1c660c.js"><link rel="prefetch" href="/assets/js/138.8cb25d26.js"><link rel="prefetch" href="/assets/js/139.f522c59c.js"><link rel="prefetch" href="/assets/js/14.d36de9de.js"><link rel="prefetch" href="/assets/js/140.017da4d3.js"><link rel="prefetch" href="/assets/js/141.e9e1855f.js"><link rel="prefetch" href="/assets/js/142.c45accfd.js"><link rel="prefetch" href="/assets/js/143.9ada7c7e.js"><link rel="prefetch" href="/assets/js/144.08072e47.js"><link rel="prefetch" href="/assets/js/145.c5e578ae.js"><link rel="prefetch" href="/assets/js/146.f7dd1b72.js"><link rel="prefetch" href="/assets/js/147.4b80c07c.js"><link rel="prefetch" href="/assets/js/148.f40aeae9.js"><link rel="prefetch" href="/assets/js/149.7643921b.js"><link rel="prefetch" href="/assets/js/15.62ba96c3.js"><link rel="prefetch" href="/assets/js/150.a9088b08.js"><link rel="prefetch" href="/assets/js/151.855b11a5.js"><link rel="prefetch" href="/assets/js/152.d513c64a.js"><link rel="prefetch" href="/assets/js/153.612f9549.js"><link rel="prefetch" href="/assets/js/154.54322c84.js"><link rel="prefetch" href="/assets/js/155.c612edbd.js"><link rel="prefetch" href="/assets/js/156.c0e99fa3.js"><link rel="prefetch" href="/assets/js/157.66027807.js"><link rel="prefetch" href="/assets/js/158.3b7ef7c0.js"><link rel="prefetch" href="/assets/js/159.2129b9f4.js"><link rel="prefetch" href="/assets/js/16.b3d1377d.js"><link rel="prefetch" href="/assets/js/160.81804cfd.js"><link rel="prefetch" href="/assets/js/161.b3f6a037.js"><link rel="prefetch" href="/assets/js/162.b50f19cf.js"><link rel="prefetch" href="/assets/js/17.5897ff24.js"><link rel="prefetch" href="/assets/js/18.bdf46b90.js"><link rel="prefetch" href="/assets/js/19.7abc88da.js"><link rel="prefetch" href="/assets/js/2.86f796bf.js"><link rel="prefetch" href="/assets/js/20.30b9f95b.js"><link rel="prefetch" href="/assets/js/21.86a8aad5.js"><link rel="prefetch" href="/assets/js/22.b4f5a61f.js"><link rel="prefetch" href="/assets/js/23.e5b7871f.js"><link rel="prefetch" href="/assets/js/24.861737df.js"><link rel="prefetch" href="/assets/js/25.461bdc07.js"><link rel="prefetch" href="/assets/js/26.1d1a614d.js"><link rel="prefetch" href="/assets/js/27.475c6b8a.js"><link rel="prefetch" href="/assets/js/28.ab8849ef.js"><link rel="prefetch" href="/assets/js/29.d1b58c6c.js"><link rel="prefetch" href="/assets/js/30.d2c71ed7.js"><link rel="prefetch" href="/assets/js/31.805bcd3c.js"><link rel="prefetch" href="/assets/js/32.4226174c.js"><link rel="prefetch" href="/assets/js/33.37be6a15.js"><link rel="prefetch" href="/assets/js/34.466ebcf5.js"><link rel="prefetch" href="/assets/js/35.cb9c230e.js"><link rel="prefetch" href="/assets/js/36.771f66ea.js"><link rel="prefetch" href="/assets/js/37.e443a86a.js"><link rel="prefetch" href="/assets/js/38.2af0dbd3.js"><link rel="prefetch" href="/assets/js/39.0c54ac88.js"><link rel="prefetch" href="/assets/js/4.e55e7d6c.js"><link rel="prefetch" href="/assets/js/40.e349bc43.js"><link rel="prefetch" href="/assets/js/41.2c82d80b.js"><link rel="prefetch" href="/assets/js/42.09865f77.js"><link rel="prefetch" href="/assets/js/43.d1a1945d.js"><link rel="prefetch" href="/assets/js/44.44056441.js"><link rel="prefetch" href="/assets/js/45.23f4bcb1.js"><link rel="prefetch" href="/assets/js/46.523377ed.js"><link rel="prefetch" href="/assets/js/47.39c2ac9b.js"><link rel="prefetch" href="/assets/js/48.446932bc.js"><link rel="prefetch" href="/assets/js/49.47b2cdc5.js"><link rel="prefetch" href="/assets/js/5.73b6d780.js"><link rel="prefetch" href="/assets/js/50.9cb1d170.js"><link rel="prefetch" href="/assets/js/51.4b7a3e4f.js"><link rel="prefetch" href="/assets/js/52.2310dbde.js"><link rel="prefetch" href="/assets/js/53.70514c3c.js"><link rel="prefetch" href="/assets/js/54.316cdc49.js"><link rel="prefetch" href="/assets/js/55.db4816c8.js"><link rel="prefetch" href="/assets/js/56.7241b38e.js"><link rel="prefetch" href="/assets/js/57.f947ebe6.js"><link rel="prefetch" href="/assets/js/58.3e277572.js"><link rel="prefetch" href="/assets/js/59.3476f0cf.js"><link rel="prefetch" href="/assets/js/6.49bd8bb9.js"><link rel="prefetch" href="/assets/js/60.6589e146.js"><link rel="prefetch" href="/assets/js/61.22492af7.js"><link rel="prefetch" href="/assets/js/62.1fc6799a.js"><link rel="prefetch" href="/assets/js/63.e3f9a2ca.js"><link rel="prefetch" href="/assets/js/64.1d1d0763.js"><link rel="prefetch" href="/assets/js/65.470a3295.js"><link rel="prefetch" href="/assets/js/66.4c1b39ef.js"><link rel="prefetch" href="/assets/js/67.882578f3.js"><link rel="prefetch" href="/assets/js/68.e37c1840.js"><link rel="prefetch" href="/assets/js/69.74668543.js"><link rel="prefetch" href="/assets/js/7.a146e8b1.js"><link rel="prefetch" href="/assets/js/70.3f357a01.js"><link rel="prefetch" href="/assets/js/71.1639510a.js"><link rel="prefetch" href="/assets/js/72.235a2ff5.js"><link rel="prefetch" href="/assets/js/73.b6403efb.js"><link rel="prefetch" href="/assets/js/74.8028105e.js"><link rel="prefetch" href="/assets/js/75.8317d79b.js"><link rel="prefetch" href="/assets/js/76.2bcfe34f.js"><link rel="prefetch" href="/assets/js/77.8a0fa722.js"><link rel="prefetch" href="/assets/js/78.dfb11693.js"><link rel="prefetch" href="/assets/js/79.4c573711.js"><link rel="prefetch" href="/assets/js/8.361bf975.js"><link rel="prefetch" href="/assets/js/80.ae55b008.js"><link rel="prefetch" href="/assets/js/81.fcf62caf.js"><link rel="prefetch" href="/assets/js/82.c75bff49.js"><link rel="prefetch" href="/assets/js/83.bc4cf04e.js"><link rel="prefetch" href="/assets/js/84.6e7b5e11.js"><link rel="prefetch" href="/assets/js/85.6b48a9e4.js"><link rel="prefetch" href="/assets/js/86.7a637af9.js"><link rel="prefetch" href="/assets/js/88.31ecec95.js"><link rel="prefetch" href="/assets/js/89.c5bde116.js"><link rel="prefetch" href="/assets/js/9.17b1e357.js"><link rel="prefetch" href="/assets/js/90.a41fd3df.js"><link rel="prefetch" href="/assets/js/91.46a2cc9e.js"><link rel="prefetch" href="/assets/js/92.761117f0.js"><link rel="prefetch" href="/assets/js/93.40eecc87.js"><link rel="prefetch" href="/assets/js/94.7de38523.js"><link rel="prefetch" href="/assets/js/95.372f7ca9.js"><link rel="prefetch" href="/assets/js/96.850a8aca.js"><link rel="prefetch" href="/assets/js/97.d3f7516f.js"><link rel="prefetch" href="/assets/js/98.b00ac6e4.js"><link rel="prefetch" href="/assets/js/99.aa632710.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8405cd42.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/orangbus.png" alt="OrangBus" class="logo"> <span class="site-name can-hide">OrangBus</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Window" class="dropdown-title"><span class="title">Window</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Window/" class="nav-link">
  高效工具
</a></li><li class="dropdown-item"><!----> <a href="https://pc.qq.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  软件中心
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4>
          开发工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.jetbrains.com/toolbox-app/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetbrains
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://laragon.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  laragon
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.php.net/downloads.php" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php版本安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://pecl.php.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php扩展
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Linux/Config.html" class="nav-link">
  配置文件
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Tool.html" class="nav-link">
  生产工具
</a></li><li class="dropdown-item"><!----> <a href="/Linux/App.html" class="nav-link">
  应用
</a></li><li class="dropdown-item"><!----> <a href="/Linux/SedAwk.html" class="nav-link">
  SedAwk
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Question.html" class="nav-link">
  问题解答
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/orangbus/tool" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Manjaro入门到生产
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4>
          开发环境
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://laradock.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Laradock
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  宝塔Linux面板
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://laragon.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  laragon-window
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>
          Linux发行版
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.centos.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  centos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.deepin.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Deepin
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cn.ubuntu.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Ubuntu
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://manjaro.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Manjaro
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>
          Laradock实战
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://yeasy.gitbooks.io/docker_practice/install/mirror.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker入门到实战
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://laradock.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Laradock官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker在线学习调试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://labs.play-with-k8s.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  play with Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Code" class="dropdown-title"><span class="title">Code</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Html
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/RequireJs.html" class="nav-link">
  RequireJs
</a></li><li class="dropdown-subitem"><a href="/Code/Layui.html" class="nav-link">
  Layui笔记
</a></li><li class="dropdown-subitem"><a href="/Code/Javascript.html" class="nav-link">
  Javascript手册
</a></li><li class="dropdown-subitem"><a href="/Code/Css.html" class="nav-link">
  Css样式收藏
</a></li><li class="dropdown-subitem"><a href="/Code/Menu.html" class="nav-link">
  在线手册
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Code/VueNote.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><h4>
          Php
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/Php.html" class="nav-link">
  Php使用技巧
</a></li><li class="dropdown-subitem"><a href="/Code/Thinkphp.html" class="nav-link">
  ThinkPhp
</a></li><li class="dropdown-subitem"><a href="/Code/LaraCode.html" class="nav-link">
  LaraCode
</a></li></ul></li><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Python/Python.html" class="nav-link">
  Python入门
</a></li><li class="dropdown-subitem"><a href="/Python/Scrapy.html" class="nav-link">
  Scrapy
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/Docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="/Mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/Golang/" class="nav-link">
  Golang
</a></div><div class="nav-item"><a href="/MyNote/" class="nav-link">
  MyNote
</a></div><div class="nav-item"><a href="/WebNote/" class="nav-link">
  WebNote
</a></div><div class="nav-item"><a href="/OrangBus/" class="nav-link">
  OrangBus
</a></div> <a href="https://github.com/orangbus/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Window" class="dropdown-title"><span class="title">Window</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Window/" class="nav-link">
  高效工具
</a></li><li class="dropdown-item"><!----> <a href="https://pc.qq.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  软件中心
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4>
          开发工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.jetbrains.com/toolbox-app/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jetbrains
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://laragon.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  laragon
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.php.net/downloads.php" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php版本安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://pecl.php.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php扩展
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Linux/Config.html" class="nav-link">
  配置文件
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Tool.html" class="nav-link">
  生产工具
</a></li><li class="dropdown-item"><!----> <a href="/Linux/App.html" class="nav-link">
  应用
</a></li><li class="dropdown-item"><!----> <a href="/Linux/SedAwk.html" class="nav-link">
  SedAwk
</a></li><li class="dropdown-item"><!----> <a href="/Linux/Question.html" class="nav-link">
  问题解答
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/orangbus/tool" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Manjaro入门到生产
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4>
          开发环境
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://laradock.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Laradock
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.bt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  宝塔Linux面板
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://laragon.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  laragon-window
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>
          Linux发行版
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.centos.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  centos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.deepin.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Deepin
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cn.ubuntu.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Ubuntu
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://manjaro.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Manjaro
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>
          Laradock实战
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://yeasy.gitbooks.io/docker_practice/install/mirror.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker入门到实战
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="http://laradock.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Laradock官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker在线学习调试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://labs.play-with-k8s.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  play with Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Code" class="dropdown-title"><span class="title">Code</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Html
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/RequireJs.html" class="nav-link">
  RequireJs
</a></li><li class="dropdown-subitem"><a href="/Code/Layui.html" class="nav-link">
  Layui笔记
</a></li><li class="dropdown-subitem"><a href="/Code/Javascript.html" class="nav-link">
  Javascript手册
</a></li><li class="dropdown-subitem"><a href="/Code/Css.html" class="nav-link">
  Css样式收藏
</a></li><li class="dropdown-subitem"><a href="/Code/Menu.html" class="nav-link">
  在线手册
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Code/VueNote.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><h4>
          Php
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Code/Php.html" class="nav-link">
  Php使用技巧
</a></li><li class="dropdown-subitem"><a href="/Code/Thinkphp.html" class="nav-link">
  ThinkPhp
</a></li><li class="dropdown-subitem"><a href="/Code/LaraCode.html" class="nav-link">
  LaraCode
</a></li></ul></li><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Python/Python.html" class="nav-link">
  Python入门
</a></li><li class="dropdown-subitem"><a href="/Python/Scrapy.html" class="nav-link">
  Scrapy
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/Docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="/Mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/Golang/" class="nav-link">
  Golang
</a></div><div class="nav-item"><a href="/MyNote/" class="nav-link">
  MyNote
</a></div><div class="nav-item"><a href="/WebNote/" class="nav-link">
  WebNote
</a></div><div class="nav-item"><a href="/OrangBus/" class="nav-link">
  OrangBus
</a></div> <a href="https://github.com/orangbus/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>laravel学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Laravel/LaraCode.html#laravel环境部署常见缺少的php扩展" class="sidebar-link">laravel环境部署常见缺少的php扩展</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#安装前端脚手架" class="sidebar-link">安装前端脚手架</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#tailwindcss安装" class="sidebar-link">tailwindcss安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#创建您的配置文件" class="sidebar-link">创建您的配置文件</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#在-laravel-mix-中配置-tailwind" class="sidebar-link">在 Laravel Mix 中配置 Tailwind</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#在您的-css-中引入-tailwind" class="sidebar-link">在您的 CSS 中引入 Tailwind</a></li></ul></li><li><a href="/Laravel/LaraCode.html#npm-package" class="sidebar-link">npm package</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel-ide-helper" class="sidebar-link">Laravel IDE Helper</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel-引入中文语言包" class="sidebar-link">laravel 引入中文语言包</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#配置中国时间" class="sidebar-link">配置中国时间</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#时间转化" class="sidebar-link">时间转化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel周期" class="sidebar-link">laravel周期</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel查询技巧" class="sidebar-link">Laravel查询技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#wherein查询" class="sidebar-link">wherein查询</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#时间查询" class="sidebar-link">时间查询</a></li></ul></li><li><a href="/Laravel/LaraCode.html#表单验证" class="sidebar-link">表单验证</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#观察者" class="sidebar-link">观察者</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#事件监听" class="sidebar-link">事件监听</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#异常处理" class="sidebar-link">异常处理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel使用factory填充数据" class="sidebar-link">laravel使用factory填充数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#设置中文数据" class="sidebar-link">设置中文数据</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#创建迁移文件" class="sidebar-link">创建迁移文件</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#创建工厂数据" class="sidebar-link">创建工厂数据</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#填充数据" class="sidebar-link">填充数据</a></li></ul></li><li><a href="/Laravel/LaraCode.html#获取原始数据" class="sidebar-link">获取原始数据</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#时间搜索" class="sidebar-link">时间搜索</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#手动表单验证（api验证）" class="sidebar-link">手动表单验证（api验证）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#scope使用" class="sidebar-link">scope使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#动作授权" class="sidebar-link">动作授权</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#快速生成100w条用户数据" class="sidebar-link">快速生成100w条用户数据</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel中使用redis" class="sidebar-link">Laravel中使用redis</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel中使用mongodb" class="sidebar-link">Laravel中使用MongoDB</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel8广播-pusher" class="sidebar-link">laravel8广播+pusher</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#安装pusher驱动" class="sidebar-link">安装pusher驱动</a></li></ul></li><li><a href="/Laravel/LaraCode.html#laravel8广播-websocket" class="sidebar-link">laravel8广播+websocket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#安装laravel-和前端脚手架" class="sidebar-link">安装laravel 和前端脚手架</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#安装-laravel-websocket" class="sidebar-link">安装 laravel/websocket</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#安装-pusher" class="sidebar-link">安装 pusher</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#安装前端库" class="sidebar-link">安装前端库</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#创建事件" class="sidebar-link">创建事件</a></li></ul></li><li><a href="/Laravel/LaraCode.html#laravel8广播-redis" class="sidebar-link">laravel8广播-redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#安装redis广播库" class="sidebar-link">安装redis广播库</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#安装前端依赖" class="sidebar-link">安装前端依赖</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#开启广播" class="sidebar-link">开启广播</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#创建一个公有广播事件" class="sidebar-link">创建一个公有广播事件</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#私有广播事件" class="sidebar-link">私有广播事件</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#广播使用redis" class="sidebar-link">广播使用redis</a></li></ul></li><li><a href="/Laravel/LaraCode.html#广播使用注意事项" class="sidebar-link">广播使用注意事项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#前端没有接收到消息" class="sidebar-link">前端没有接收到消息</a></li></ul></li><li><a href="/Laravel/LaraCode.html#laravel广播-redis-laradock" class="sidebar-link">laravel广播+redis+laradock</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laradock-laravel-redis广播" class="sidebar-link">Laradock+Laravel+redis广播</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#注意事项" class="sidebar-link">注意事项</a></li></ul></li><li><a href="/Laravel/LaraCode.html#广播使用总结" class="sidebar-link">广播使用总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#_1、共有广播" class="sidebar-link">1、共有广播</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#_2、私有广播" class="sidebar-link">2、私有广播</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#_3、presence频道" class="sidebar-link">3、presence频道</a></li></ul></li><li><a href="/Laravel/LaraCode.html#广播遇到的文件" class="sidebar-link">广播遇到的文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#laravel中使用mongodb数据库" class="sidebar-link">laravel中使用mongodb数据库</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#meilisearch搜索" class="sidebar-link">MeiliSearch搜索</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#elasticsearch-搜索" class="sidebar-link">elasticsearch 搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#laravel文件上传案例" class="sidebar-link">laravel文件上传案例</a></li><li class="sidebar-sub-header"><a href="/Laravel/LaraCode.html#扩展包推荐" class="sidebar-link">扩展包推荐</a></li></ul></li><li><a href="/Laravel/LaraCode.html#路由" class="sidebar-link">路由</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#增删改查" class="sidebar-link">增删改查</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#模型方法" class="sidebar-link">模型方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#返回" class="sidebar-link">返回</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#远程一对多" class="sidebar-link">远程一对多</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#统计七天内注册用户数量按天进行分组" class="sidebar-link">统计七天内注册用户数量按天进行分组</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Laravel/LaraCode.html#统计一年内注册用户数量按月份进行分组" class="sidebar-link">统计一年内注册用户数量按月份进行分组</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="laravel环境部署常见缺少的php扩展"><a href="#laravel环境部署常见缺少的php扩展" class="header-anchor">#</a> laravel环境部署常见缺少的php扩展</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-curl
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-gd
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-xml
</code></pre></div><h2 id="安装前端脚手架"><a href="#安装前端脚手架" class="header-anchor">#</a> 安装前端脚手架</h2> <div class="language- extra-class"><pre class="language-text"><code>omposer create-project --prefer-dist laravel/laravel

laravel new app
</code></pre></div><p>有时候在window下安装会提示一些插件错误可以跳过插件检查</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer <span class="token function">install</span> --ignore-platform-reqs
</code></pre></div><p>安装基础脚手架</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require laravel/ui --dev

// 生成 登陆/注册 脚手架<span class="token punctuation">..</span>.
php artisan ui bootstrap --auth
php artisan ui vue --auth
php artisan ui react --auth

<span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo pusher-js

<span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run <span class="token function">watch</span>

// 热加载 webpack.mix.js
mix.browserSync<span class="token punctuation">(</span><span class="token string">'websocket.test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>一键命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan ui vue --auth
</code></pre></div><p>分页配置</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// AppServiceProvider</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Pagination<span class="token punctuation">\</span>Paginator</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 分页</span>
    Paginator<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">useBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tailwindcss安装"><a href="#tailwindcss安装" class="header-anchor">#</a> tailwindcss安装</h2> <blockquote><p>中文网站：https://docs.tailwindchina.com/docs/guides/laravel</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -D tailwindcss@npm:@tailwindcss/postcss7-compat @tailwindcss/postcss7-compat postcss@^7 autoprefixer@^9
</code></pre></div><h3 id="创建您的配置文件"><a href="#创建您的配置文件" class="header-anchor">#</a> 创建您的配置文件</h3> <p>接下来，生成您的 <code>tailwind.config.js</code> 文件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>npx tailwindcss init
</code></pre></div><p>这将会在您的项目根目录创建一个最小化的 <code>tailwind.config.js</code> 文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// tailwind.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  purge<span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token string">'./resources/**/*.blade.php'</span><span class="token punctuation">,</span>
     <span class="token string">'./resources/**/*.js'</span><span class="token punctuation">,</span>
     <span class="token string">'./resources/**/*.vue'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  darkMode<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// or 'media' or 'class'</span>
  theme<span class="token operator">:</span> <span class="token punctuation">{</span>
    extend<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  variants<span class="token operator">:</span> <span class="token punctuation">{</span>
    extend<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在-laravel-mix-中配置-tailwind"><a href="#在-laravel-mix-中配置-tailwind" class="header-anchor">#</a> 在 Laravel Mix 中配置 Tailwind</h3> <p>在您的 <code>webpack.mix.js</code> 中，添加 <code>tailwindcss</code> 作为 PostCSS 插件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// webpack.mix.js</span>
  mix<span class="token punctuation">.</span><span class="token function">js</span><span class="token punctuation">(</span><span class="token string">&quot;resources/js/app.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;public/js&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">postCss</span><span class="token punctuation">(</span><span class="token string">&quot;resources/css/app.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;public/css&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
     <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tailwindcss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在您的-css-中引入-tailwind"><a href="#在您的-css-中引入-tailwind" class="header-anchor">#</a> 在您的 CSS 中引入 Tailwind</h3> <p>打开 Laravel 默认为您生成的 ./resources/css/app.css 文件 并使用 <code>@tailwind</code> 指令来包含 Tailwind的 <code>base</code>、 <code>components</code> 和 <code>utilities</code> 样式，来替换掉原来的文件内容。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* ./resources/css/app.css */</span>
<span class="token atrule"><span class="token rule">@tailwind</span> base<span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@tailwind</span> components<span class="token punctuation">;</span></span>
<span class="token atrule"><span class="token rule">@tailwind</span> utilities<span class="token punctuation">;</span></span>
</code></pre></div><p>接下来，在您的主 Blade 布局中导入您的样式表(通常是 <code>resources/views/layouts/app.php</code> 或类似的)，如果还没有存在的话， 请添加响应的视口元标签。</p> <div class="language-diff-html extra-class"><pre class="language-text"><code>  &lt;!doctype html&gt;
  &lt;head&gt;
    &lt;!-- ... ---&gt;
+   &lt;meta charset=&quot;UTF-8&quot; /&gt;
+   &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
+   &lt;link href=&quot;{{ asset('css/app.css') }}&quot; rel=&quot;stylesheet&quot;&gt;
  &lt;/head&gt;
</code></pre></div><p>现在，当您运行 <code>npm run watch</code>, <code>npm run dev</code> 或 <code>npm run prod</code>, Tailwind CSS 就可以在您的 Laravel Mix 项目中使用了。</p> <h2 id="npm-package"><a href="#npm-package" class="header-anchor">#</a> npm package</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i mdui vuex vue-router Axios vue-m-message --save
</code></pre></div><h2 id="laravel-ide-helper"><a href="#laravel-ide-helper" class="header-anchor">#</a> Laravel IDE Helper</h2> <blockquote><p>https://github.com/barryvdh/laravel-ide-helper</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require --dev barryvdh/laravel-ide-helper
</code></pre></div><ul><li><p>add the package to the <code>extra.laravel.dont-discover</code> key in <code>composer.json</code></p> <div class="language- extra-class"><pre class="language-text"><code>&quot;extra&quot;: {
  &quot;laravel&quot;: {
    &quot;dont-discover&quot;: [
      &quot;barryvdh/laravel-ide-helper&quot;
    ]
  }
}
</code></pre></div></li> <li><p>Add the following class to the <code>providers</code> array in <code>config/app.php</code></p> <div class="language- extra-class"><pre class="language-text"><code>Barryvdh\LaravelIdeHelper\IdeHelperServiceProvider::class,
</code></pre></div><p>If you want to manually load it only in non-production environments, instead you can add this to your <code>AppServiceProvider</code> with the <code>register()</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span>\<span class="token package">Barryvdh<span class="token punctuation">\</span>LaravelIdeHelper<span class="token punctuation">\</span>IdeHelperServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>run</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan ide-helper:generate
</code></pre></div><p>checked<code>,</code>email<code>,</code>is_admin<code>,</code>password<code>,</code>phone<code>,</code>usernam
e</p></li></ul> <h2 id="laravel-引入中文语言包"><a href="#laravel-引入中文语言包" class="header-anchor">#</a> <a href="https://www.cnblogs.com/clubs/p/12562790.html" target="_blank" rel="noopener noreferrer">laravel 引入中文语言包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>第一步：</p> <div class="language- extra-class"><pre class="language-text"><code>composer require overtrue/laravel-lang --dev
</code></pre></div><p>第二步：</p> <p>安装成功后，在config/app.php文件中将以下这一行：</p> <div class="language- extra-class"><pre class="language-text"><code>Illuminate\Translation\TranslationServiceProvider::class,
</code></pre></div><p>替换为：</p> <div class="language- extra-class"><pre class="language-text"><code>Overtrue\LaravelLang\TranslationServiceProvider::class,
</code></pre></div><p>第三步：</p> <p>config/app.php 修改</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'locale'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh_CN'</span><span class="token punctuation">,</span>
</code></pre></div><p>中文语言包引用结束</p> <p>表单验证错误信息显示为中文：</p> <div class="language-php extra-class"><pre class="language-php"><code>faker_locale <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh_CN'</span>
</code></pre></div><h2 id="配置中国时间"><a href="#配置中国时间" class="header-anchor">#</a> 配置中国时间</h2> <p>1、<code>config/app.php</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'timezone'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Asia/Shanghai'</span><span class="token punctuation">,</span>
<span class="token single-quoted-string string">'locale'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh-CN'</span><span class="token punctuation">,</span>
<span class="token single-quoted-string string">'faker_locale'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh-CN'</span><span class="token punctuation">,</span>
</code></pre></div><p>2、Model中添加</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">protected</span> <span class="token variable">$dateFormat</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'U'</span><span class="token punctuation">;</span>
<span class="token comment">// 时间配置</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">serializeDate</span><span class="token punctuation">(</span>\<span class="token package">DateTimeInterface</span> <span class="token variable">$date</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token variable">$date</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="时间转化"><a href="#时间转化" class="header-anchor">#</a> 时间转化</h2> <p>1、如果你需要添加<code>start_time</code> ,<code>end_time</code>的也需要时间转化，那么可以在Model中添加转化</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//model</span>
<span class="token keyword">protected</span> <span class="token variable">$dates</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'start_time'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'end_time'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>2、时间类型的转化</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">protected</span> <span class="token variable">$casts</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'email_verified_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'datetime'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'created_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'datetime:Y-m-d H:i:s'</span><span class="token punctuation">,</span> <span class="token comment">//格式化：2021-01:-01 12:00:01</span>
    <span class="token single-quoted-string string">'updated_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'timestamp'</span><span class="token punctuation">,</span> <span class="token comment">// 时间戳的格式</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>3、<code>timestamp</code> 类型的时间存储和查询出来的不一致</p> <p><img src="/images/image-20210803111115811.png" alt="image-20210803111115811"></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
     * 为数组 / JSON 序列化准备日期。
     *
     * @param \DateTimeInterface $date
     * @return string
     */</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">serializeDate</span><span class="token punctuation">(</span>\<span class="token package">DateTimeInterface</span> <span class="token variable">$date</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token variable">$date</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">toDateTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参考：https://learnku.com/articles/44212</p> <p>4、如果需要存储时间戳格式的时间</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">protected</span> <span class="token variable">$dateFormat</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'U'</span><span class="token punctuation">;</span>
</code></pre></div><p>5、获取时间戳</p> <p>如果<code>created_at</code> 是日期格式<code>2021-01-02 10:12:13</code> 获取到他的时间戳</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> \<span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="laravel周期"><a href="#laravel周期" class="header-anchor">#</a> laravel周期</h2> <p>控制器构造方法 -&gt; 父类构造方法 -&gt; 中间件构造方法</p> <h2 id="laravel查询技巧"><a href="#laravel查询技巧" class="header-anchor">#</a> Laravel查询技巧</h2> <h3 id="wherein查询"><a href="#wherein查询" class="header-anchor">#</a> wherein查询</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$status</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token variable">$ids</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token variable">$status</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'status'</span><span class="token punctuation">,</span> <span class="token variable">$status</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token variable">$ids</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$ids</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token variable">$ids</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 另外写法</span>
<span class="token variable">$where</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;in&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1.2</span><span class="token number">.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="时间查询"><a href="#时间查询" class="header-anchor">#</a> 时间查询</h3> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token shell-comment comment">#今天数据</span>
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'customer_today'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Customer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'customer_type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">today</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token shell-comment comment">#昨天数据</span>
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'customer_yesterday'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Customer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'customer_type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">yesterday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 本周数据</span>
<span class="token variable">$this_week</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">startOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">endOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'customer_this_week'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Customer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'customer_type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereBetween</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> <span class="token variable">$this_week</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上周数据</span>
<span class="token variable">$last_week</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">startOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">endOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'customer_last_week'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Customer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'customer_type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereBetween</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> <span class="token variable">$last_week</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 本月数据</span>
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'customer_this_month'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Customer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'customer_type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereMonth</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">month</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上月数据</span>
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'customer_last_month'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Customer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'customer_type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereMonth</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">month</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 本年数据</span>
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'customer_this_year'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Customer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'customer_type'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereYear</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">year</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="表单验证"><a href="#表单验证" class="header-anchor">#</a> 表单验证</h2> <p>方式一：</p> <p>方式二：</p> <h2 id="观察者"><a href="#观察者" class="header-anchor">#</a> 观察者</h2> <h2 id="事件监听"><a href="#事件监听" class="header-anchor">#</a> 事件监听</h2> <h2 id="异常处理"><a href="#异常处理" class="header-anchor">#</a> 异常处理</h2> <h2 id="laravel使用factory填充数据"><a href="#laravel使用factory填充数据" class="header-anchor">#</a> laravel使用factory填充数据</h2> <h3 id="设置中文数据"><a href="#设置中文数据" class="header-anchor">#</a> 设置中文数据</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$faker</span> <span class="token operator">=</span> \<span class="token package">Faker<span class="token punctuation">\</span>Factory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zh_CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token double-quoted-string string">&quot;title&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">//通过配置文件配置</span>
<span class="token comment">// config\app.php</span>
faker_locale <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh_CN'</span>
</code></pre></div><h3 id="创建迁移文件"><a href="#创建迁移文件" class="header-anchor">#</a> 创建迁移文件</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:model Demo -m
</code></pre></div><h3 id="创建工厂数据"><a href="#创建工厂数据" class="header-anchor">#</a> 创建工厂数据</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:factory DemoFactory
</code></pre></div><h3 id="填充数据"><a href="#填充数据" class="header-anchor">#</a> 填充数据</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan tinker
namespace App<span class="token punctuation">\</span>Models<span class="token punctuation">;</span>

Demo::factory<span class="token punctuation">(</span><span class="token punctuation">)</span>-<span class="token operator">&gt;</span>make<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> //测试，不会真的往数据库插入
Demo::factory<span class="token punctuation">(</span><span class="token punctuation">)</span>-<span class="token operator">&gt;</span>create<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 直接写入数据库
</code></pre></div><h2 id="获取原始数据"><a href="#获取原始数据" class="header-anchor">#</a> 获取原始数据</h2> <div class="language-php extra-class"><pre class="language-php"><code>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'identity'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>
</code></pre></div><h2 id="时间搜索"><a href="#时间搜索" class="header-anchor">#</a> 时间搜索</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// 参数格式：2020-10-01 - 2020-10-31 （- 前后有空格）</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$datebt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$datearr</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot; - &quot;</span><span class="token punctuation">,</span><span class="token variable">$datebt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$datebegin</span><span class="token operator">=</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$datearr</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$dateend</span><span class="token operator">=</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$datearr</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$map</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'between'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token variable">$datebegin</span><span class="token punctuation">,</span><span class="token variable">$dateend</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="手动表单验证（api验证）"><a href="#手动表单验证（api验证）" class="header-anchor">#</a> 手动表单验证（api验证）</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$param</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$validate</span> <span class="token operator">=</span> Validator<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">,</span><span class="token punctuation">[</span>
    <span class="token double-quoted-string string">&quot;username&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;required&quot;</span><span class="token punctuation">,</span>
    <span class="token double-quoted-string string">&quot;password&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;required&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>
    <span class="token double-quoted-string string">&quot;username.max&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;用户名不能为空！&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$validate</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">fails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$validate</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取验证错误的第一条信息</span>
</code></pre></div><h2 id="scope使用"><a href="#scope使用" class="header-anchor">#</a> scope使用</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// model:命名规范：scope+驼峰名字（Status）</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">scopeStatus</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;status&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//调用方式：直接写 scope后面的名称即可</span>
    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">json</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这样就取出status为1的数据</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看不懂就参考：https://blog.csdn.net/qq175023117/article/details/101032253</p> <h2 id="动作授权"><a href="#动作授权" class="header-anchor">#</a> 动作授权</h2> <p>场景：假如我们的系统有不同的角色，同一个页面中，展示不同的点击按钮，这个时候就可以用laravel用户授权</p> <p>1、创建一个授权类（非必须）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:policy UserCheckPolicy --model<span class="token operator">=</span>User
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Policies</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>Access<span class="token punctuation">\</span>HandlesAuthorization</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserPolicy</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HandlesAuthorization</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span>User <span class="token variable">$user</span> <span class="token punctuation">,</span> <span class="token variable">$path</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token comment">//这里的user必填，也就是当前登录用户的信息</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'user/add'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'user/delete'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

</span></code></pre></div><p>2、打开 <code>\app\ProvidersAuthServiceProvider.php</code> 注册授权</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;check&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>UserPolicy<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;checkBtn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意引入刚刚创建的类</span>
        <span class="token comment">// 如果判断比较简单，可以直接写在这里也是可以的</span>
<span class="token comment">//        Gate::define(&quot;check&quot;,function (User $user ,$path=&quot;&quot;) {</span>
<span class="token comment">//            return in_array($path,[&quot;delete&quot;,&quot;update]);</span>
<span class="token comment">//        });</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Ps:在rbac权限中，如果传入的url地址在我们后台授权的列表中，则拥有该权限</p> <p>3、在页面中进行授权操作（当前页面没有登录时没有效果的）</p> <div class="language-php extra-class"><pre class="language-php"><code>@<span class="token function">can</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;check&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;user/delete&quot;</span><span class="token punctuation">)</span>
     <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token double-quoted-string string">&quot;button&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;btn btn-primary&quot;</span><span class="token operator">&gt;</span>delete<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
@endcan
</code></pre></div><p>这样的大功告成了。</p> <h2 id="快速生成100w条用户数据"><a href="#快速生成100w条用户数据" class="header-anchor">#</a> 快速生成100w条用户数据</h2> <p>创建一个测试的表 (同时创建factory和migrate文件)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:model MillionUser -fm
</code></pre></div><p>创建好表和对应的模拟数据，先运行测试一下</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan php artisan db:seed --class=MillionUserSeeder
</code></pre></div><p>如果没有错误，表写一个 <code>stary.sh</code> 脚本放在laravel项目的根目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token function-name function">faker_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        php artisan db:seed --class<span class="token operator">=</span>MillionUserSeeder
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;已生成&quot;</span> <span class="token variable">$i</span> <span class="token string">&quot;万条数据&quot;</span>
    <span class="token keyword">done</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;生成成功！！&quot;</span>
    <span class="token builtin class-name">exit</span>
<span class="token punctuation">}</span>
faker_user
</code></pre></div><p>运行脚本：<code>sh ./start</code></p> <h1 id="passport使用"><a href="#passport使用" class="header-anchor">#</a> Passport使用</h1> <p>安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code></code></pre></div><h2 id="laravel中使用redis"><a href="#laravel中使用redis" class="header-anchor">#</a> Laravel中使用redis</h2> <p>安装predis</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require predis/predis
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;orangbus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;welcome&quot;</span><span class="token punctuation">,</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h2 id="laravel中使用mongodb"><a href="#laravel中使用mongodb" class="header-anchor">#</a> Laravel中使用MongoDB</h2> <blockquote><p>自行安装php-mongo扩展</p></blockquote> <p>安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require jenssegers/mongodb
</code></pre></div><p>注册</p> <div class="language-php extra-class"><pre class="language-php"><code>Jenssegers\<span class="token package">Mongodb<span class="token punctuation">\</span>MongodbServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><p>添加门脸</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'Mongo'</span>     <span class="token operator">=</span><span class="token operator">&gt;</span> Jenssegers\<span class="token package">Mongodb<span class="token punctuation">\</span>MongodbServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><p>配置mongo连接</p> <div class="language- extra-class"><pre class="language-text"><code>'mongodb' =&gt; [    
        'driver'   =&gt; 'mongodb',    
        'host'     =&gt; 'localhost',    
        'port'     =&gt; 27017,    
        'database' =&gt; 'mydb',    
        'username' =&gt; '',    
        'password' =&gt; '',
],
</code></pre></div><p>数据库操作跟跟laravel默认的数据库操作基本是一样的，案例</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">)</span> <span class="token comment">// 连接mongodb驱动</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 数据库集合</span>
     		<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span>\<span class="token package">request</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;limit&quot;</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>案例：https://learnku.com/articles/2560/using-mongodb-in-laravel</p> <h2 id="laravel8广播-pusher"><a href="#laravel8广播-pusher" class="header-anchor">#</a> laravel8广播+pusher</h2> <blockquote><p>使用广播之前自行安装好前端脚手架</p></blockquote> <p>第一先注册一个<code>pusher</code> 账号：https://pusher.com/</p> <p>创建应用，获取api信息，填入<code>.env</code>文件中，并修改驱动为<code>pusher</code></p> <div class="language-env extra-class"><pre class="language-text"><code>PUSHER_APP_ID=
PUSHER_APP_KEY=
PUSHER_APP_SECRET=
PUSHER_APP_CLUSTER=mt1

BROADCAST_DRIVER=pusher
</code></pre></div><h3 id="安装pusher驱动"><a href="#安装pusher驱动" class="header-anchor">#</a> 安装<code>pusher驱动</code></h3> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require pusher/pusher-php-server <span class="token string">&quot;~4.0&quot;</span>
</code></pre></div><p>在 resources/js/bootstrap.js 文件中实例化 Echo 对象时 pusher</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">'laravel-echo'</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Pusher <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pusher-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token operator">:</span> <span class="token string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_KEY</span><span class="token punctuation">,</span> <span class="token comment">//这里修改为 pusher 的key</span>
    cluster<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_CLUSTER</span><span class="token punctuation">,</span> <span class="token comment">//pusher的地区</span>
    forceTLS<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建Free事件，检验pusher是否配置ok</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>event Free
</code></pre></div><p>编辑Free事件</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Free</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span> <span class="token comment">//实现广播接口</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
<span class="token comment">//        return new PrivateChannel('channel-name');</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//公有频道名称</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><p>路由出发Free事件</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/free'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Free</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Hello OrangBus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dd</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接听消息</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!doctype html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ csrf_token() }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    &lt;link rel=&quot;stylesheet&quot; href=&quot;{{ mix(&quot;css/app.css&quot;) }}&quot;&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>pusher<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

&lt;script src=&quot;{{ mix(&quot;js/app.js&quot;) }}&quot;&gt;<span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span>Echo<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'cctv1'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'Free'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果按照上面的步骤跑完了没有监听到数据：</p> <p>1、pusher推动延迟了，等一会或者多刷新几次</p> <p>2、pusher配置哪里出错了</p> <h2 id="laravel8广播-websocket"><a href="#laravel8广播-websocket" class="header-anchor">#</a> laravel8广播+websocket</h2> <h3 id="安装laravel-和前端脚手架"><a href="#安装laravel-和前端脚手架" class="header-anchor">#</a> 安装laravel 和前端脚手架</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>laravel new websocket

// laravel8新出的（不会用）
composer require laravel/jetstream

php artisan jetstream:install livewire // blade模板
php artisan jetstream:install inertia //vue模板

// 可以使用脚手架
composer require laravel/ui --dev

// 生成基本脚手架<span class="token punctuation">..</span>.
php artisan ui bootstrap
php artisan ui vue
php artisan ui react

// 生成 登陆/注册 脚手架<span class="token punctuation">..</span>.
php artisan ui bootstrap --auth
php artisan ui vue --auth
php artisan ui react --auth

<span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run dev

// 热加载 webpack.mix.js
mix.browserSync<span class="token punctuation">(</span><span class="token string">'redis.test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>配置数据库并迁移数据库文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan migrate
</code></pre></div><p>先让项目跑起来看看有没有报错，能否正常注册</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan serve
</code></pre></div><h3 id="安装-laravel-websocket"><a href="#安装-laravel-websocket" class="header-anchor">#</a> 安装 <code>laravel/websocket</code></h3> <blockquote><p>https://beyondco.de/</p></blockquote> <p>用过laravel的朋友因该都熟悉下面的操作吧</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require beyondcode/laravel-websockets
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>php artisan vendor:publish --provider<span class="token operator">=</span><span class="token string">&quot;BeyondCode\LaravelWebSockets\WebSocketsServiceProvider&quot;</span> --tag<span class="token operator">=</span><span class="token string">&quot;migrations&quot;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>php artisan vendor:publish --provider<span class="token operator">=</span><span class="token string">&quot;BeyondCode\LaravelWebSockets\WebSocketsServiceProvider&quot;</span> --tag<span class="token operator">=</span><span class="token string">&quot;config&quot;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>php artisan migrate
</code></pre></div><h3 id="安装-pusher"><a href="#安装-pusher" class="header-anchor">#</a> 安装 <code>pusher</code></h3> <p>注册一个pusher账号，获取api信息：https://pusher.com/</p> <div class="language- extra-class"><pre class="language-text"><code>composer require pusher/pusher-php-server &quot;~3.0&quot;
</code></pre></div><p>修改 <code>.env</code></p> <div class="language- extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=pusher
</code></pre></div><p>修改 <code>config/broadcasting.php</code> （记得要配置这里，不然接受不到消息）</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'pusher'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_SECRET'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'app_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_ID'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> 
        <span class="token single-quoted-string string">'cluster'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_CLUSTER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'encrypted'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">6001</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scheme'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>修改 <code>config/websockets.php</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'apps'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_ID'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'APP_NAME'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_SECRET'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'enable_client_messages'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">false</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'enable_statistics'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>启动 laravel-websocket 服务</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan websockets:serve //默认6001
// or
php artisan websockets:serve --port=3030
</code></pre></div><p>查看<strong>websocket dashboard</strong>：<code>ip/laravel-websockets</code></p> <p>你可以配置<strong>websocket dashboard</strong>访问权限：<code>AuthServiceProvider</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'viewWebSocketsDashboard'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token comment">//</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="安装前端库"><a href="#安装前端库" class="header-anchor">#</a> 安装前端库</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo pusher-js
<span class="token function">npm</span> <span class="token function">install</span> --save socket.io-client
</code></pre></div><h3 id="创建事件"><a href="#创建事件" class="header-anchor">#</a> 创建事件</h3> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>event WeChat
</code></pre></div><p>在<code>app/Events/Wechat</code> 实现广播接口</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">WeChat</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$user</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><p><code>Wechat</code>:  事件的名称</p> <p><code>cctv1</code>:  频道的名称</p> <p>注册一个事件触发的路由</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;/chat&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;orangbus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> \<span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Auth</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Wechat</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>监听事件:<code>bootstrap</code> （不要忘记了在视图页面加载 <code>app.css</code> 和 <code>app.js</code>文件）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">'laravel-echo'</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Pusher <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pusher-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token operator">:</span> <span class="token string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_KEY</span><span class="token punctuation">,</span> <span class="token comment">//把 .env文件的信息复制过来</span>
    cluster<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MIX_PUSHER_APP_CLUSTER</span><span class="token punctuation">,</span> <span class="token comment">//把 .env文件的信息复制过来</span>
    forceTLS<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    wsHost<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    wsPort<span class="token operator">:</span> <span class="token number">6001</span><span class="token punctuation">,</span>
    <span class="token comment">// wsPath: '/ws',</span>
    disableStats<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enabledTransports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ws'</span><span class="token punctuation">,</span><span class="token string">'wss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//如果你的消息发送失败多半是因为这个</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//我们就可以接收到如下消息</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;orangbus&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;orangbus&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;email_verified_at&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string">&quot;created_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-12-04T09:01:47.000000Z&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;updated_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-12-04T09:01:47.000000Z&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="laravel8广播-redis"><a href="#laravel8广播-redis" class="header-anchor">#</a> laravel8广播-redis</h2> <h3 id="安装redis广播库"><a href="#安装redis广播库" class="header-anchor">#</a> 安装redis广播库</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require predis/predis
</code></pre></div><h3 id="安装前端依赖"><a href="#安装前端依赖" class="header-anchor">#</a> 安装前端依赖</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save socket.io-client
<span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo pusher-js
<span class="token function">npm</span> <span class="token function">install</span> -g laravel-echo-server

<span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run <span class="token function">watch</span>

laravel-echo-server init
laravel-echo-server start
</code></pre></div><p>在入口文件中添加这个 <code>socket.io</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;//{{ Request::getHost() }}:6001/socket.io/socket.io.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>修改<code>.env</code></p> <div class="language-env extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=redis
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
</code></pre></div><h3 id="开启广播"><a href="#开启广播" class="header-anchor">#</a> 开启广播</h3> <p>config/app.php 的 providers取消注释</p> <div class="language-php extra-class"><pre class="language-php"><code>App\<span class="token package">Providers<span class="token punctuation">\</span>BroadcastServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="创建一个公有广播事件"><a href="#创建一个公有广播事件" class="header-anchor">#</a> 创建一个公有广播事件</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:event Free
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Free</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span> <span class="token comment">//实现广播接口</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span> <span class="token comment">//触发时间传递过来的参数</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//频道的名称</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><h4 id="添加一条路由触发事件"><a href="#添加一条路由触发事件" class="header-anchor">#</a> 添加一条路由触发事件</h4> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/free'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Free</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="监听事件"><a href="#监听事件" class="header-anchor">#</a> 监听事件</h4> <p>记得在入口文件处添加header头</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ csrf_token() }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//resources/js/bootstrap.js</span>
<span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">&quot;laravel-echo&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// window.io = require('socket.io-client'); //按照官网的意思需要加上，可是我加上了却监听不到消息，搞了好多天无意间注释了反而接收到消息了，有没有大佬告知一下为什么？？</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token operator">:</span> <span class="token string">'socket.io'</span><span class="token punctuation">,</span>
    host<span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname <span class="token operator">+</span> <span class="token string">':6001'</span> <span class="token comment">//如果需要单独写其他域名不用加http，</span>
    <span class="token comment">// host: &quot;redis.test:6001&quot;</span>
    <span class="token comment">//可选</span>
    auth<span class="token operator">:</span> <span class="token punctuation">{</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      Authorization<span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Echo<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'cctv'</span><span class="token punctuation">)</span> <span class="token comment">//频道的名称</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'Free'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 监听的事件</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;这里是接受到的消息&quot;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="私有广播事件"><a href="#私有广播事件" class="header-anchor">#</a> 私有广播事件</h3> <p>先登录一个账号，私有广播需要权限认证</p> <h4 id="创建一个广播事件"><a href="#创建一个广播事件" class="header-anchor">#</a> 创建一个广播事件</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan make:event LetChat
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>Channel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>InteractsWithSockets</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PresenceChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PrivateChannel</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>ShouldBroadcast</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LetChat</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldBroadcast</span> <span class="token comment">//事件广播接口</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithSockets<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span> <span class="token comment">//前端传递过来的数据</span>
    <span class="token keyword">public</span> <span class="token variable">$user_id</span><span class="token punctuation">;</span> <span class="token comment">//假如传递一个用户ID</span>

    <span class="token comment">/**
     * Create a new event instance.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$user_id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span> <span class="token operator">=</span> <span class="token variable">$user_id</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the channels the event should broadcast on.
     *
     * @return \Illuminate\Broadcasting\Channel|array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">broadcastOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PrivateChannel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv.'</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里是一个私有的广播，频道的名称大概是这样的： cctv.1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><h4 id="添加一个触发路由"><a href="#添加一个触发路由" class="header-anchor">#</a> 添加一个触发路由</h4> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/free'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$userId</span> <span class="token operator">=</span> Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Free</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span><span class="token variable">$userId</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用户需要登录</span>
</code></pre></div><h4 id="权限认证"><a href="#权限认证" class="header-anchor">#</a> 权限认证</h4> <p>这个文件跟 <code>routes/web</code> 路由是类似的，只有返回 <code>true</code> 的时候才会进行广播事件，所以我们可以在这里进行一些逻辑上的判断</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// routes/channels</span>
Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cctv.{id}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 写一些判断逻辑，最终返回true即可</span>
    <span class="token variable">$list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span><span class="token variable">$list</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span> <span class="token comment">//当传过来的用户id在 $list 这个才会进行广播</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="前端监听事件"><a href="#前端监听事件" class="header-anchor">#</a> 前端监听事件</h4> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div><h3 id="广播使用redis"><a href="#广播使用redis" class="header-anchor">#</a> 广播使用redis</h3> <div class="language-env extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=redis
CACHE_DRIVER=redis
QUEUE_CONNECTION=redis
</code></pre></div><p>需要运行队列监听</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan queue:listen
</code></pre></div><h2 id="广播使用注意事项"><a href="#广播使用注意事项" class="header-anchor">#</a> 广播使用注意事项</h2> <h3 id="前端没有接收到消息"><a href="#前端没有接收到消息" class="header-anchor">#</a> 前端没有接收到消息</h3> <p>1、检查此文件是否配置正确。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">'laravel-echo'</span><span class="token punctuation">;</span>

<span class="token comment">// window.io = require('socket.io-client'); // 这个玩意好像没用，但是官网说要引入他</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token operator">:</span> <span class="token string">'socket.io'</span><span class="token punctuation">,</span>
    host<span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname <span class="token operator">+</span> <span class="token string">':6001'</span><span class="token punctuation">,</span>
    enabledTransports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ws'</span><span class="token punctuation">,</span><span class="token string">'wss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//如果你的消息发送失败多半是因为这个</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2、使用redis作为消息驱动</p> <div class="language- extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=redis
CACHE_DRIVER=redis
QUEUE_CONNECTION=redis
SESSION_DRIVER=redis
SESSION_LIFETIME=1200
</code></pre></div><p>3、入口文件引入<code>scoket,io</code> js文件</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script src=&quot;//{{ Request::getHost() }}:6001/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;
</code></pre></div><p>4、命令行中查看 <code>Channel</code> 和 <code>Event:xxxx</code> 是否执行正确，默认laravel会给channel加上一个前缀，可以打开 <code>config/app.php</code> ,把下面这样注释了。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'prefix'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PREFIX'</span><span class="token punctuation">,</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slug</span><span class="token punctuation">(</span><span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'APP_NAME'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'laravel'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'_database_'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>5、以上配置还是不行，检查查看laravel版本，寻找对应版本的文档在走一一边，还是不行就放弃吧，哈哈哈哈。</p> <h2 id="laravel广播-redis-laradock"><a href="#laravel广播-redis-laradock" class="header-anchor">#</a> laravel广播+redis+laradock</h2> <p>启动<code>laravel-echo-serve</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> pathTo/laradock
docker-composer up -d redis laravel-echo-serve
</code></pre></div><p>默认就开始了 6001端口，这样我们就可以连接了</p> <h2 id="laradock-laravel-redis广播"><a href="#laradock-laravel-redis广播" class="header-anchor">#</a> Laradock+Laravel+redis广播</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>laravel new webscoket

composer require predis/predis

composer require laravel/ui --dev
php artisan ui vue --auth

<span class="token function">npm</span> <span class="token function">install</span> --save socket.io-client <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'websocket 客户端'</span>
<span class="token function">npm</span> <span class="token function">install</span> --save laravel-echo     <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'websocket 客户端封装'</span>
<span class="token function">npm</span> <span class="token function">install</span> -g laravel-echo-server  <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'websocket 服务端'</span>
<span class="token function">npm</span> <span class="token function">install</span>                         <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'安装所有其他依赖'</span>
<span class="token function">npm</span> run <span class="token function">watch</span>                        <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'监控文件变化编译前端资源'</span>
laravel-echo-server init             <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'初始化 websocket 服务端'</span>
laravel-echo-server start            <span class="token operator">|</span>  <span class="token builtin class-name">echo</span> <span class="token string">'启动 websocket 服务端'</span>

// 热加载 webpack.mix.js
mix.browserSync<span class="token punctuation">(</span><span class="token string">'redis.test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cnpm <span class="token function">install</span> browser-sync browser-sync-webpack-plugin@2.0.1 --save-dev --production<span class="token operator">=</span>false

</code></pre></div><p>.env 文件配置</p> <div class="language-env extra-class"><pre class="language-text"><code>BROADCAST_DRIVER=redis
CACHE_DRIVER=redis
QUEUE_CONNECTION=redis
</code></pre></div><h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <p>1、使用 <code>php-worker</code> 的时候，需要开启redis扩展。</p> <p>2、最好把 <code>workspace</code> 的PHP 的 redis 扩展也安装了。</p> <h2 id="广播使用总结"><a href="#广播使用总结" class="header-anchor">#</a> 广播使用总结</h2> <h3 id="_1、共有广播"><a href="#_1、共有广播" class="header-anchor">#</a> 1、共有广播</h3> <p>只要监听公有广播，则监听的用户都可以收到广播发送的消息。</p> <h3 id="_2、私有广播"><a href="#_2、私有广播" class="header-anchor">#</a> 2、私有广播</h3> <ul><li><p>需要登录才能收到消息</p></li> <li><p>可以做一对一聊天，通过channel路由进行授权</p> <p>默认有一个 <code>$user</code> 表示监听该频道的用户</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// 私有消息</span>
Broadcast<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'privateChannel.{toId}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span><span class="token variable">$toId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果监听的用户是我发送消息的用户，则该用户可以接受消息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">==</span> <span class="token variable">$toId</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//我自己监听我自己的频道，别人发消息到我的频道，我就可以收到别人给我发的消息了</span>
window<span class="token punctuation">.</span>Echo<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">&quot;private-privateChannel.{{ auth()-&gt;id() }}&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 频道名称</span>
    <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">&quot;PrivateMessage&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 事件名称</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;下面是接收到的消息&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class=&quot;col-md-12&quot;&gt;
&lt;div class=&quot;alert alert-success &quot; role=&quot;alert&quot;&gt;
&lt;strong&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>formUser<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:&lt;/strong&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
&lt;/div&gt;
&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="_3、presence频道"><a href="#_3、presence频道" class="header-anchor">#</a> 3、presence频道</h3> <ul><li><p>必须登录</p></li> <li><p>多人聊天</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 监听消息，user:当前进入的用户</span>
window<span class="token punctuation">.</span>Echo<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;room.{{ $room_id }}&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">here</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;here：已经在聊天室的小伙伴&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// orangbus 进入了聊天室</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;joining：某个用户进来会收到什么消息&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">leaving</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// orangbus 离开了聊天室</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;leaving：某个用户离开了&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="广播遇到的文件"><a href="#广播遇到的文件" class="header-anchor">#</a> 广播遇到的文件</h2> <blockquote><p>Unable to join channel. Member data for presence channel missing</p></blockquote> <h2 id="laravel中使用mongodb数据库"><a href="#laravel中使用mongodb数据库" class="header-anchor">#</a> laravel中使用mongodb数据库</h2> <p>github：https://github.com/jenssegers/laravel-mongodb</p> <h1 id="laradock使用elasticsearch"><a href="#laradock使用elasticsearch" class="header-anchor">#</a> laradock使用elasticsearch</h1> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> sysctl -w vm.max_map_count <span class="token operator">=</span> <span class="token number">262144</span>
</code></pre></div><h2 id="meilisearch搜索"><a href="#meilisearch搜索" class="header-anchor">#</a> MeiliSearch搜索</h2> <p>安装Scout</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require laravel/scout

composer require meilisearch/meilisearch-php http-interop/http-factory-guzzle

php artisan vendor:publish --provider<span class="token operator">=</span><span class="token string">&quot;Laravel\Scout\ScoutServiceProvider&quot;</span>
</code></pre></div><p>model 配置</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token shell-comment comment"># 模型中user</span>
<span class="token keyword">use</span> <span class="token package">Searchable</span><span class="token punctuation">;</span>

<span class="token comment">/**
     * 获取与模型关联的索引的名称。
     *
     * @return string
     */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">searchableAs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token single-quoted-string string">'users_index'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>scout.php</code></p> <div class="language- extra-class"><pre class="language-text"><code>'meilisearch' =&gt; [
    'host' =&gt; env('MEILISEARCH_HOST', '127.0.0.1:7700'),
]
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code># .env

# 搜索配置
SCOUT_QUEUE=true # 使用队列
SCOUT_IDENTIFY=true # 识别用户
SCOUT_DRIVER=meilisearch
MEILISEARCH_HOST=http://192.168.3.5:7700
MEILISEARCH_KEY=
</code></pre></div><p>导入索引</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan scout:import &quot;App\Models\Post&quot;

// 删除
php artisan scout:flush &quot;App\Models\Post&quot;
</code></pre></div><p>搜索</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$data</span> <span class="token operator">=</span> Joke<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;&lt;&quot;</span><span class="token punctuation">,</span><span class="token number">460</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">searchable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="elasticsearch-搜索"><a href="#elasticsearch-搜索" class="header-anchor">#</a> elasticsearch 搜索</h2> <h1 id="minio文件上传"><a href="#minio文件上传" class="header-anchor">#</a> minio文件上传</h1> <p>安装依赖,(记得限制版本，不然安装会出错)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require league/flysystem-aws-s3-v3 ~1.0
composer require league/flysystem-cached-adapter ~1.0

// laravel9
composer require -W league/flysystem-aws-s3-v3 <span class="token string">&quot;^3.0&quot;</span>
</code></pre></div><blockquote><p>config/filesystems.php</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>&lt;?php
return [
    // ...
    'cloud' =&gt; env('FILESYSTEM_CLOUD', 's3'),
    'disks' =&gt; [
        // ...
        'minio' =&gt; [
            'driver' =&gt; 's3',
            'endpoint' =&gt; env('MINIO_ENDPOINT', 'http://127.0.0.1:9005'),
            'use_path_style_endpoint' =&gt; true,
            'key' =&gt; env('AWS_KEY'),
            'secret' =&gt; env('AWS_SECRET'),
            'region' =&gt; env('AWS_REGION'),
            'bucket' =&gt; env('AWS_BUCKET'),
        ],
    ],
];
</code></pre></div><blockquote><p>.env</p></blockquote> <div class="language-.env extra-class"><pre class="language-text"><code># Minio config

AWS_ACCESS_KEY_ID=orangbus
AWS_SECRET_ACCESS_KEY=orangbus
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=laravel
AWS_ENDPOINT=http://ip:9000
CDN_HOST=http://ip:9000
AWS_USE_PATH_STYLE_ENDPOINT=false
</code></pre></div><p>如果生成的地址无法访问，请检查当前 <code>Buckets</code> 的 <code>Access Policy：public</code> 即可。</p> <h3 id="laravel文件上传案例"><a href="#laravel文件上传案例" class="header-anchor">#</a> laravel文件上传案例</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>common</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Enum<span class="token punctuation">\</span>GlobalEnum</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>BusinessException</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Admin</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Merchant</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>MerchantConfig</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>SmsCode</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Service<span class="token punctuation">\</span>UtilService</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Storage</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 一些公共的接口：文件上传，发送验证码等
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * 获取用户存储信息
     * @return string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getDistType</span><span class="token punctuation">(</span><span class="token variable">$fileType</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$fileType</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token double-quoted-string string">&quot;image&quot;</span><span class="token punctuation">:</span>
                <span class="token variable">$disk</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;images&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token double-quoted-string string">&quot;video&quot;</span><span class="token punctuation">:</span>
                <span class="token variable">$disk</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;videos&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token double-quoted-string string">&quot;audio&quot;</span><span class="token punctuation">:</span>
                <span class="token variable">$disk</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;audios&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token double-quoted-string string">&quot;private&quot;</span><span class="token punctuation">:</span> <span class="token comment">//重要文件</span>
                <span class="token variable">$disk</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;private&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token variable">$disk</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;others&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token single-quoted-string string">'/'</span><span class="token punctuation">.</span><span class="token variable">$disk</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 文件存储方式
     * @return string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getOssType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token single-quoted-string string">'minio'</span><span class="token punctuation">;</span> <span class="token comment">// minio</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取下载链接
     * @param $backet
     * @param $path
     * @return string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token variable">$backet</span><span class="token punctuation">,</span><span class="token variable">$path</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$backet</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> GlobalEnum<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fileCdnHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;/&quot;</span><span class="token punctuation">.</span> <span class="token variable">$path</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> GlobalEnum<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fileCdnHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;/&quot;</span><span class="token punctuation">.</span><span class="token variable">$backet</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;/&quot;</span><span class="token punctuation">.</span> <span class="token variable">$path</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;请选择文件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 非空判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;无效文件！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getErrorMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getClientMimeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//文件类型,【将重要的文件单独存放】</span>
        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getClientOriginalExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span>GlobalEnum<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">importanceFileTypeList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;private&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 上传文件大小限制为2m</span>
        <span class="token variable">$fileSize</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$fileSize</span> <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;文件大小不能超过3M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 非登录用户禁止上传文件</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;禁止上传文件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$backet</span> <span class="token operator">=</span> GlobalEnum<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">backetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存储卷</span>
        <span class="token variable">$disk</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getDistType</span><span class="token punctuation">(</span><span class="token variable">$fileType</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$fileType</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'private'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$path</span> <span class="token operator">=</span> Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOssType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">putFileAs</span><span class="token punctuation">(</span><span class="token variable">$disk</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getClientOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$path</span> <span class="token operator">=</span> Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOssType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token variable">$disk</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;文件上传成功！&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token double-quoted-string string">&quot;name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span>  <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getClientOriginalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;size&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;url&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token variable">$backet</span><span class="token punctuation">,</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;fileType&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$fileType</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param filename 绝对路径: /image/orangbus.png
     * @return \Illuminate\Http\JsonResponse
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;filename&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;文件名不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$explode</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;/&quot;</span><span class="token punctuation">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;/&quot;</span><span class="token punctuation">,</span><span class="token function">array_splice</span><span class="token punctuation">(</span><span class="token variable">$explode</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOssType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;删除成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</span></code></pre></div><h3 id="扩展包推荐"><a href="#扩展包推荐" class="header-anchor">#</a> 扩展包推荐</h3> <p>发送钉钉消息（钉钉机器人）：https://github.com/wowiwj/ding-notice</p> <h1 id="templet模板"><a href="#templet模板" class="header-anchor">#</a> templet模板</h1> <h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <p>增删路由： @curd-router</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$controller</span>$<span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;list&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//列表</span>
Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;store&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$controller</span>$<span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;store&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加、编辑</span>
Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;delete&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$controller</span>$<span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//删除</span>
</code></pre></div><p>增删改查分组路由： @curd-router-group</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;prefix&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token double-quoted-string string">&quot;<span class="token interpolation"><span class="token variable">$prefix</span></span>$&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$controller</span>$<span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;list&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//列表</span>
    Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;store&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$controller</span>$<span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;store&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加、编辑</span>
    Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;delete&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$controller</span>$<span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//删除</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="增删改查"><a href="#增删改查" class="header-anchor">#</a> 增删改查</h2> <p>增删改查： @curd</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$model</span>$ <span class="token variable">$alias</span>$<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$cate</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'uid'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
    <span class="token variable">$model</span>$<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">updateOrCreate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;id&quot;</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token variable">$id</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token single-quoted-string string">'添加成功'</span><span class="token punctuation">:</span> <span class="token single-quoted-string string">'更新成功'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$ids</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;ids&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$ids</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token variable">$ids</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$ids</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;请选择删除数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$model</span>$<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token variable">$ids</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;删除成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="模型方法"><a href="#模型方法" class="header-anchor">#</a> 模型方法</h2> <p>获取列表数据： @getList</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="返回"><a href="#返回" class="header-anchor">#</a> 返回</h2> <p>数据返回： resdd</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>成功返回： res-success</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token variable">$msg</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">enum</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;success&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;删除成功&quot;</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'添加成功'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'保存成功'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'更新成功'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'修改成功'</span><span class="token punctuation">)</span>
</code></pre></div><p>失败返回： res-error</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token variable">$msg</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">enum</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;删除失败&quot;</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'添加失败'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'保存失败'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'更新失败'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'修改失败'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'参数错误'</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="远程一对一关系"><a href="#远程一对一关系" class="header-anchor">#</a> 远程一对一关系</h1> <p>远程一对一关联通过一个中间关联模型实现。</p> <p>例如，如果每个供应商都有一个用户，并且每个用户与一个用户历史记录相关联，那么供应商可以通过用户访问用户的历史记录，让我们看看定义这种关系所需的数据库表：</p> <div class="language- extra-class"><pre class="language-text"><code>users

  id - integer

  supplier_id - integer



suppliers

  id - integer



history

  id - integer

  user_id - integer
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code> <span class="token operator">*</span> 第一个参数是希望访问的模型名称，

     <span class="token operator">*</span> 第二个参数是中间模型的名称。

     <span class="token operator">*</span> 方法传递第三个和第四个参数实现，

     <span class="token operator">*</span> 第三个参数表示中间模型的外键名，

     <span class="token operator">*</span> 第四个参数表示最终模型的外键名。

     <span class="token operator">*</span> 第五个参数表示本地键名，

     <span class="token operator">*</span> 而第六个参数表示中间模型的本地键名：

     <span class="token operator">*</span> <span class="token single-quoted-string string">'App\History'</span><span class="token punctuation">,</span>

<span class="token operator">*</span> <span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">,</span>

<span class="token operator">*</span> <span class="token single-quoted-string string">'supplier_id'</span><span class="token punctuation">,</span> <span class="token comment">// 用户表外键</span>

<span class="token operator">*</span> <span class="token single-quoted-string string">'user_id'</span><span class="token punctuation">,</span> <span class="token comment">// 历史记录表外键</span>

<span class="token operator">*</span> <span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token comment">// 供应商本地键</span>

<span class="token operator">*</span> <span class="token single-quoted-string string">'id'</span> <span class="token comment">// 用户本地键</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">userHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOneThrough</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\History'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>         
</code></pre></div><h2 id="远程一对多"><a href="#远程一对多" class="header-anchor">#</a> 远程一对多</h2> <p>课程表  -&gt; 中间表 -&gt; 老师表</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">teacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasManyThrough</span><span class="token punctuation">(</span>
        Teacher<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token comment">// 远程表</span>
        CourseRoleTeacher<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token comment">// 中间表</span>
        <span class="token double-quoted-string string">&quot;course_id&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 【中间表】对主表的关联字段</span>
        <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 【远程表】对中间表的关联字段</span>
        <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 【主表】对中间表的关联字段</span>
        <span class="token double-quoted-string string">&quot;teacher_id&quot;</span> <span class="token comment">// 【中间表】对远程表的关联字段</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="全局作用于"><a href="#全局作用于" class="header-anchor">#</a> 全局作用于</h1> <p>方式一(匿名函数)：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> \<span class="token package">Auth</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">provider</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> GlobalEnum<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">inNeedQuarantine</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">provider</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addGlobalScope</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;mer_id&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$builder</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;mer_id&quot;</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">mer_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 触发保存的时候自动添加上 mer_id,数据已经整理完毕，但是还没有写入数据库触发</span>
            <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">saving</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$model</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">mer_id</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">mer_id</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>方式二</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">/**
 * Created by OrangBus
 * User email: orangbus40400@gmail.com
 * website: orangbus.cn
 * blog: doc.orangbus.cn
 * github: github.com/orangbus
 */</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Scopes</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Enum<span class="token punctuation">\</span>GlobalEnum</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Scope</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MerScope</span> <span class="token keyword">implements</span> <span class="token class-name">Scope</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * 商户的数据隔离
     * @param Builder $builder
     * @param Model $model
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span>Builder <span class="token variable">$builder</span><span class="token punctuation">,</span> Model <span class="token variable">$model</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">provider</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> GlobalEnum<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">inNeedQuarantine</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">provider</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$builder</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;mer_id&quot;</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">mer_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 触发保存的时候自动添加上 mer_id,数据已经整理完毕，但是还没有写入数据库触发</span>
            <span class="token variable">$model</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">mer_id</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">mer_id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</span></code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Enum<span class="token punctuation">\</span>GlobalEnum</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Scopes<span class="token punctuation">\</span>MerScope</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Factories<span class="token punctuation">\</span>HasFactory</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">BaseModel</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasFactory</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 全局查询作用域
     * 主要作用：当用户保存数据或者查询数据的时候，自动的添加一个 mer_id 字段限制
     * @var array
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">booted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">booted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addGlobalScope</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MerScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></code></pre></div><h1 id="horizon-队列管理工具"><a href="#horizon-队列管理工具" class="header-anchor">#</a> Horizon 队列管理工具</h1> <div class="language-bash extra-class"><pre class="language-bash"><code>composer require laravel/horizon

php artisan horizon:install
</code></pre></div><p>启动</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan horizon
 <span class="token variable">$this</span>-<span class="token operator">&gt;</span>notice-<span class="token operator">&gt;</span>next_time <span class="token operator">=</span> <span class="token punctuation">(</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token variable">$this</span>-<span class="token operator">&gt;</span>notice-<span class="token operator">&gt;</span>minute * <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 下次更新时间
  <span class="token variable">$this</span>-<span class="token operator">&gt;</span>notice-<span class="token operator">&gt;</span>notice_count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>访问：http:// ip/horizon</p> <blockquote><p>laravel/horizon[v5.9.0, ..., 5.x-dev] require ext-pcntl * -&gt; it is missing from your system. Install or enable PHP's pcntl extension.</p> <div class="language- extra-class"><pre><code>- Root composer.json requires laravel/horizon ^5.9 -&gt; satisfiable by laravel/horizon[v5.9.0, ..., 5.x-dev]
</code></pre></div></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// composer.json

&quot;config&quot;: {
        &quot;platform&quot;: {
            &quot;ext-pcntl&quot;: &quot;8.0&quot;,
            &quot;ext-posix&quot;: &quot;8.0&quot;
        }
    },
</code></pre></div><h1 id="laravel9-时区不对"><a href="#laravel9-时区不对" class="header-anchor">#</a> laravel9-时区不对</h1> <p>在模型中添加</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">DateTimeInterface</span><span class="token punctuation">;</span>

<span class="token comment">/**
     * 为数组 / JSON 序列化准备日期。
     *
     * @param \DateTimeInterface $date
     * @return string
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">serializeDate</span><span class="token punctuation">(</span>DateTimeInterface <span class="token variable">$date</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$date</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">dateFormat</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token single-quoted-string string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><code>config/app.php</code>时区设置</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token single-quoted-string string">'timezone'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'PRC'</span><span class="token punctuation">,</span> <span class="token comment">// 中国的时间</span>
 <span class="token single-quoted-string string">'locale'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'zh_CN'</span><span class="token punctuation">,</span>
</code></pre></div><h1 id="laravel按日期时间分组并统计"><a href="#laravel按日期时间分组并统计" class="header-anchor">#</a> laravel按日期时间分组并统计</h1> <h2 id="统计七天内注册用户数量按天进行分组"><a href="#统计七天内注册用户数量按天进行分组" class="header-anchor">#</a> 统计七天内注册用户数量按天进行分组</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereBetween</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'2018-01-01'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'2018-01-07'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">selectRaw</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DATE(created_at) as date,COUNT(*) as value'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'date'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="统计一年内注册用户数量按月份进行分组"><a href="#统计一年内注册用户数量按月份进行分组" class="header-anchor">#</a> 统计一年内注册用户数量按月份进行分组</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereBetween</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'2018-01-01'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'2018-12-31'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">selectRaw</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DATE_FORMAT(created_at,&quot;%Y-%m&quot;) as date,COUNT(*) as value'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'date'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>示例</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'articles'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;uid&quot;</span><span class="token punctuation">,</span><span class="token variable">$uid</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereMonth</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;created_at&quot;</span><span class="token punctuation">,</span>Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">month</span><span class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">selectRaw</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DATE_FORMAT(created_at,&quot;%Y-%m-%d&quot;) as date,COUNT(*) as value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whereYear</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;created_at&quot;</span><span class="token punctuation">,</span>Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">year</span><span class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">selectRaw</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DATE_FORMAT(created_at,&quot;%Y-%m&quot;) as date,COUNT(*) as value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'date'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="laravel9运行webpack出错"><a href="#laravel9运行webpack出错" class="header-anchor">#</a> laravel9运行webpack出错</h1> <blockquote><p>[webpack-cli] Error: Cannot find module 'webpack/lib/rules/DescriptionDataMatcherRulePlugin'</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> update vue-loader

<span class="token function">npm</span> i vue-loader --save

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/orangbus/vuepress-blog/edit/master/docs/Laravel/LaraCode.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">3/20/2023, 11:31:12 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><div class="reading-progress top" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div></div></div>
    <script src="/assets/js/app.ea451ed9.js" defer></script><script src="/assets/js/3.6c5e3284.js" defer></script><script src="/assets/js/87.92ca344e.js" defer></script>
  </body>
</html>
