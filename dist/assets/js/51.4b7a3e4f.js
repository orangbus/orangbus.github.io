(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{541:function(s,a,t){"use strict";t.r(a);var e=t(11),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"安装kubelet-kubeadm-kubectl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装kubelet-kubeadm-kubectl"}},[s._v("#")]),s._v(" 安装kubelet kubeadm kubectl")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y apt-transport-https\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" apt-key "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" - \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet kubeadm kubectl\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 另外，你也可以指定版本安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## apt-get install kubectl=1.21.3-00 kubelet=1.21.3-00 kubeadm=1.21.3-00")]),s._v("\n")])])]),t("h1",{attrs:{id:"minikube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#minikube"}},[s._v("#")]),s._v(" minikube")]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("minikube: "),t("a",{attrs:{href:"https://minikube.sigs.k8s.io/docs/start",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://minikube.sigs.k8s.io/docs/start"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" pacman -S nimikube\n")])])]),t("h2",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("p",[t("strong",[s._v("第一次启动")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("minikube start --driver=virtualbox /\n--registry-mirror=https://registry.docker-cn.com\n\nminikube start --vm-driver=virtualbox /\n--image-mirror-country=cn /\n--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers /\n--iso-url=https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/iso/minikube-v1.7.3.iso /\n--registry-mirror=https://reg-mirror.qiniu.com\n")])])]),t("ul",[t("li",[t("code",[s._v("--vm-driver")]),s._v(" 如果不写会自动检测，可选值 virtualbox, vmwarefusion, hyperv, vmware")]),s._v(" "),t("li",[t("code",[s._v("--image-mirror-country")]),s._v(" 需要使用的镜像镜像的国家/地区代码。留空以使用全球代码。对于中国大陆用户，请将其设置为 cn。")]),s._v(" "),t("li",[t("code",[s._v("--image-repository")]),s._v("用来拉取 Kubernetes 集群所需镜像的仓库")]),s._v(" "),t("li",[t("code",[s._v("--iso-url")]),s._v("下载 minikube 虚机安装所需的 iso 文件")]),s._v(" "),t("li",[t("code",[s._v("--registry-mirror docker registry")]),s._v("的镜像源，集群安装后拉取镜像加速用，可以使用其它加速器地址")])]),s._v(" "),t("p",[s._v("这里的虚机配置对应的选项：\n--cpu=2\n--memory='2000mb\n--disk-size='20000m'")]),s._v(" "),t("p",[s._v("preloaded-images-k8s-v1-v1.17.3-docker-overlay2.tar.lz4: https://storage.googleapis.com/minikube-preloaded-volume-tarballs/preloaded-images-k8s-v1-v1.17.3-docker-overlay2.tar.lz4")]),s._v(" "),t("hr"),s._v(" "),t("p",[t("strong",[s._v("之后启动可以这样就可以")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("minikube start --image-mirror-country"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cn --registry-mirror"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.docker-cn.com\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## or ")]),s._v("\nminikube start --vm-driver"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("virtualbox --image-mirror-country"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cn --registry-mirror"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://reg-mirror.qiniu.com\n\nminikube start --image-mirror-country"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn'")]),s._v(" --image-repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'registry.cn-hangzhou.aliyuncs.com/google_containers'")]),s._v("\n\nminikube start --image-repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers --image-mirror-country"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cn --extra-config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubelet.cgroup-driver"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("systemd\n\n")])])]),t("h2",{attrs:{id:"图形化管理界面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#图形化管理界面"}},[s._v("#")]),s._v(" 图形化管理界面")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("minikube dashboard\n")])])]),t("h3",{attrs:{id:"外网访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#外网访问"}},[s._v("#")]),s._v(" 外网访问")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("minikube dashboard --url\n-----\n* 正在验证 dashboard 运行情况 ...\n* Launching proxy ...\n* 正在验证 proxy 运行状况 ...\nhttp://127.0.0.1:40593/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\n")])])]),t("p",[s._v("开启端口访问")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("kubectl proxy --port=40593 --address='0.0.0.0' --accept-hosts='^.*' &\n")])])]),t("p",[s._v("访问,假如你的远程ip地址是：192.168.3.10")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://192.168.3.10:40593/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\n")])])]),t("h2",{attrs:{id:"master、node、pod、service、关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master、node、pod、service、关系"}},[s._v("#")]),s._v(" master、node、pod、service、关系")]),s._v(" "),t("p",[t("img",{staticStyle:{width:"50%",height:"50%"},attrs:{src:"https://kuboard.cn/assets/img/module_03_nodes.38f0ef71.svg"}}),s._v(" "),t("img",{attrs:{src:"https://kuboard.cn/assets/img/module_04_services.11cdc7bc.svg"}})]),s._v(" "),t("p",[s._v("master管理node")]),s._v(" "),t("p",[s._v("node中存放pod")]),s._v(" "),t("p",[s._v("pod是一组（相似的）容器")]),s._v(" "),t("p",[s._v("service去关联 pod ，也就是pod和pod之间沟通的桥梁")]),s._v(" "),t("h2",{attrs:{id:"node"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node"}},[s._v("#")]),s._v(" node")]),s._v(" "),t("h2",{attrs:{id:"pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[s._v("#")]),s._v(" pod")]),s._v(" "),t("p",[s._v("进入一个pod")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it busybox-pod "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n")])])]),t("h2",{attrs:{id:"service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[s._v("#")]),s._v(" service")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("将一个pod暴露到公网IP上")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl expose pods nginx-pod --type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#metadata.name = nginx-pod")]),s._v("\n")])])]),t("p",[s._v("访问：node_Ip:expose_Ip  //http://192.168.99.105:30696")])])]),s._v(" "),t("h2",{attrs:{id:"deployments"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deployments"}},[s._v("#")]),s._v(" Deployments")]),s._v(" "),t("p",[s._v("更新服务")]),s._v(" "),t("blockquote",[t("p",[s._v("当前：nginx:1.0")])]),s._v(" "),t("h3",{attrs:{id:"创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[s._v("#")]),s._v(" 创建")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl create -f deployment-nginx.yml\n")])])]),t("h3",{attrs:{id:"查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[s._v("#")]),s._v(" 查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get deployment\n\nkubectl get deployment -o wide\n")])])]),t("blockquote",[t("p",[s._v("升级为：nginx:2.0")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployment nginx-deployment "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:2.0\n")])])]),t("p",[t("code",[s._v("nginx-deployment")]),s._v(" 为 "),t("code",[s._v("deployment-nginx.yml")]),s._v(" 文件定义的，不是文件名")]),s._v(" "),t("blockquote",[t("p",[s._v("回滚：nginx:1.0")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl rollout undo deployment nginx-deployemnt\n")])])]),t("p",[s._v("查看历史回滚记录")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl rollout "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" deployment nginx-deployment\n")])])]),t("h3",{attrs:{id:"暴露端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#暴露端口"}},[s._v("#")]),s._v(" 暴露端口")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("kubectl expose deployment nginx-deplyment --type=NodePort\n")])])]),t("h3",{attrs:{id:"删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[s._v("#")]),s._v(" 删除")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl delete services nginx-deployment\n")])])]),t("h2",{attrs:{id:"k8s网络"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#k8s网络"}},[s._v("#")]),s._v(" K8s网络")]),s._v(" "),t("h2",{attrs:{id:"service-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service-2"}},[s._v("#")]),s._v(" service")]),s._v(" "),t("h2",{attrs:{id:"监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控"}},[s._v("#")]),s._v(" 监控")]),s._v(" "),t("blockquote"),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L git.io/scope -o /usr/local/bin/scope\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/scope\n\nscope launch ip地址\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);