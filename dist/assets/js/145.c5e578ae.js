(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{656:function(e,a,t){"use strict";t.r(a);var s=t(11),r=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("blockquote",[t("p",[e._v("æœ¬æ–‡ç”± "),t("a",{attrs:{href:"http://ksria.com/simpread/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ç®€æ‚¦ SimpRead"),t("OutboundLink")],1),e._v(" è½¬ç ï¼Œ åŸæ–‡åœ°å€ "),t("a",{attrs:{href:"https://segmentfault.com/a/1190000021165798",target:"_blank",rel:"noopener noreferrer"}},[e._v("segmentfault.com"),t("OutboundLink")],1)])]),e._v(" "),t("h1",{attrs:{id:"å…³äº-laravelé¡¹ç›®å¤šè¿›ç¨‹é˜Ÿåˆ—é…ç½®çš„ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…³äº-laravelé¡¹ç›®å¤šè¿›ç¨‹é˜Ÿåˆ—é…ç½®çš„ä½¿ç”¨"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"/a/1190000021165798"}},[e._v("å…³äº Laravelé¡¹ç›®å¤šè¿›ç¨‹é˜Ÿåˆ—é…ç½®çš„ä½¿ç”¨")])]),e._v(" "),t("p",[e._v("[![][img-0]å‘å¸ƒäº 2019-12-02")]),e._v(" "),t("h2",{attrs:{id:"å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[e._v("#")]),e._v(" å‰è¨€:")]),e._v(" "),t("p",[e._v("è¿‘æœŸéšç€é˜Ÿåˆ—åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨è¶Šæ¥è¶Šå¤š,å•ä¸ªé˜Ÿåˆ—çš„æ—¶é—´å‡ºæ¥è¶Šæ¥è¶Šé•¿,å•è¿›ç¨‹é˜Ÿåˆ—å¤„ç†,ä¼šå¯¼è‡´åé¢çš„é˜Ÿåˆ—è¢«é˜»å¡ä½,æ— æ³•åŠæ—¶å“åº”å¤„ç†ï¼Œä¾¿ä¼šé€ æˆä¸è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’ŒåŠŸèƒ½åå·®ã€‚")]),e._v(" "),t("h2",{attrs:{id:"é—®é¢˜åˆ†æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜åˆ†æ"}},[e._v("#")]),e._v(" é—®é¢˜åˆ†æ")]),e._v(" "),t("p",[e._v("ç›®å‰åœ¨æˆ‘ä»¬ä½¿ç”¨çš„Laravelé¡¹ç›®ä¸­,ä½¿ç”¨çš„å¹¿æ’­æœåŠ¡æ˜¯redis,æ¯æ¬¡å‘å®¢æˆ·ç«¯å¹¿æ’­ä¸€æ¬¡,éƒ½ä¼šç”Ÿæˆä¸€æ¡Queue,å‡è®¾æ¯ä¸ªQueueçš„æ‰§è¡Œæ—¶é—´æ˜¯1ç§’,å‡è®¾ç”¨æˆ·æ‰§è¡Œä»¥ä¸‹æ“ä½œ:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("//æ¨é€å³æ—¶ç‚¹èµæé†’ 1s\ndispatch(new NewLike($like));\n//æ¨é€å³æ—¶è¯„è®ºæé†’ 1s\ndispatch(new NewComment($comment));\n//æ¨é€å³æ—¶å›å¤æé†’ 1s\ndispatch(new NewReply($reply));\n//æ¨é€å³æ—¶é€šçŸ¥æé†’ 1s\ndispatch(new NewNotite($notice));\n//æ¨é€å³æ—¶æ¶ˆæ¯æé†’ 1s\ndispatch(new NewMessage($message));\n")])])]),t("p",[e._v("ä»¥ä¸Šæ¯ä¸ªæ¨é€éƒ½å°†ä¼šè€—æ—¶1ç§’ä»¥ä¸Š,5ä¸ªé€šçŸ¥æ‰§è¡Œå®Œæˆåˆ™éœ€è¦5ç§’,å‡è®¾ç³»ç»Ÿæ¯å¤©äº§ç”Ÿ10000æ¬¡æ¨é€,åˆ™å¤„ç†æ¨é€çš„æ—¶é—´10000 / 60 / 60 = 2.8(å°æ—¶),åˆ™ç³»ç»Ÿåˆ™éœ€è¦èŠ±è´¹2.8ä¸ªå°æ—¶æ‰èƒ½å°†æ¶ˆæ¯å…¨éƒ¨æ¨é€å®Œæˆ,å¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†ç”¨æˆ·æ— æ³•åŠæ—¶æ¨é€,ä»è€Œå¯¹APPä½“éªŒäº§ç”Ÿåæ„Ÿã€‚")]),e._v(" "),t("p",[e._v("éšç€ç³»ç»Ÿæ¨é€è¶Šæ¥è¶Šå¤š,å•è¿›ç¨‹é˜Ÿåˆ—ä»¥åŠæ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚,æ­¤æ—¶ä¾¿éœ€è¦å¼€å¯å¤šä¸ªé˜Ÿåˆ—æ¶ˆè´¹è€…æ¥è¿›è¡Œå¤„ç†ã€‚")]),e._v(" "),t("h2",{attrs:{id:"è§£å†³æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è§£å†³æ–¹æ¡ˆ"}},[e._v("#")]),e._v(" è§£å†³æ–¹æ¡ˆ")]),e._v(" "),t("p",[e._v("å¼€å¯å¤šä¸ªé˜Ÿåˆ—æ¶ˆè´¹è€…,å°±éœ€è¦ä½¿ç”¨åˆ°å¤šçº¿ç¨‹,æ¯ä¸ªä¸€ä¸ª"),t("code",[e._v("queue:work")]),e._v("éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹,è¿è¡Œå¤šä¸ª"),t("code",[e._v("queue:work")]),e._v("è¿›ç¨‹å°±å¯ä»¥è¾¾åˆ°åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„æ•ˆæœã€‚")]),e._v(" "),t("p",[e._v("è¯´äº†é‚£ä¹ˆå¤š,ä¸Šä¸ªä»£ç æµ‹è¯•ä¸€ä¸‹ã€‚")]),e._v(" "),t("h3",{attrs:{id:"_1-æ–°å»ºä¸€ä¸ªjob"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ–°å»ºä¸€ä¸ªjob"}},[e._v("#")]),e._v(" 1.æ–°å»ºä¸€ä¸ªJOB")]),e._v(" "),t("p",[e._v("é€šè¿‡artisanå‘½ä»¤åˆ›å»º")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("art make:job TestJob\n")])])]),t("p",[e._v("å®Œå–„ä¸€ä¸‹Jobçš„ä¸»è¦é€»è¾‘:å»¶è¿Ÿ1ç§’å°†ä¼ å…¥çš„IDå†™å…¥åˆ°æ—¥å¿—åˆ°ä¸­ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<?php\n\nnamespace App\\Jobs;\n\nuse Illuminate\\Bus\\Queueable;\nuse Illuminate\\Contracts\\Queue\\ShouldQueue;\nuse Illuminate\\Foundation\\Bus\\Dispatchable;\nuse Illuminate\\Queue\\InteractsWithQueue;\nuse Illuminate\\Queue\\SerializesModels;\n\nclass TestJob implements ShouldQueue\n{\n    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;\n\n    public $id;\n\n    /**\n     * Create a new job instance.\n     *\n     * @return void\n     */\n    public function __construct($id)\n    {\n        $this->id = $id;\n    }\n\n    /**\n     * Execute the job.\n     *\n     * @return void\n     */\n    public function handle()\n    {\n        sleep(1);\n        info($this->id);\n    }\n}\n\n")])])]),t("h3",{attrs:{id:"_2-å¡«å……æµ‹è¯•æ•°æ®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¡«å……æµ‹è¯•æ•°æ®"}},[e._v("#")]),e._v(" 2.å¡«å……æµ‹è¯•æ•°æ®")]),e._v(" "),t("p",[e._v("æˆ‘æœ¬åœ°ç¯å¢ƒä½¿ç”¨çš„jobæ˜¯åŸºäºmysql database,ç›®å‰å…ˆå¡«å……10000ä¸ªjobè¿›å»ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("for ($i = 0; $i < 10000; $i++) {\n    dispatch(new TestJob($i));\n}\n\ndd('done');\n")])])]),t("h3",{attrs:{id:"_3-è¿è¡Œ-æµ‹è¯•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-è¿è¡Œ-æµ‹è¯•"}},[e._v("#")]),e._v(" 3.è¿è¡Œ && æµ‹è¯•")]),e._v(" "),t("p",[e._v("é’ˆå¯¹è¿™10000ä¸ªjob,æˆ‘æœ¬åœ°è¿è¡Œäº†ä¸¤ä¸ª"),t("code",[e._v("queue:work")]),e._v("è¿›ç¨‹æ¥è¿›è¡ŒåŒæ—¶å¤„ç†ã€‚")]),e._v(" "),t("p",[e._v("ç”±äºæœ¬åœ°è¿è¡Œæµ‹è¯•,ä¸ºäº†æ–¹ä¾¿,ä¾¿æŠŠsleepç§»é™¤äº†ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ•ˆæœã€‚")]),e._v(" "),t("p",[e._v("10000ä¸ªjobå¾ˆå¿«å°±è¢«ä¸¤ä¸ª"),t("code",[e._v("queue:work")]),e._v("å¤„ç†å®Œæˆäº†ã€‚")]),e._v(" "),t("p",[e._v("è¿è¡Œå®Œæˆå,æœ€æ‹…å¿ƒçš„é—®é¢˜è«è¿‡äº,é˜Ÿåˆ—ä»»åŠ¡æ˜¯å¦ä¼šè¢«å¦ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œé‡å¤æ‰§è¡Œ?")]),e._v(" "),t("p",[e._v("ç­”æ¡ˆå°±æ˜¯:ä¸ä¼š,é™¤éæ˜¯å…¶ä¸­ä¸€ä¸ªä»»åŠ¡å¤„ç†è¶…æ—¶(timeout)æ‰ä¼šæœ‰å¯èƒ½è¢«å…¶ä»–é˜Ÿåˆ—è¿›ç¨‹é‡å¤æ‰§è¡Œåˆ°,å…³äºä¸ºä»€ä¹ˆä¸ä¼š,ä¸‹æ¬¡å°†ä¼šé€šè¿‡å†™ä¸€ç¯‡æºç è§£ææ¥ä¸ºå¤§å®¶æ­æ™“ã€‚")]),e._v(" "),t("h3",{attrs:{id:"_4-ä¼˜åŒ–åˆ°supervisorä¸­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ä¼˜åŒ–åˆ°supervisorä¸­"}},[e._v("#")]),e._v(" 4.ä¼˜åŒ–åˆ°Supervisorä¸­")]),e._v(" "),t("p",[e._v("é€šå¸¸åœ¨æœåŠ¡ç«¯æˆ‘ä»¬ä½¿ç”¨çš„é˜Ÿåˆ—è¿›ç¨‹ç®¡ç†å·¥å…·ä¸€åŠéƒ½æ˜¯Supervisor,çŸ¥é“ä¸Šé¢éœ€è¦å¼€å¯å¤šä¸ªè¿›ç¨‹å¤„ç†å,éƒ¨åˆ†åŒå­¦ä¾¿è®¤ä¸ºåªéœ€è¦æ·»åŠ å¤šä¸ªconfé…ç½®æ–‡ä»¶,å°±å®Œæˆå•¦ã€‚")]),e._v(" "),t("p",[e._v("ä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦æ·»åŠ çš„é˜Ÿåˆ—è¿›ç¨‹ä»2ä¸ªå˜æˆ8ä¸ªã€10ä¸ªã€20ä¸ªã€32ä¸ªã€64ä¸ªã€‚ã€‚ã€‚éšç€éœ€è¦å¤„ç†çš„è¶Šæ¥è¶Šå¤š,å²‚ä¸æ˜¯éœ€è¦æ·»åŠ nä¸ªé…ç½®æ–‡ä»¶æ¥ä¿æŒå¤šè¿›ç¨‹é˜Ÿåˆ—è¿è¡Œã€‚")]),e._v(" "),t("p",[e._v("å…¶å®ä¸æ˜¯è¿™æ ·çš„,Supervisoræ—©å°±åšåˆ°äº†è¿™ä¸€ç‚¹,å¯ä»¥é€šè¿‡"),t("strong",[e._v("numprocs")]),e._v("æ¥æ§åˆ¶è¿›ç¨‹æ•°é‡è¿›è¡Œå¤„ç†,ä½ å¯ä»¥æ ¹æ®æœåŠ¡ç«¯è´Ÿè½½æƒ…å†µ,æ¥åŠ¨æ€è°ƒæ•´è¿›ç¨‹æ•°é‡,é…ç½®å¦‚ä¸‹:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[program:laravel-queue-work]\nprocess_name=%(program_name)s_%(process_num)02d\ndirectory=/data/yoursite\ncommand=php artisan queue:work\nautostart=true\nautorestart=true\nuser=www\nnumprocs=32\nredirect_stderr=true\n")])])]),t("p",[e._v("ä¸Šé¢çš„æ¡ˆä¾‹ä¸­å°±å¼€å¯äº†32ä¸ªè¿›ç¨‹è¿›è¡ŒåŒæ—¶å¤„ç†äº†jobã€‚")]),e._v(" "),t("h2",{attrs:{id:"ç»“è®º"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“è®º"}},[e._v("#")]),e._v(" ç»“è®º")]),e._v(" "),t("p",[e._v("ä»¥ä¸Šå°±å®Œæˆlaravelé¡¹ç›®å¤šè¿›ç¨‹é˜Ÿåˆ—çš„é…ç½®ä½¿ç”¨,åŒæ—¶ä»"),t("code",[e._v("queue:work")]),e._v("è¾“å‡ºå’Œæ—¥å¿—çš„å†™å…¥æ¥çœ‹,å¤šä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œ,ä¹Ÿå¹¶ä¸ä¼šé€ æˆé˜Ÿåˆ—é‡å¤æ‰§è¡Œçš„é—®é¢˜,å¯ä»¥æ”¾å¿ƒä½¿ç”¨ğŸ˜ğŸ˜")]),e._v(" "),t("p",[t("a",{attrs:{href:"/t/laravel"}},[e._v("laravel")]),t("a",{attrs:{href:"/t/php"}},[e._v("php")]),t("a",{attrs:{href:"/t/%E9%98%9F%E5%88%97"}},[e._v("é˜Ÿåˆ—")]),t("a",{attrs:{href:"/t/supervisor"}},[e._v("supervisor")]),t("a",{attrs:{href:"/t/%E5%A4%9A%E8%BF%9B%E7%A8%8B"}},[e._v("å¤šè¿›ç¨‹")]),e._v("é˜…è¯» 6.1kå‘å¸ƒäº 2019-12-02 èµ5æ”¶è—3"),t("a",{attrs:{href:"###"}},[e._v("åˆ†äº«")]),e._v("æœ¬ä½œå“ç³»åŸåˆ›ï¼Œ"),t("a",{attrs:{href:"https://creativecommons.org/licenses/by-nc-nd/4.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("é‡‡ç”¨ã€Šç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…ã€‹è®¸å¯åè®®"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("[img-0]:data:application/json;base64,eyJjb2RlIjo0MDAxMDAzOCwibXNnIjoidW5rbm93biB0aHVtYi1jbWQiLCJpZCI6IjI5MTg5MzdiLTQzMmUtNDMzNi04OTNlLTI3NzY2MWJjNWFhMSJ9")])])}),[],!1,null,null,null);a.default=r.exports}}]);