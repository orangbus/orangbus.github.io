(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{550:function(t,s,a){"use strict";a.r(s);var n=a(11),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"docker虚拟机常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker虚拟机常用命令"}},[t._v("#")]),t._v(" Docker虚拟机常用命令")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("先更新软件包")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum -y update\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Docker虚拟机")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y docker\n")])])])]),t._v(" "),a("li",[a("p",[t._v("运行、重启、关闭Docker虚拟机")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" docker start\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" docker start\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" docker stop\n")])])])]),t._v(" "),a("li",[a("p",[t._v("搜索镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker search 镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("下载镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker pull 镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker images\n")])])])]),t._v(" "),a("li",[a("p",[t._v("删除镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker rmi 镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("运行容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker run 启动参数  镜像名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看容器列表")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -a\n")])])])]),t._v(" "),a("li",[a("p",[t._v("停止、挂起、恢复容器")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker stop 容器ID\ndocker pause 容器ID\ndocker unpase 容器ID\n")])])]),a("ol",{attrs:{start:"11"}},[a("li",[a("p",[t._v("查看容器信息")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker inspect 容器ID\n")])])])]),t._v(" "),a("li",[a("p",[t._v("删除容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 容器ID\n")])])])]),t._v(" "),a("li",[a("p",[t._v("数据卷管理")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker volume create 数据卷名称  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷")]),t._v("\ndocker volume "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 数据卷名称  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除数据卷")]),t._v("\ndocker volume inspect 数据卷名称  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看数据卷")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("网络管理")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker network "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" 查看网络信息\ndocker network create --subnet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("网段 网络名称\ndocker network "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 网络名称\n")])])])]),t._v(" "),a("li",[a("p",[t._v("避免VM虚拟机挂起恢复之后，Docker虚拟机断网")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/sysctl.conf\n")])])]),a("p",[t._v("文件中添加"),a("code",[t._v("net.ipv4.ip_forward=1")]),t._v("这个配置")]),t._v(" "),a("p",[t._v("​"),a("code",[t._v("shell #重启网络服务 systemctl restart network ​")])])])]),t._v(" "),a("h2",{attrs:{id:"安装pxc集群，负载均衡，双机热备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装pxc集群，负载均衡，双机热备"}},[t._v("#")]),t._v(" 安装PXC集群，负载均衡，双机热备")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("安装PXC镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker pull percona/percona-xtradb-cluster\n")])])])]),t._v(" "),a("li",[a("p",[t._v("为PXC镜像改名")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker tag percona/percona-xtradb-cluster pxc\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建net1网段")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker network create --subnet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.0/16 net1\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建5个数据卷")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker volume create --name v1\ndocker volume create --name v2\ndocker volume create --name v3\ndocker volume create --name v4\ndocker volume create --name v5\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建备份数据卷（用于热备份数据）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker volume create --name backup\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建5节点的PXC集群")]),t._v(" "),a("p",[t._v("注意，每个MySQL容器创建之后，因为要执行PXC的初始化和加入集群等工作，耐心等待1分钟左右再用客户端连接MySQL。另外，必须第1个MySQL节点启动成功，用MySQL客户端能连接上之后，再去创建其他MySQL节点。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第1个MySQL节点")]),t._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -v v1:/var/lib/mysql -v backup:/data --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第2个MySQL节点")]),t._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3307")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v2:/var/lib/mysql -v backup:/data --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node2 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.3 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第3个MySQL节点")]),t._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3308")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v3:/var/lib/mysql --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node3 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.4 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第4个MySQL节点")]),t._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3309")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v4:/var/lib/mysql --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node4 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.5 pxc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第5个MySQL节点")]),t._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3310")]),t._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PXC -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("XTRABACKUP_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLUSTER_JOIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1 -v v5:/var/lib/mysql -v backup:/data --privileged --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node5 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.6 pxc\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Haproxy镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker pull haproxy\n")])])])]),t._v(" "),a("li",[a("p",[t._v("宿主机上编写Haproxy配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /home/soft/haproxy.cfg\n")])])]),a("p",[t._v("配置文件如下：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[t._v("global\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#工作目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tchroot")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/etc/haproxy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志文件，使用rsyslog服务中local5日志设备（/var/log/local5），等级info")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tlog")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1 local5 info")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#守护进程运行")]),t._v("\n\tdaemon\n\ndefaults\n\tlog\tglobal\n\tmode\thttp\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志格式")]),t._v("\n\toption\thttplog\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志中不记录负载均衡的心跳检测记录")]),t._v("\n\toption\tdontlognull\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #连接超时（毫秒）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\ttimeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("connect 5000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #客户端超时（毫秒）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\ttimeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("client  50000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#服务器超时（毫秒）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("server  50000")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#监控界面\t")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" admin_stats")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#监控界面的访问的IP和端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tbind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 0.0.0.0:8888")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#访问协议")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    mode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       http")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#URI相对地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    stats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("uri   /dbs")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#统计报告格式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    stats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("realm     Global\\ statistics")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#登陆帐户信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    stats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("auth  admin:abc123456")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#数据库负载均衡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" proxy-mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#访问的IP和端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tbind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 0.0.0.0:3306  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #网络协议")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tmode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" tcp")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#负载均衡算法（轮询算法）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#轮询算法：roundrobin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#权重算法：static-rr")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#最少连接算法：leastconn")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#请求源IP算法：source ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    balance")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" roundrobin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#日志格式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    option")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" tcplog")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#在MySQL中创建一个没有权限的haproxy用户，密码为空。Haproxy使用这个账户对MySQL数据库心跳检测")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    option")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" mysql-check user haproxy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_1 172.18.0.2:3306 check weight 1 maxconn 2000  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_2 172.18.0.3:3306 check weight 1 maxconn 2000  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_3 172.18.0.4:3306 check weight 1 maxconn 2000 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_4 172.18.0.5:3306 check weight 1 maxconn 2000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" MySQL_5 172.18.0.6:3306 check weight 1 maxconn 2000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\t#使用keepalive检测死链")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    option")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" tcpka  ")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建两个Haproxy容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第1个Haproxy负载均衡服务器")]),t._v("\ndocker run -it -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4001")]),t._v(":8888 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4002")]),t._v(":3306 -v /home/soft/haproxy:/usr/local/etc/haproxy --name h1 --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.7 haproxy\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h1容器，启动Haproxy")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\nhaproxy -f /usr/local/etc/haproxy/haproxy.cfg\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建第2个Haproxy负载均衡服务器")]),t._v("\ndocker run -it -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4003")]),t._v(":8888 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4004")]),t._v(":3306 -v /home/soft/haproxy:/usr/local/etc/haproxy --name h2 --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net1 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.8 haproxy\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h2容器，启动Haproxy")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\nhaproxy -f /usr/local/etc/haproxy/haproxy.cfg\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Haproxy容器内安装Keepalived，设置虚拟IP")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h1容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件（参考下方配置文件）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机执行ping命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201\n")])])]),a("p",[t._v("配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vrrp_instance  VI_1 {\n    state  MASTER\n    interface  eth0\n    virtual_router_id  51\n    priority  100\n    advert_int  1\n    authentication {\n        auth_type  PASS\n        auth_pass  123456\n    }\n    virtual_ipaddress {\n        172.18.0.201\n    }\n}\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入h2容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it h2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机执行ping命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201\n")])])]),a("p",[t._v("配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance  VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state  MASTER\n    interface  eth0\n    virtual_router_id  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type  PASS\n        auth_pass  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("宿主机安装Keepalived，实现双击热备")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机执行安装Keepalived")]),t._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改Keepalived配置文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("p",[t._v("Keepalived配置文件如下：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       \t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.150\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.150 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr \n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.150 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr \n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.201 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("热备份数据")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入node1容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it node1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装热备工具")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" percona-xtrabackup-24\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#全量热备")]),t._v("\ninnobackupex --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 /data/backup/full\n")])])])]),t._v(" "),a("li",[a("p",[t._v("冷还原数据\n停止其余4个节点，并删除节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker stop node2\ndocker stop node3\ndocker stop node4\ndocker stop node5\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node2\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node3\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node4\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" node5\n")])])]),a("p",[t._v("node1容器中删除MySQL的数据")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf /var/lib/mysql/*\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#清空事务")]),t._v("\ninnobackupex --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 --apply-back /data/backup/full/2018-04-15_05-09-07/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#还原数据")]),t._v("\ninnobackupex --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("abc123456 --copy-back  /data/backup/full/2018-04-15_05-09-07/\n")])])]),a("p",[t._v("重新创建其余4个节点，组件PXC集群")])])]),t._v(" "),a("h2",{attrs:{id:"安装redis，配置rediscluster集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装redis，配置rediscluster集群"}},[t._v("#")]),t._v(" 安装Redis，配置RedisCluster集群")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("安装Redis镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker pull yyyyttttwwww/redis\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建net2网段")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker network create --subnet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.0/16 net2\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建6节点Redis容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker run -it -d --name r1 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5001")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.2 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\ndocker run -it -d --name r2 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5002")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.3 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\ndocker run -it -d --name r3 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5003")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.4 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\ndocker run -it -d --name r4 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5004")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.5 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\ndocker run -it -d --name r5 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5005")]),t._v(":6379 --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("net2 --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.6 redis "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("启动6节点Redis服务器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r1节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r2节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r3节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r4节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r4 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r5节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r5 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入r6节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it r6 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/redis/redis.conf /usr/redis/redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/redis.conf\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建Cluster集群")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在r1节点上执行下面的指令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/redis/src\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/cluster\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" redis-trib.rb "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/cluster/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/cluster\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建Cluster集群")]),t._v("\n./redis-trib.rb create --replicas "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.2:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.3:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.4:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.5:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.6:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.19")]),t._v(".0.7:6379\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"打包部署后端项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包部署后端项目"}},[t._v("#")]),t._v(" 打包部署后端项目")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("进入人人开源后端项目，执行打包（修改配置文件，更改端口，打包三次生成三个JAR文件）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("mvn clean "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -Dmaven.test.skip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Java镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker pull java\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建3节点Java容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷，上传JAR文件")]),t._v("\ndocker volume create j1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动容器")]),t._v("\ndocker run -it -d --name j1 -v j1:/home/soft --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host java\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入j1容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it j1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Java项目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" java -jar /home/soft/renren-fast.jar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷，上传JAR文件")]),t._v("\ndocker volume create j2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动容器")]),t._v("\ndocker run -it -d --name j2 -v j2:/home/soft --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host java\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入j1容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it j2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Java项目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" java -jar /home/soft/renren-fast.jar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建数据卷，上传JAR文件")]),t._v("\ndocker volume create j3\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动容器")]),t._v("\ndocker run -it -d --name j3 -v j3:/home/soft --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host java\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入j1容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it j3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Java项目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" java -jar /home/soft/renren-fast.jar\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装Nginx镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker pull nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建Nginx容器，配置负载均衡")]),t._v(" "),a("p",[t._v("宿主机上/home/n1/nginx.conf配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" nginx;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("worker_processes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("error_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/error.log warn;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pid")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       /var/run/nginx.pid;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("events")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    worker_connections")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1024;")]),t._v("\n}\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      /etc/nginx/mime.types;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    default_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" application/octet-stream;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    log_format")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("                      '$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('$body_bytes_sent "$http_referer" \'')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('                      \'"$http_user_agent"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"$http_x_forwarded_for"\';')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    access_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/access.log  main;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    sendfile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       on;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #tcp_nopush     on;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    keepalive_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 65;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #gzip  on;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_redirect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("         off;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       Host $host;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Real-IP $remote_addr;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Forwarded-For $proxy_add_x_forwarded_for;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("   10m;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_body_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  128k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_connect_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_send_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_read_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       4k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("          4 32k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_busy_buffers_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 64k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_temp_file_write_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("64k;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tupstream")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tomcat {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6001;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6002;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6003;")]),t._v("\n\t}\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      6101;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        server_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 192.168.99.104; ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/ {  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  http://tomcat;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" index.html index.htm;  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        }")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" ")]),t._v("\n    }\n}\n")])])]),a("p",[t._v("创建第1个Nginx节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker run -it -d --name n1 -v /home/n1/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n\n")])])]),a("p",[t._v("宿主机上/home/n2/nginx.conf配置文件内容如下：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" nginx;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("worker_processes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("error_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/error.log warn;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("pid")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       /var/run/nginx.pid;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("events")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    worker_connections")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 1024;")]),t._v("\n}\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      /etc/nginx/mime.types;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    default_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" application/octet-stream;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    log_format")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("                      '$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('$body_bytes_sent "$http_referer" \'')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('                      \'"$http_user_agent"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"$http_x_forwarded_for"\';')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    access_log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" /var/log/nginx/access.log  main;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    sendfile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       on;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #tcp_nopush     on;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    keepalive_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 65;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #gzip  on;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_redirect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("         off;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       Host $host;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Real-IP $remote_addr;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       X-Forwarded-For $proxy_add_x_forwarded_for;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("   10m;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tclient_body_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  128k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_connect_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_send_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_read_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     5s;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("       4k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("          4 32k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_busy_buffers_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 64k;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tproxy_temp_file_write_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("64k;")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tupstream")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("tomcat {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6001;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6002;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\t\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("192.168.99.104:6003;")]),t._v("\n\t}\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("\tserver")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("      6102;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        server_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" 192.168.99.104; ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/ {  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("  http://tomcat;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("            index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" index.html index.htm;  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("        }")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v(" ")]),t._v("\n    }\n}\n")])])]),a("p",[t._v("创建第2个Nginx节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker run -it -d --name n2 -v /home/n2/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("在Nginx容器安装Keepalived")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入n1节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it n1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vrrp_instance VI_1 {\n    state MASTER\n    interface ens33\n    virtual_router_id 51\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass 123456\n    }\n    virtual_ipaddress {\n        192.168.99.151\n    }\n}\nvirtual_server 192.168.99.151 6201 {\n    delay_loop 3\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout 50\n    protocol TCP\n    real_server 192.168.99.104 6101 {\n        weight 1\n    }\n}\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入n1节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it n2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6201")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6102")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"打包部署后端项目-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包部署后端项目-2"}},[t._v("#")]),t._v(" 打包部署后端项目")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在前端项目路径下执行打包指令")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build\n")])])])]),t._v(" "),a("li",[a("p",[t._v("build目录的文件拷贝到宿主机的/home/fn1/renren-vue、/home/fn2/renren-vue、/home/fn3/renren-vue的目录下面")])]),t._v(" "),a("li",[a("p",[t._v("创建3节点的Nginx，部署前端项目")]),t._v(" "),a("p",[t._v("宿主机/home/fn1/nginx.conf的配置文件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('user  nginx;\nworker_processes  1;\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\t\n\tproxy_redirect          off;\n\tproxy_set_header        Host $host;\n\tproxy_set_header        X-Real-IP $remote_addr;\n\tproxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n\tclient_max_body_size    10m;\n\tclient_body_buffer_size   128k;\n\tproxy_connect_timeout   5s;\n\tproxy_send_timeout      5s;\n\tproxy_read_timeout      5s;\n\tproxy_buffer_size        4k;\n\tproxy_buffers           4 32k;\n\tproxy_busy_buffers_size  64k;\n\tproxy_temp_file_write_size 64k;\n\t\n\tserver {\n\t\tlisten 6501;\n\t\tserver_name  192.168.99.104;\n\t\tlocation  /  {\n\t\t\troot  /home/fn1/renren-vue;\n\t\t\tindex  index.html;\n\t\t}\n\t}\n}\n')])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动第fn1节点")]),t._v("\ndocker run -it -d --name fn1 -v /home/fn1/nginx.conf:/etc/nginx/nginx.conf -v /home/fn1/renren-vue:/home/fn1/renren-vue --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host nginx\n")])])]),a("p",[t._v("宿主机/home/fn2/nginx.conf的配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(" - "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v('] "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\""),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v('" "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for")]),t._v("\"'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlisten "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6502")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tlocation  /  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\troot  /home/fn2/renren-vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tindex  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动第fn2节点")]),t._v("\ndocker run -it -d --name fn2 -v /home/fn2/nginx.conf:/etc/nginx/nginx.conf -v /home/fn2/renren-vue:/home/fn2/renren-vue --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host nginx\n")])])]),a("p",[t._v("宿主机/home/fn3/nginx.conf的配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(" - "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v('] "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\""),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v('" "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for")]),t._v("\"'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlisten "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tlocation  /  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\troot  /home/fn3/renren-vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tindex  index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("启动fn3节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动第fn3节点")]),t._v("\ndocker run -it -d --name fn3 -v /home/fn3/nginx.conf:/etc/nginx/nginx.conf -v /home/fn3/renren-vue:/home/fn3/renren-vue --privileged --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置负载均衡")]),t._v(" "),a("p",[t._v("宿主机/home/ff1/nginx.conf配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(" - "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v('] "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\""),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v('" "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for")]),t._v("\"'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tupstream fn "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6501"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6502"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6503"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6601")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            proxy_pass   http://fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动ff1节点")]),t._v("\ndocker run -it -d --name ff1 -v /home/ff1/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n")])])]),a("p",[t._v("宿主机/home/ff2/nginx.conf配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("user  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nerror_log  /var/log/nginx/error.log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid        /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(" - "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v('] "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v("\" '")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\""),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v('" "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for")]),t._v("\"'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\t\n\tproxy_redirect          off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_max_body_size    10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tclient_body_buffer_size   128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_connect_timeout   5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_send_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_read_timeout      5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffer_size        4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_buffers           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_busy_buffers_size  64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\n\tupstream fn "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6501"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6502"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104:6503"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6602")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            proxy_pass   http://fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动ff2节点")]),t._v("\ndocker run -it -d --name ff2 -v /home/ff2/nginx.conf:/etc/nginx/nginx.conf --net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("host --privileged nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置双机热备")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入ff1节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it ff1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.152\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6701")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6601")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入ff1节点")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it ff2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新软件包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装VIM")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" keepalived\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑Keepalived配置文件(如下)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/keepalived/keepalived.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动Keepalived")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" keepalived start\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("vrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.152\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvirtual_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.151 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6701")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    delay_loop "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    lb_algo rr\n    lb_kind NAT\n    persistence_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    protocol TCP\n    real_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".99.104 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6602")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);