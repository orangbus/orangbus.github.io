(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{655:function(e,t,r){"use strict";r.r(t);var n=r(11),a=Object(n.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("原文地址: "),r("a",{attrs:{href:"https://www.jianshu.com/p/3ffd27b64847",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.jianshu.com/p/3ffd27b64847"),r("OutboundLink")],1)]),e._v(" "),r("ol",[r("li",[e._v("HTTPS基本介绍")])]),e._v(" "),r("hr"),e._v(" "),r("p",[e._v("现在各大厂商都在推行HTTPS，比如谷歌要求多个顶级域名要用HTTPS来加密，苹果要求开发者全部采用HTTPS等等。那什么是HTTPS呢？其实HTTPS只是HTTP的一个拓展，是在HTTP的基础上利用SSL/TLS来加密数据包的。工作流程如下：")]),e._v(" "),r("p",[r("img",{attrs:{src:"//upload-images.jianshu.io/upload_images/1925988-da4fcfc67e55df9d.gif",alt:""}}),e._v(" An overview of the SSL or TLS handshake")]),e._v(" "),r("blockquote",[r("p",[e._v("图片来自IBM Knowledge Center: "),r("a",{attrs:{href:"https://www.ibm.com/support/knowledgecenter/en/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660_.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("An overview of the SSL or TLS handshake"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("注意第(2)步Server给Client发送了一个Server certificates，这个里面包含有Server的一些信息，如域名、公司信息、序列号和签名信息组成等，这个证书可以个人生成，也可以由权威机构签发，当然个人的就不受大众信任，而权威机构签发的证书则会被信任。")]),e._v(" "),r("blockquote",[r("p",[e._v("具体的可以参考："),r("a",{attrs:{href:"https://www.barretlee.com/blog/2016/04/24/detail-about-ca-and-certs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("细说 CA 和证书"),r("OutboundLink")],1)])]),e._v(" "),r("ol",{attrs:{start:"2"}},[r("li",[e._v("Let’s Encrypt")])]),e._v(" "),r("hr"),e._v(" "),r("p",[e._v("CA的证书提供商有许多个，有收费的有免费的，而"),r("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Let’s Encrypt"),r("OutboundLink")],1),e._v("就是其中之一的免费提供商。")]),e._v(" "),r("h3",{attrs:{id:"_2-1-如何获取let-s-encript的证书呢？"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-如何获取let-s-encript的证书呢？"}},[e._v("#")]),e._v(" 2.1 如何获取Let's Encript的证书呢？")]),e._v(" "),r("p",[e._v("要从Let's Encript获取某个域名的证书，需要证明那你对该域名拥有控制权，对于该证明你可以使用某个使用"),r("a",{attrs:{href:"https://ietf-wg-acme.github.io/acme/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ACME"),r("OutboundLink")],1),e._v("协议的软件来实现，而Certbot就是官方出的一个ACME客户端。")]),e._v(" "),r("ol",{attrs:{start:"3"}},[r("li",[e._v("Certbot介绍")])]),e._v(" "),r("hr"),e._v(" "),r("p",[e._v("先介绍一些Certbot相关概念。")]),e._v(" "),r("h3",{attrs:{id:"_3-1-authenticators和installers"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-authenticators和installers"}},[e._v("#")]),e._v(" 3.1 Authenticators和Installers")]),e._v(" "),r("p",[e._v("Certbot支持两种类型的plugin，一种是用来获取证书的，称为"),r("strong",[e._v("Authenticators")]),e._v("；另外一种是用来安装证书的，称为"),r("strong",[e._v("Installers")]),e._v("。有的plugin支持一种，有的两种都支持，如nginx。")]),e._v(" "),r("blockquote",[r("p",[e._v("安装证书：自动修改配置文件，如修改nginx的某个"),r("code",[e._v(".conf")]),e._v("文件")])]),e._v(" "),r("p",[e._v("Authenticators plugin使用"),r("code",[e._v("certonly")]),e._v("命令来获取证书，而Installers plugin使用"),r("code",[e._v("install")]),e._v("命令来安装证书。")]),e._v(" "),r("h3",{attrs:{id:"_3-2-plugin说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-plugin说明"}},[e._v("#")]),e._v(" 3.2 plugin说明")]),e._v(" "),r("p",[e._v("下面列举几个常用的plugin作简要说明：")]),e._v(" "),r("ol",[r("li",[r("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#webroot",target:"_blank",rel:"noopener noreferrer"}},[e._v("Webroot"),r("OutboundLink")],1),e._v("：本地有运行webserver并且有能力修改其配置，就可以用该种方式（创建隐藏文件"),r("code",[e._v(".well-known")]),e._v("），获取证书时无需暂停webserver的运行。")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#standalone",target:"_blank",rel:"noopener noreferrer"}},[e._v("Standalone"),r("OutboundLink")],1),e._v("：服务器未运行webserver可以使用该方式，要保持80或443端口开放。")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#nginx",target:"_blank",rel:"noopener noreferrer"}},[e._v("Nginx"),r("OutboundLink")],1),e._v("：自动获取和安装证书（自动修改配置文件）。")])]),e._v(" "),r("h3",{attrs:{id:"_3-3-certbot使用流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-certbot使用流程"}},[e._v("#")]),e._v(" 3.3 Certbot使用流程")]),e._v(" "),r("p",[e._v("Certbot的使用包含以下几个部分：")]),e._v(" "),r("ol",[r("li",[e._v("安装Certbot")]),e._v(" "),r("li",[e._v("生成证书")]),e._v(" "),r("li",[e._v("配置Web Server")]),e._v(" "),r("li",[e._v("更新证书")])]),e._v(" "),r("h4",{attrs:{id:"_3-3-1-certbot安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-certbot安装"}},[e._v("#")]),e._v(" 3.3.1 Certbot安装")]),e._v(" "),r("p",[e._v("安装Certbot参考："),r("a",{attrs:{href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Certbot"),r("OutboundLink")],1),e._v("，直接选择软件和操作系统即可。")]),e._v(" "),r("h4",{attrs:{id:"_3-3-2-获取证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-获取证书"}},[e._v("#")]),e._v(" 3.3.2 获取证书")]),e._v(" "),r("p",[e._v("使用"),r("code",[e._v("certbot certonly")]),e._v("命令然后根据提示操作即可。")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("[root@efd140d6210b /]# certbot certonly\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\n\nHow would you like to authenticate with the ACME CA?\n-------------------------------------------------------------------------------\n1: Spin up a temporary webserver (standalone)\n2: Place files in webroot directory (webroot)\n-------------------------------------------------------------------------------\nSelect the appropriate number [1-2] then [enter] (press 'c' to cancel): \n")])])]),r("blockquote",[r("p",[e._v("对于nginx可以使用"),r("code",[e._v("certbot --nginx")]),e._v("来获取和安装证书。")])]),e._v(" "),r("p",[e._v("获取完之后可以通过"),r("code",[e._v("certbot certificates")]),e._v("命令查看证书：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("root@node01:~# certbot certificates\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\n\n-------------------------------------------------------------------------------\nFound the following certs:\n  Certificate Name: www.youdomain.com\n    Domains: www.youdomain.com\n    Expiry Date: 2018-09-03 02:08:54+00:00 (VALID: 89 days)\n    Certificate Path: /etc/letsencrypt/live/www.youdomain.com/fullchain.pem\n    Private Key Path: /etc/letsencrypt/live/www.youdomain.com/privkey.pem\n------------------------------------------------------------------------------- \n")])])]),r("h4",{attrs:{id:"_3-3-3-配置web-server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-配置web-server"}},[e._v("#")]),e._v(" 3.3.3 配置Web Server")]),e._v(" "),r("p",[e._v("不同Web Server的配置方式不同，这里以Nginx为例，在配置文件"),r("code",[e._v("youdomain.conf")]),e._v("中添加：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("server {\n    listen [::]:80;\n\n    root /var/www/youdomain;\n    index index.html index.htm;\n\n    server_name www.yourdomain.com;\n\n    charset utf-8;\n    \n    #.................\n\n    listen 443 ssl; \nssl_certificate /etc/letsencrypt/live/www.yourdomain.com/fullchain.pem; \nssl_certificate_key /etc/letsencrypt/live/www.yourdomain.com/privkey.pem; \n\n} \n")])])]),r("blockquote",[r("p",[e._v("需要了解Nginx的使用")])]),e._v(" "),r("p",[e._v("配置完之后更新配置即可("),r("code",[e._v("nginx -s reload")]),e._v(")，到这里证书配置就完成了，正常情况下该域名HTTPS就可以访问了。")]),e._v(" "),r("h4",{attrs:{id:"_3-3-4-更新证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-更新证书"}},[e._v("#")]),e._v(" 3.3.4 更新证书")]),e._v(" "),r("p",[e._v("由于Let’s Encrypt颁发的证书的有效期只有90天，这就需要更新证书。")]),e._v(" "),r("blockquote",[r("p",[r("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#renewing-certificates",target:"_blank",rel:"noopener noreferrer"}},[e._v("Renewing certificates"),r("OutboundLink")],1)])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("certbot renew \n")])])]),r("blockquote",[r("p",[e._v("如果使用了nginx plugin，则更新时需要使用"),r("code",[e._v("certbot renew --quiet --installer node")]),e._v("，否则会自动安装证书导致错误。")])]),e._v(" "),r("h3",{attrs:{id:"_3-4-certbot常用命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-certbot常用命令"}},[e._v("#")]),e._v(" 3.4 Certbot常用命令")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// perform a test run\ncertbot certonly --dry-run\ncertbot renew --dry-run\n// 显示证书信息\ncertbot certificates\n// 撤销证书\ncertbot revoke --cert-path /etc/letsencrypt/live/CERTNAME/cert.pem\n// 删除证书（撤销之后使用）\ncertbot delete --cert-name example.com \n")])])]),r("blockquote",[r("p",[e._v("如果证书是测试的如"),r("code",[e._v("--staging")]),e._v("，撤销时也要加上。")])]),e._v(" "),r("h3",{attrs:{id:"_3-5-certbort其他功能"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-certbort其他功能"}},[e._v("#")]),e._v(" 3.5 Certbort其他功能")]),e._v(" "),r("h4",{attrs:{id:"_3-5-1-泛域名支持"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-1-泛域名支持"}},[e._v("#")]),e._v(" 3.5.1 泛域名支持")]),e._v(" "),r("p",[e._v("可以使用"),r("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#dns-plugins",target:"_blank",rel:"noopener noreferrer"}},[e._v("DNS Plugins"),r("OutboundLink")],1),e._v("来实现。")]),e._v(" "),r("blockquote",[r("p",[r("a",{attrs:{href:"https://blog.csdn.net/shasharoman/article/details/79615023",target:"_blank",rel:"noopener noreferrer"}},[e._v("Let's Encrypt泛域名证书"),r("OutboundLink")],1)])]),e._v(" "),r("h2",{attrs:{id:"reference"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[e._v("#")]),e._v(" Reference")]),e._v(" "),r("ol",[r("li",[r("a",{attrs:{href:"https://www.ibm.com/support/knowledgecenter/en/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660_.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("An overview of the SSL or TLS handshake"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://letsencrypt.org/getting-started/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Let's Encript Getting Started"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://certbot.eff.org/docs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Certbot documentation"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://linuxstory.org/deploy-lets-encrypt-ssl-certificate-with-certbot/",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTPS 简介及使用官方工具 Certbot 配置 Let’s Encrypt SSL 安全证书详细教程"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("作者：keith666"),r("br"),e._v("\n链接：https://www.jianshu.com/p/3ffd27b64847"),r("br"),e._v("\n来源：简书"),r("br"),e._v("\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。")])])}),[],!1,null,null,null);t.default=a.exports}}]);