(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{622:function(s,t,a){"use strict";a.r(t);var e=a(11),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"一、安装percona数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装percona数据库"}},[s._v("#")]),s._v(" 一、安装Percona数据库")]),s._v(" "),a("h2",{attrs:{id:"_1-离线安装percona"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-离线安装percona"}},[s._v("#")]),s._v(" 1. 离线安装Percona")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("进入RPM安装文件目录，执行下面的脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum localinstall *.rpm\n")])])])]),s._v(" "),a("li",[a("p",[s._v("管理MySQL服务")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start mysqld\nsystemctl stop mysqld\nsystemctl restart mysqld\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-在线安装percona"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-在线安装percona"}},[s._v("#")]),s._v(" 2. 在线安装Percona")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("使用yum命令安装")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm\nyum  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("  Percona-Server-server-57\n")])])])]),s._v(" "),a("li",[a("p",[s._v("管理MySQL服务")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql start\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql stop\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_3-开放防火墙端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-开放防火墙端口"}},[s._v("#")]),s._v(" 3. 开放防火墙端口")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("firewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp --permanent\nfirewall-cmd --reload\n")])])]),a("h2",{attrs:{id:"_4-修改mysql配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改mysql配置文件"}},[s._v("#")]),s._v(" 4. 修改MySQL配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/my.cnf\n")])])]),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[mysqld]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("character_set_server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" utf8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("bind-address")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 0.0.0.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#跳过DNS解析")]),s._v("\nskip-name-resolve\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart \n")])])]),a("h2",{attrs:{id:"_5-禁止开机启动mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-禁止开机启动mysql"}},[s._v("#")]),s._v(" 5. 禁止开机启动MySQL")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" mysqld off\n")])])]),a("h2",{attrs:{id:"_6-初始化mysql数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-初始化mysql数据库"}},[s._v("#")]),s._v(" 6. 初始化MySQL数据库")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("查看MySQL初始密码")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/log/mysqld.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A temporary password"')]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改MySQL密码")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysql_secure_installation\n")])])])]),s._v(" "),a("li",[a("p",[s._v("创建远程管理员账户")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysql -u root -p\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Abc_123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFLUSH "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h1",{attrs:{id:"二、创建pxc集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、创建pxc集群"}},[s._v("#")]),s._v(" 二、创建PXC集群")]),s._v(" "),a("h2",{attrs:{id:"_1-删除mariadb程序包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-删除mariadb程序包"}},[s._v("#")]),s._v(" 1. 删除MariaDB程序包")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum -y remove mari*\n")])])]),a("h2",{attrs:{id:"_2-开放防火墙端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-开放防火墙端口"}},[s._v("#")]),s._v(" 2. 开放防火墙端口")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("firewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp --permanent\nfirewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4444")]),s._v("/tcp --permanent\nfirewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4567")]),s._v("/tcp --permanent\nfirewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4568")]),s._v("/tcp --permanent\n")])])]),a("h2",{attrs:{id:"_3-关闭selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-关闭selinux"}},[s._v("#")]),s._v(" 3. 关闭SELINUX")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/selinux/config\n")])])]),a("p",[s._v("把SELINUX属性值设置成disabled")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])])]),a("h2",{attrs:{id:"_4-离线安装pxc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-离线安装pxc"}},[s._v("#")]),s._v(" 4. 离线安装PXC")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("进入RPM文件目录，执行安装命令")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum localinstall *.rpm\n")])])])]),s._v(" "),a("li",[a("p",[s._v("参考第一章内容，修改MySQL配置文件、创建账户等操作")])])]),s._v(" "),a("h2",{attrs:{id:"_5-创建pxc集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建pxc集群"}},[s._v("#")]),s._v(" 5. 创建PXC集群")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("停止MySQL服务")])]),s._v(" "),a("li",[a("p",[s._v("修改每个PXC节点的/etc/my.cnf文件（在不同节点上，注意调整文件内容）")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("server-id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1  #PXC集群中MySQL实例的唯一ID，不能重复，必须是数字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("wsrep_provider")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("/usr/lib64/galera3/libgalera_smm.so")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("wsrep_cluster_name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("pxc-cluster  #PXC集群的名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("wsrep_cluster_address")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("gcomm://192.168.99.151,192.168.99.159,192.168.99.215")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("wsrep_node_name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("pxc1  #当前节点的名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("wsrep_node_address")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("192.168.99.151  #当前节点的IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("wsrep_sst_method")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("xtrabackup-v2  #同步方法（mysqldump、rsync、xtrabackup）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("wsrep_sst_auth")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" admin:Abc_123456  #同步使用的帐户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("pxc_strict_mode")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("ENFORCING  #同步严厉模式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("binlog_format")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("ROW  #基于ROW复制（安全可靠）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("default_storage_engine")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("InnoDB  #默认引擎")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("innodb_autoinc_lock_mode")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("2  #主键自增长不锁表")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("主节点的管理命令（第一个启动的PXC节点）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start mysql@bootstrap.service\nsystemctl stop mysql@bootstrap.service\nsystemctl restart mysql@bootstrap.service\n")])])])]),s._v(" "),a("li",[a("p",[s._v("非主节点的管理命令（非第一个启动的PXC节点）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" start mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" stop mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" restart mysql\n")])])])]),s._v(" "),a("li",[a("p",[s._v("查看PXC集群状态信息")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show status like 'wsrep_cluster%' ;\n")])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("按照上述配置方法，创建两组PXC集群")])])])]),s._v(" "),a("h2",{attrs:{id:"_6-pxc节点启动与关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-pxc节点启动与关闭"}},[s._v("#")]),s._v(" 6. PXC节点启动与关闭")]),s._v(" "),a("ul",[a("li",[s._v("如果最后关闭的PXC节点是安全退出的，那么下次启动要最先启动这个节点，而且要以主节点启动")]),s._v(" "),a("li",[s._v("如果最后关闭的PXC节点不是安全退出的，那么要先修改"),a("code",[s._v("/var/lib/mysql/grastate.dat")]),s._v(" 文件，把其中的"),a("code",[s._v("safe_to_bootstrap")]),s._v("属性值设置为1，再安装主节点启动")])]),s._v(" "),a("h1",{attrs:{id:"三、安装mycat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、安装mycat"}},[s._v("#")]),s._v(" 三、安装MyCat")]),s._v(" "),a("h2",{attrs:{id:"_1-jdk安装与配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-jdk安装与配置"}},[s._v("#")]),s._v(" 1. JDK安装与配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装JDK")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#搜索JDK版本")]),s._v("\nyum search jdk \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装JDK1.8开发版")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" java-1.8.0-openjdk-devel.x86_64\n")])])])]),s._v(" "),a("li",[a("p",[s._v("配置环境变量")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看JDK安装路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lrt /etc/alternatives/java\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/profile\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在文件结尾加上JDK路径，例如export  JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.171-8.b10.el7_5.x86_64/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("  /etc/profile \n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-创建数据表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建数据表"}},[s._v("#")]),s._v(" 2. 创建数据表")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在两组PXC集群中分别创建t_user数据表")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE TABLE t_user(\n\tid INT UNSIGNED PRIMARY KEY,\n    username VARCHAR(200) NOT NULL,\n    password VARCHAR(2000) NOT NULL,\n    tel CHAR(11) NOT NULL,\n    locked TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,\n    INDEX idx_username(username) USING BTREE,\n    UNIQUE INDEX unq_username(username) USING BTREE\n);\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_3-mycat安装与配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-mycat安装与配置"}},[s._v("#")]),s._v(" 3. MyCat安装与配置")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("下载MyCat")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://dl.mycat.io/1.6.5/Mycat-server-1.6.5-release-20180122220033-linux.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://dl.mycat.io/1.6.5/Mycat-server-1.6.5-release-20180122220033-linux.tar."),a("OutboundLink")],1),a("a",{attrs:{href:"http://dl.mycat.io/1.6.5/Mycat-server-1.6.5-release-20180122220033-linux.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("gz"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("上传MyCat压缩包到虚拟机")])]),s._v(" "),a("li",[a("p",[s._v("安装unzip程序包，解压缩MyCat")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" MyCAT压缩包名称\n")])])])]),s._v(" "),a("li",[a("p",[s._v("开放防火墙8066和9066端口，关闭SELINUX")])]),s._v(" "),a("li",[a("p",[s._v("修改MyCat的bin目录中所有.sh文件的权限")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("chmod -R 777 ./*.sh\n")])])])]),s._v(" "),a("li",[a("p",[s._v("MyCat启动与关闭")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cd MyCat的bin目录")]),s._v("\n./startup_nowrap.sh "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动MyCat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -aux "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看系统进程")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 MyCat进程编号\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改server.xml文件，设置MyCat帐户和虚拟逻辑库")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("?xml "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("encoding")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),s._v("?"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE mycat:server SYSTEM "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server.dtd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mycat:server xmlns:mycat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://io.mycat/"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("system"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nonePasswordLogin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"useHandshakeV10"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"useSqlStat"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"useGlobleTableCheck"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sequnceHandlerType"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subqueryRelationshipCheck"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("false"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"processorBufferPoolType"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"handleDistributedTransactions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"useOffHeapForMerge"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n      \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"memoryPageSize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("64k"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spillsFileBufferSize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("1k"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"useStreamOutput"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemReserveMemorySize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("384m"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"useZKSwitch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("false"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/system"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--这里是设置的admin用户和虚拟逻辑库--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("defaultAccount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Abc_12345"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"schemas"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/mycat:server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改schema.xml文件，设置数据库连接和虚拟数据表")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("?xml "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),s._v("?"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE mycat:schema SYSTEM "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"schema.dtd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mycat:schema xmlns:mycat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://io.mycat/"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--配置数据表--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("schema "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("checkSQLschema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sqlMaxLimit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("table "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t_user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataNode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dn1,dn2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mod-long"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/schema"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--配置分片关系--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dataNode "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dn1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataHost")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dataNode "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dn2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataHost")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--配置连接信息--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dataHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxCon")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minCon")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("balance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v(" \n                "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("writeType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dbType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dbDriver")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("switchType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("  \n                "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slaveThreshold")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("heartbeat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("select user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/heartbeat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("writeHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.151:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                     "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W1R1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.159:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W1R2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.215:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/writeHost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("writeHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.159:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                     "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W2R1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.151:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W2R2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.215:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/writeHost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/dataHost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dataHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxCon")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("minCon")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("balance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v(" \n                "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("writeType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dbType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dbDriver")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("switchType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("  \n                "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slaveThreshold")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("heartbeat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("select user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/heartbeat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("writeHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.121:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n  \t\t\t\t   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W1R1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.122:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W1R2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.123:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/writeHost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("writeHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.122:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n  \t\t\t\t   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W2R1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.121:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("readHost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"W2R2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.123:3306"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v(" /"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/writeHost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/dataHost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/mycat:schema"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改rule.xml文件，把mod-long的count值修改成2")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("function "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mod-long"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.mycat.route.function.PartitionByMod"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("property "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v("<")]),s._v("/property"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/function"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("重启MyCat")])]),s._v(" "),a("li",[a("p",[s._v("向t_user表写入数据，感受数据的切分")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("USE test;\n#第一条记录被切分到第二个分片\nINSERT INTO t_user(id,username,password,tel,locked) VALUES(1,\"A\",HEX(AES_ENCRYPT('123456','HelloWorld')));\n#第二条记录被切分到第一个分片\nINSERT INTO t_user(id,username,password,tel,locked) VALUES(2,\"B\",HEX(AES_ENCRYPT('123456','HelloWorld')));\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_4-配置父子表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置父子表"}},[s._v("#")]),s._v(" 4. 配置父子表")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("在conf目录下创建"),a("code",[s._v("customer-hash-int")]),s._v("文件，内容如下：")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("103")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("104")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("105")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("106")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("在rule.xml文件中加入自定义"),a("code",[s._v("<function>")]),s._v("和"),a("code",[s._v("<tableRule>")])]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("customer-hash-int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("io.mycat.route.function.PartitionByFileMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mapFile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("customer-hash-int.txt"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("tableRule")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("sharding-customer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("columns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sharding_id"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("columns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("algorithm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("customer-hash-int"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("algorithm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("tableRule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改schema.xml文件，添加父子表定义")]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("table")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("t_customer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dataNode")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("dn1,dn2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("sharding-customer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("childTable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("t_orders"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("primaryKey")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("joinKey")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("customer_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" \t\n                "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("parentKey")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("在MyCat上执行如下SQL：")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("USE test;\nCREATE TABLE t_customer(\n\tid INT UNSIGNED PRIMARY KEY,\n    username VARCHAR(200) NOT NULL,\n    sharding_id INT NOT NULL\n);\nCREATE TABLE t_orders(\n\tid INT UNSIGNED PRIMARY KEY,\n    customer_id INT NOT NULL,\n    datetime TIMESTAMP DEFAULT CURRENT_TIMSTAMP\n);\n")])])])]),s._v(" "),a("li",[a("p",[s._v("向t_customer表和t_orders表写入数据，查看字表数据跟随父表切分到同一个分片")])])]),s._v(" "),a("h2",{attrs:{id:"_5-创建双机热备的mycat集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建双机热备的mycat集群"}},[s._v("#")]),s._v(" 5. 创建双机热备的MyCat集群")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("用两个虚拟机实例，各自部署MyCat")])]),s._v(" "),a("li",[a("p",[s._v("用一个虚拟机实例部署Haproxy")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装Haproxy")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y haproxy\n")])])])]),s._v(" "),a("li",[a("p",[s._v("编辑配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/haproxy/haproxy.cfg\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("global\n    log         127.0.0.1 local2\n    chroot      /var/lib/haproxy\n    pidfile     /var/run/haproxy.pid\n    maxconn     4000\n    user        haproxy\n    group       haproxy\n    daemon\n    # turn on stats unix socket\n    stats socket /var/lib/haproxy/stats\n\ndefaults\n    mode                    http\n    log                     global\n    option                  httplog\n    option                  dontlognull\n    option http-server-close\n    option forwardfor       except 127.0.0.0/8\n    option                  redispatch\n    retries                 3\n    timeout http-request    10s\n    timeout queue           1m\n    timeout connect         10s\n    timeout client          1m\n    timeout server          1m\n    timeout http-keep-alive 10s\n    timeout check           10s\n    maxconn                 3000\n\nlisten   admin_stats  \n    bind    0.0.0.0:4001\n    mode  http\n    stats uri       /dbs\n    stats realm  Global\\ statistics\n    stats auth    admin:abc123456\nlisten   proxy-mysql\n    bind    0.0.0.0:3306  \n    mode  tcp \n    balance  roundrobin\n    option  tcplog       #日志格式\n    server   mycat_1  192.168.99.131:3306  check  port  8066  maxconn  2000  \n    server   mycat_2  192.168.99.132:3306  check  port  8066  maxconn  2000  \n    option  tcpka        #使用keepalive检测死链\n")])])])]),s._v(" "),a("li",[a("p",[s._v("启动Haproxy")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" haproxy start\n")])])])]),s._v(" "),a("li",[a("p",[s._v("访问Haproxy监控画面")]),s._v(" "),a("p",[s._v("http://192.168.99.131:4001/dbs")])])])]),s._v(" "),a("li",[a("p",[s._v("用另外一个虚拟机同样按照上述操作安装Haproxy")])]),s._v(" "),a("li",[a("p",[s._v("在某个Haproxy虚拟机实例上部署Keepalived")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("开启防火墙的VRRP协议")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启VRRP")]),s._v("\nfirewall-cmd --direct --permanent --add-rule ipv4 filter INPUT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" --protocol  vrrp -j ACCEPT\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#应用设置")]),s._v("\nfirewall-cmd --reload\n")])])])]),s._v(" "),a("li",[a("p",[s._v("安装Keepalived")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y keepalived\n")])])])]),s._v(" "),a("li",[a("p",[s._v("编辑配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/keepalived/keepalived.conf\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vrrp_instance  VI_1 {\n    state  MASTER\n    interface  ens33\n    virtual_router_id  51\n    priority  100\n    advert_int  1\n    authentication {\n        auth_type  PASS\n        auth_pass  123456\n    }\n    virtual_ipaddress {\n        192.168.99.133\n    }\n}\n")])])])]),s._v(" "),a("li",[a("p",[s._v("启动Keepalived")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" keepalived start\n")])])])]),s._v(" "),a("li",[a("p",[s._v("ping 192.168.99.133")])])])]),s._v(" "),a("li",[a("p",[s._v("在另外一个Haproxy虚拟机上，按照上述方法部署Keepalived")])]),s._v(" "),a("li",[a("p",[s._v("使用MySQL客户端连接192.168.99.133，执行增删改查数据")])])]),s._v(" "),a("h1",{attrs:{id:"四、sysbench基准测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、sysbench基准测试"}},[s._v("#")]),s._v(" 四、Sysbench基准测试")]),s._v(" "),a("h2",{attrs:{id:"_1-安装sysbench"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装sysbench"}},[s._v("#")]),s._v(" 1. 安装Sysbench")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在线安装")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -s https://packagecloud.io/install/\nrepositories/akopytov/sysbench/script.rpm.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" \n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" sysbench\n")])])])]),s._v(" "),a("li",[a("p",[s._v("本地安装")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("下载压缩文件")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://codeload.github.com/akopytov/sysbench/zip/1.0",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://"),a("OutboundLink")],1),a("a",{attrs:{href:"https://codeload.github.com/akopytov/sysbench/zip/1.0",target:"_blank",rel:"noopener noreferrer"}},[s._v("codeload.github.com/akopytov/sysbench/zip/1.0"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("安装依赖包")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y automake libtool\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y mysql-devel\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行安装")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cd sysbench")]),s._v("\n./autogen.sh \n./configure \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\nsysbench --version\n")])])])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-执行测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-执行测试"}},[s._v("#")]),s._v(" 2. 执行测试")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("准备测试库")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sysbench  /usr/share/sysbench/tests/include/oltp_legacy/oltp.lua --mysql-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.131 --mysql-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" --mysql-user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin --mysql-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Abc_123456 --oltp-tables-count"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" --oltp-table-size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v(" prepare\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行测试")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sysbench  /usr/share/sysbench/tests/include/oltp_legacy/oltp.lua --mysql-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.131 --mysql-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" --mysql-user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin --mysql-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Abc_123456 --oltp-test-mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("complex --threads"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" --time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" --report-interval"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /home/mysysbench.log\n")])])])]),s._v(" "),a("li",[a("p",[s._v("清理数据")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sysbench /usr/share/sysbench/tests/include/oltp_legacy/oltp.lua --mysql-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.131 --mysql-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" --mysql-user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin --mysql-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Abc_123456 --oltp-tables-count"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" cleanup\n")])])])])]),s._v(" "),a("h1",{attrs:{id:"五、tpcc-mysql-压力测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、tpcc-mysql-压力测试"}},[s._v("#")]),s._v(" 五、tpcc-mysql 压力测试")]),s._v(" "),a("h2",{attrs:{id:"_1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备工作"}},[s._v("#")]),s._v(" 1. 准备工作")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("修改my.cnf配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/my.cnf\n")])])]),a("p",[s._v("pxc_strict_mode=DISABLED")])]),s._v(" "),a("li",[a("p",[s._v("修改某个Haproxy的配置文件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server   mysql_1  192.168.99.151:3306  check  port  3306  weight  1  maxconn  2000\nserver   mysql_2  192.168.99.159:3306  check  port  3306  weight  1  maxconn  2000\nserver   mysql_3  192.168.99.215:3306  check  port  3306  weight  1  maxconn  2000\n")])])])]),s._v(" "),a("li",[a("p",[s._v("重新启动Haproxy")])]),s._v(" "),a("li",[a("p",[s._v("安装依赖程序包")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y gcc\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y mysql-devel\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-安装tpcc-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装tpcc-mysql"}},[s._v("#")]),s._v(" 2. 安装tpcc-mysql")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("下载压缩包")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://codeload.github.com/Percona-Lab/tpcc-mysql/zip/master",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://codeload.github.com/Percona-Lab/tpcc-mysql/zip/"),a("OutboundLink")],1),a("a",{attrs:{href:"https://codeload.github.com/Percona-Lab/tpcc-mysql/zip/master",target:"_blank",rel:"noopener noreferrer"}},[s._v("master"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("执行安装")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cd tpcc的src目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行"),a("code",[s._v("create_table.sql")]),s._v("和"),a("code",[s._v("add_fkey_idx.sql")]),s._v("两个文件")])]),s._v(" "),a("li",[a("p",[s._v("执行数据初始化")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./tpcc_load -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.131 -d tpcc -u admin -p Abc_123456 -w\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行压力测试")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./tpcc_start -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.131 -d tpcc -u admin -p Abc_123456 -w "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" -r "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" -l "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("tpcc-output-log\n")])])])])]),s._v(" "),a("h1",{attrs:{id:"六、导入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、导入数据"}},[s._v("#")]),s._v(" 六、导入数据")]),s._v(" "),a("h2",{attrs:{id:"_1-生成1000万条数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-生成1000万条数据"}},[s._v("#")]),s._v(" 1. 生成1000万条数据")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileWriter")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BufferedWriter")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tdef "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" writer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileWriter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:/data.txt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" buff"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BufferedWriter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("writer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tbuff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('",测试数据\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\tbuff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close\n\t\twriter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"_2-执行文件切分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-执行文件切分"}},[s._v("#")]),s._v(" 2. 执行文件切分")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("上传data.txt文件到linux")])]),s._v(" "),a("li",[a("p",[s._v("执行文件切分")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),s._v(" -l "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v(" -d data.txt\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_3-准备数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-准备数据库"}},[s._v("#")]),s._v(" 3. 准备数据库")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("每个PXC分片只开启一个节点")])]),s._v(" "),a("li",[a("p",[s._v("修改PXC节点文件，然后重启PXC服务")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("innodb_flush_log_at_trx_commit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("innodb_flush_method")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" O_DIRECT")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("innodb_buffer_pool_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 200M")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("创建t_test数据表")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE TABLE t_test(\n\tid INT UNSIGNED PRIMARY KEY,\n    name VARCHAR(200) NOT NULL\n);\n")])])])]),s._v(" "),a("li",[a("p",[s._v("配置MyCat")]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("table")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("t_test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dataNode")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("dn1,dn2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mod-long"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dataHost")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("cluster1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("maxCon")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("1000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("minCon")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("balance")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("writeType")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dbType")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dbDriver")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("native"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("switchType")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("slaveThreshold")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("heartbeat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("select user()"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("heartbeat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("writeHost")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("W1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("192.168.99.151:3306"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" \n               "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("Abc_123456"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dataHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dataHost")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("cluster2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("maxCon")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("1000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("minCon")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("balance")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("writeType")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dbType")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dbDriver")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("native"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("switchType")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("slaveThreshold")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("heartbeat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("select user()"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("heartbeat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("writeHost")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("W1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("192.168.99.121:3306"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" \n               "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("Abc_123456"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dataHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_4-执行java程序，多线程导入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-执行java程序，多线程导入数据"}},[s._v("#")]),s._v(" 4. 执行Java程序，多线程导入数据")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("eclipse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xtend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Accessors")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DriverManager")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Accessors")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),s._v(" file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\n\toverride "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jdbc:mysql://192.168.99.131:8066/test"')]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abc_123456"')]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" con"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DriverManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" sql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n\t\t\tload data local intfile "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/data/«file.name»'")]),s._v(" ignore into table t_test \n\t\t\tcharacter set "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf8'")]),s._v(" \n\t\t\tfields terminated by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" optionally enclosed by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\\"'")]),s._v(" \n\t\t\tlines terminated by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" pst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("con"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("prepareStatement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\tpst"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("execute\n\t\tcon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close\n\t\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoadData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateNum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Driver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DriverManager")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concurrent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concurrent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concurrent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoadData")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" end"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" pool"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tdef "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DriverManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerDriver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" folder"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/data"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" files"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("folder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("listFiles\n\t\tend"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//线程池结束条件")]),s._v("\n\t\tfiles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("forEach"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("one"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" task"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Task")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\ttask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("one"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\tpool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" def "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateNum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tnum"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("end"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tpool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"执行结束"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h1",{attrs:{id:"七、大数据归档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、大数据归档"}},[s._v("#")]),s._v(" 七、大数据归档")]),s._v(" "),a("h2",{attrs:{id:"_1-安装tokudb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装tokudb"}},[s._v("#")]),s._v(" 1. 安装TokuDB")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装jemlloc")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y jemalloc \n")])])])]),s._v(" "),a("li",[a("p",[s._v("编辑配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/my.cnf\n")])])]),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v("……\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[mysqld_safe]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("malloc-lib")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("/usr/lib64/libjemalloc.so.1")]),s._v("\n……\n")])])])]),s._v(" "),a("li",[a("p",[s._v("重启MySQL")])]),s._v(" "),a("li",[a("p",[s._v("开启Linux大页内存")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" never "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /sys/kernel/mm/transparent_hugepage/enabled\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" never "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /sys/kernel/mm/transparent_hugepage/defrag\n")])])])]),s._v(" "),a("li",[a("p",[s._v("安装TokuDB")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y Percona-Server-tokudb-57.x86_64\nps-admin --enable -uroot -p\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\nps-admin --enable -uroot -p\n")])])])]),s._v(" "),a("li",[a("p",[s._v("查看安装结果")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show engines ;\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-配置replication集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置replication集群"}},[s._v("#")]),s._v(" 2. 配置Replication集群")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在两个TokuDB数据库上创建用户")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE USER 'backup'@'%' IDENTIFIED BY 'Abc_123456' ;\n")])])]),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("GRANT super, reload, replication slave ON *.* TO 'backup'@'%' ;\n")])])]),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("FLUSH  PRIVILEGES ;\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改两个TokuDB的配置文件，如下：")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[mysqld]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("server_id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 101")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("log_bin")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" mysql_bin")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("relay_log")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" relay_bin")]),s._v("\n……\n")])])]),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[mysqld]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("server_id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 102")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("log_bin")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" mysql_bin")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("relay_log")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" relay_bin")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("重新启动两个TokuDB节点")])]),s._v(" "),a("li",[a("p",[s._v("分别在两个TokuDB上执行下面4句SQL")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#关闭同步服务\nstop slave;\n#设置同步的Master节点\nchange master to master_host="192.168.99.155",master_port=3306,master_user="backup",\nmaster_password="Abc_123456";\n#启动同步服务\nstart slave;\n#查看同步状态\nshow slave status;\n')])])]),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#关闭同步服务\nstop slave;\n#设置同步的Master节点\nchange master to master_host="192.168.99.102",master_port=3306,master_user="backup",\nmaster_password="Abc_123456";\n#启动同步服务\nstart slave;\n#查看同步状态\nshow slave status;\n')])])])])]),s._v(" "),a("h2",{attrs:{id:"_3-创建归档表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建归档表"}},[s._v("#")]),s._v(" 3. 创建归档表")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE TABLE t_purchase (\n\tid INT UNSIGNED PRIMARY KEY,\n\tpurchase_price DECIMAL(10,2) NOT NULL,\n\tpurchase_num INT UNSIGNED NOT NULL,\n\tpurchase_sum DECIMAL (10,2) NOT NULL,\n\tpurchase_buyer INT UNSIGNED NOT NULL,\n\tpurchase_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tcompany_id INT UNSIGNED NOT NULL,\n\tgoods_id INT UNSIGNED NOT NULL,\n\tKEY idx_company_id(company_id),\n\tKEY idx_goods_id(goods_id)\n)engine=TokuDB;\n")])])]),a("h2",{attrs:{id:"_4-配置haproxy-keepalived双机热备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置haproxy-keepalived双机热备"}},[s._v("#")]),s._v(" 4. 配置Haproxy+Keepalived双机热备")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在两个节点上安装Haproxy")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y haproxy\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/haproxy/haproxy.cfg\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("global\n    log         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 local2\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chroot")]),s._v("      /var/lib/haproxy\n    pidfile     /var/run/haproxy.pid\n    maxconn     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v("\n    user        haproxy\n    group       haproxy\n    daemon\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# turn on stats unix socket")]),s._v("\n    stats socket /var/lib/haproxy/stats\n\ndefaults\n    mode                    http\n    log                     global\n    option                  httplog\n    option                  dontlognull\n    option http-server-close\n    option forwardfor       except "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.0/8\n    option                  redispatch\n    retries                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-request    10s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" queue           1m\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" connect         10s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" client          1m\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" server          1m\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" http-keep-alive 10s\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" check           10s\n    maxconn                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n\nlisten   admin_stats  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4001\n    mode  http\n    stats uri       /dbs\n    stats realm  Global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" statistics\n    stats auth    admin:abc123456\nlisten   proxy-mysql\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4002  \n    mode  tcp \n    balance  roundrobin\n    option  tcplog       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志格式")]),s._v("\n    server   backup_1  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.102:3306  check  port  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("  maxconn  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("  \n    server   backup_2  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.155:3306  check  port  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("  maxconn  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("  \n    option  tcpka        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用keepalive检测死链")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("重启Haproxy")])]),s._v(" "),a("li",[a("p",[s._v("开启防火墙的VRRP协议")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" --protocol vrrp -j ACCEPT\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("firewall-cmd --reload\n")])])])]),s._v(" "),a("li",[a("p",[s._v("在两个节点上安装Keepalived")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y keepalived\n")])])])]),s._v(" "),a("li",[a("p",[s._v("编辑Keepalived配置文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/keepalived/keepalived.conf\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vrrp_instance  VI_1 {\n    state  MASTER\n    interface  ens33\n    virtual_router_id  51\n    priority  100\n    advert_int  1\n    authentication {\n        auth_type  PASS\n        auth_pass  123456\n    }\n    virtual_ipaddress {\n        192.168.99.211\n    }\n}\n")])])])]),s._v(" "),a("li",[a("p",[s._v("重启Keepalived")])])]),s._v(" "),a("h2",{attrs:{id:"_5-准备归档数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-准备归档数据"}},[s._v("#")]),s._v(" 5. 准备归档数据")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在两个PXC分片上创建进货表")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE TABLE t_purchase (\n\tid INT UNSIGNED PRIMARY KEY,\n\tpurchase_price DECIMAL(10,2) NOT NULL,\n\tpurchase_num INT UNSIGNED NOT NULL,\n\tpurchase_sum DECIMAL (10,2) NOT NULL,\n\tpurchase_buyer INT UNSIGNED NOT NULL,\n\tpurchase_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tcompany_id INT UNSIGNED NOT NULL,\n\tgoods_id INT UNSIGNED NOT NULL,\n\tKEY idx_company_id(company_id),\n\tKEY idx_goods_id(goods_id)\n)\n")])])])]),s._v(" "),a("li",[a("p",[s._v("配置MyCat的schema.xml文件，并重启MyCat")]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("table")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("t_purchase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dataNode")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("dn1,dn2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mod-long"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_6-执行数据归档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-执行数据归档"}},[s._v("#")]),s._v(" 6. 执行数据归档")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装pt-archiver")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" percona-toolkit\npt-archiver --version\npt-archiver --help\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行数据归档")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pt-archiver --source "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("h")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.102,P"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(",u"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Abc_123456,D"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test,t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t_purchase --dest "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("h")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.102,P"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(",u"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Abc_123456,D"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test,t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t_purchase --no-check-charset --where "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'purchase_date<\"2018-09\"'")]),s._v(" --progress "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" --bulk-delete --bulk-insert --limit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" --statistics\n")])])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);