(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{371:function(t,a,s){t.exports=s.p+"assets/img/image-20221027154300367.dca4b1d6.png"},372:function(t,a,s){t.exports=s.p+"assets/img/image-20221027154553072.10aaddba.png"},373:function(t,a,s){t.exports=s.p+"assets/img/image-20221027154823022.9942b7b5.png"},374:function(t,a,s){t.exports=s.p+"assets/img/image-20221026213646094.c00d5271.png"},375:function(t,a,s){t.exports=s.p+"assets/img/image-20220826144221606.1dce4434.png"},550:function(t,a,s){"use strict";s.r(a);var e=s(11),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"rpm包安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rpm包安装"}},[t._v("#")]),t._v(" rpm包安装")]),t._v(" "),e("h2",{attrs:{id:"elasticsearch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[t._v("#")]),t._v(" elasticsearch")]),t._v(" "),e("p",[t._v("https://www.elastic.co/guide/en/elasticsearch/reference/6.0/rpm.html")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" --install elasticsearch-8.8.2-x86_64.rpm\n")])])]),e("p",[t._v("jvm.options")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("-Xms512m\n-Xmx512m\n")])])]),e("p",[t._v("elasticsearch.yml")]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code")])]),e("h2",{attrs:{id:"filebeat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#filebeat"}},[t._v("#")]),t._v(" filebeat")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("sudo rpm -ivh filebeat-7.0.0-x86_64.rpm\n")])])]),e("p",[t._v("配置文件目录: "),e("code",[t._v("cd /etc/filebeat/")])]),t._v(" "),e("p",[t._v("启动")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stop filebeat \n")])])]),e("p",[t._v("源码方式使用")]),t._v(" "),e("p",[t._v("下载相同版本的源码包: "),e("code",[t._v("8.2.3")])]),t._v(" "),e("p",[t._v("下载地址： "),e("a",{attrs:{href:"https://www.elastic.co/cn/downloads/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.elastic.co/cn/downloads/"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("├── elasticsearch-8.2.3-linux-x86_64.tar.gz\n├── elasticsearch-analysis-ik-8.2.3.zip\n├── filebeat-8.2.3-linux-x86_64.tar.gz\n├── kibana-8.2.3-linux-x86_64.tar.gz\n├── logstash-8.2.3-linux-x86_64.tar.gz\n├── logstash-filter-geoip-7.2.12.tar.gz\n└── metricbeat-8.2.3-linux-x86_64.tar.gz\n")])])]),e("h1",{attrs:{id:"elasticsearch-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-2"}},[t._v("#")]),t._v(" Elasticsearch")]),t._v(" "),e("p",[t._v("解压")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf Package/elasticsearch-8.2.3-linux-x86_64.tar.gz -C ./\n")])])]),e("p",[t._v("修改配置："),e("code",[t._v("elasticsearch.yml")])]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster.name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" elasticsearch\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node.name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("network.host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.0.0.0\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http.port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9200")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster.initial_master_nodes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mster'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("p",[t._v("修改配置: "),e("code",[t._v("/etc/systemctl.conf")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vm.max_map_count=655360\n")])])]),e("p",[t._v("启动")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./es/bin/elasticsearch\n")])])]),e("p",[t._v("访问："),e("code",[t._v("http://localhost:9200")])]),t._v(" "),e("h2",{attrs:{id:"elasticsearch设置用户密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch设置用户密码"}},[t._v("#")]),t._v(" elasticsearch设置用户密码")]),t._v(" "),e("p",[t._v("1、修改 "),e("code",[t._v("elasticsearch.yml")]),t._v(" 文件")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("license.self_generated.type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" basic\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启密码设置为 true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enrollment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("transport")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   \t "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ssl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   \t   "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n")])])]),e("p",[t._v("2、执行设置用户名和密码的命令,这里需要为4个用户分别设置密码，elastic, kibana, logstash_system,beats_system")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./bin/elasticsearch-setup-passwords auto\n")])])]),e("p",[t._v("3，修改密码命令如下")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -H "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type:application/json"')]),t._v(" -XPOST -u elastic "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:9200/_xpack/security/user/elastic/_password'")]),t._v(" -d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{ "password" : "new password" }\'')]),t._v("\n")])])]),e("h2",{attrs:{id:"忘记密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#忘记密码"}},[t._v("#")]),t._v(" 忘记密码")]),t._v(" "),e("p",[t._v("进入docker环境中，创建一个 超级用户 ：admin")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./bin/elasticsearch-users "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useradd")]),t._v(" admin -r superuser\n")])])]),e("p",[t._v("用这个用户去修改elastic的密码：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -XPUT -u admin:admin666 http://localhost:9200/_xpack/security/user/elastic/_password -H "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type: application/json"')]),t._v(" -d "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'\n{\n  "password": "new password"\n}\'')]),t._v("\n")])])]),e("h1",{attrs:{id:""}},[e("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])]),t._v(" "),e("h1",{attrs:{id:"filebeat-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#filebeat-2"}},[t._v("#")]),t._v(" filebeat")]),t._v(" "),e("p",[t._v("日志文件（收集文件数据）")]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.prospectors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("input_type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n   "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /nginx/"),e("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /mysql/"),e("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("input_type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stdin "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 标椎输入")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /redis/"),e("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n   \n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.console")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pretty")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  \n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.elasticsearch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:9200"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin666"')]),t._v("\n")])])]),e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),e("p",[t._v("下载解压即可，已下操作都是在filebeat目录下进行操作")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf filebeat-8.4.3-linux-x86_64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" filebeat-8.4.3-linux-x86_64/\n")])])]),e("h2",{attrs:{id:"初体验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初体验"}},[t._v("#")]),t._v(" 初体验")]),t._v(" "),e("p",[t._v("读取一个文件在终端中输出")]),t._v(" "),e("p",[t._v("配置文件")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("demo.yaml\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stdin\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保存到es中的一个副本的数量")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    \n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.console")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pretty")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),e("p",[t._v("运行")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./filebeat -e -c demo.yaml\n")])])]),e("h2",{attrs:{id:"读取日志文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#读取日志文件"}},[t._v("#")]),t._v(" 读取日志文件")]),t._v(" "),e("p",[t._v("创建一个日志文件")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("mkdir Logs\n\ntouch nginx.log\n")])])]),e("p",[t._v("创建一个 "),e("code",[t._v("nginx-log.yml")]),t._v(" 文件")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx-log.yml")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里是inputs")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类型是 日志类型")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /path/to/logs/"),e("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fileds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加自定义字段")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log_type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" access\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fileds_under_root")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加到根节点，false：添加到子节点")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出到终端")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.console")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pretty")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),e("p",[t._v("启动")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./filebeat -e- c filebeat-log.yaml\n")])])]),e("p",[t._v("/path/to/logs/a.log")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("hello\nworld\n")])])]),e("h2",{attrs:{id:"输出到elasticsearch中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出到elasticsearch中"}},[t._v("#")]),t._v(" 输出到elasticsearch中")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# filebeat-nginx.yaml")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.input")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /path/to/logs/"),e("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fileds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-log"')]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields_under_root")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输入到es中")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.elasticsearch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 制定es的配置")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:9200"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出到 kibana 汇总")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.kibana")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kibana_host:5601"')]),t._v("\n")])])]),e("p",[t._v("启动")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./filebeat -e- c filebeat-nginx.yaml\n")])])]),e("h2",{attrs:{id:"实战演示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实战演示"}},[t._v("#")]),t._v(" 实战演示")]),t._v(" "),e("p",[t._v("将宝塔中nginx的日志通过filebeat 输出到 elasticsearch中，并用kibana展示出来。")]),t._v(" "),e("h3",{attrs:{id:"_1、开启nginx-modules"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、开启nginx-modules"}},[t._v("#")]),t._v(" 1、开启nginx modules")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./filebeat modules "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" nginx\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列表")]),t._v("\n./filebeat modules list\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启禁用")]),t._v("\n./filebeat modules "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("disable nginx\n")])])]),e("h3",{attrs:{id:"_3、填写配置nginx日志路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、填写配置nginx日志路径"}},[t._v("#")]),t._v(" 3、填写配置nginx日志路径")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" modules.d/nginx.yml\n")])])]),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Module: nginx")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docs: https://www.elastic.co/guide/en/beats/filebeat/8.4/filebeat-module-nginx.html")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("module")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Access logs")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx access_log 的绝对路径,可填写多个")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("var.paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/orangbus/Docker/Logs/deepin.com.log"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Error logs")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 同上配置")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#var.paths:")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress_controller")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#var.paths:")]),t._v("\n")])])]),e("h3",{attrs:{id:"_3-、配置-filebeat-nginx-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-、配置-filebeat-nginx-yml"}},[t._v("#")]),t._v(" 3 、配置 filebeat-nginx.yml")]),t._v(" "),e("p",[t._v("参考地址："),e("a",{attrs:{href:"https://www.elastic.co/guide/en/beats/filebeat/current/setup-kibana-endpoint.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.elastic.co/guide/en/beats/filebeat/current/setup-kibana-endpoint.html"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("创建一个 "),e("code",[t._v("nginx-filebeat.yml")]),t._v(" 配置 (复制一份默认的进行修改)")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" filebeat.yml nginx-filebeat.yml\n")])])]),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.input")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kibana 配置")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.kibana")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:5601"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"elastic"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cy2ZEszz8EP0gPy6hi9L"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# es的认证账号密码")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# elasticsearch的配置")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.elasticsearch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:9200"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"elastic"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"93Wzawo0wunszVmc1gwa"')]),t._v("\n")])])]),e("p",[t._v("可能需要安装两个"),e("code",[t._v("elasticsearch")]),t._v("扩展包")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" bin/elasticsearch-plugin "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ingest-user-agent\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" bin/elasticsearch-plugin "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ingest-geoip\n")])])]),e("h3",{attrs:{id:"_4、安装仪表盘到kibana中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、安装仪表盘到kibana中"}},[t._v("#")]),t._v(" 4、安装仪表盘到kibana中")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./filebeat -c nginx-filebeat.yml setup\n")])])]),e("p",[e("img",{attrs:{src:s(371),alt:"image-20221027154300367"}})]),t._v(" "),e("h3",{attrs:{id:"_5、运行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、运行"}},[t._v("#")]),t._v(" 5、运行")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./filebeat -e- c nginx-filebeat.yml\n\n// 后台启动\n./filebeat -e- c nginx-filebeat.yml  "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" /home/orangbus/Docker/elastic/filebeat-8.7.0/filebeat -e -c /home/orangbus/Docker/elastic/filebeat-8.7.0/filebeat.yml "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n\n// 查看\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -ef "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" filebeat\n")])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("sudo vi /etc/systemd/system/filebeat.service\n\n[Unit]\nDescription=Elasticsearch Filebeat\nDocumentation=https://www.elastic.co/products/beats/filebeat\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=filebeat\nGroup=filebeat\nExecStart=/usr/bin/filebeat -c /path/to/filebeat.yml\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n")])])]),e("h3",{attrs:{id:"_6、kibana查看数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、kibana查看数据"}},[t._v("#")]),t._v(" 6、kibana查看数据")]),t._v(" "),e("p",[t._v("在kibana中会多出几个视图，即表示安装成功")]),t._v(" "),e("p",[e("img",{attrs:{src:s(372),alt:""}})]),t._v(" "),e("p",[t._v("搜索nginx")]),t._v(" "),e("p",[e("img",{attrs:{src:s(373),alt:"image-20221027154823022"}})]),t._v(" "),e("hr"),t._v(" "),e("h1",{attrs:{id:"kibann-配置filebeat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kibann-配置filebeat"}},[t._v("#")]),t._v(" kibann 配置filebeat")]),t._v(" "),e("p",[e("img",{attrs:{src:s(374),alt:"image-20221026213646094"}})]),t._v(" "),e("h2",{attrs:{id:"问题汇总"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题汇总"}},[t._v("#")]),t._v(" 问题汇总")]),t._v(" "),e("h3",{attrs:{id:"无法删除-filebeat-的index"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#无法删除-filebeat-的index"}},[t._v("#")]),t._v(" 无法删除 filebeat 的index")]),t._v(" "),e("p",[t._v("进入kibana，删除 filebeat的数据流")]),t._v(" "),e("p",[e("img",{attrs:{src:s(375),alt:"image-20220826144221606"}})]),t._v(" "),e("h3",{attrs:{id:"如何从头开始读取"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何从头开始读取"}},[t._v("#")]),t._v(" 如何从头开始读取")]),t._v(" "),e("p",[t._v("删除 filebeat目录下的 "),e("code",[t._v("./data/registry")]),t._v(" 文件内容即可")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf ./data/registry\n")])])]),e("h1",{attrs:{id:"logstash"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logstash"}},[t._v("#")]),t._v(" Logstash")]),t._v(" "),e("p",[t._v("对提交的数据进行清洗")]),t._v(" "),e("p",[e("strong",[t._v("input")])]),t._v(" "),e("ul",[e("li",[t._v("file")]),t._v(" "),e("li",[t._v("redis")]),t._v(" "),e("li",[t._v("beat")])]),t._v(" "),e("p",[e("strong",[t._v("filter")])]),t._v(" "),e("ul",[e("li",[t._v("grok：正则表达式，可将非机构化的数据转化为结构化的数据")]),t._v(" "),e("li",[t._v("mutate ：数据增删改查")]),t._v(" "),e("li",[t._v("drop：删除")]),t._v(" "),e("li",[t._v("date ： 将字符串类型的时间字段转化为时间戳类型，方便后续数据处理")])]),t._v(" "),e("p",[e("strong",[t._v("out")])]),t._v(" "),e("ul",[e("li",[t._v("stdout")]),t._v(" "),e("li",[t._v("elasticsearch")])]),t._v(" "),e("p",[t._v("基本配置")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('input {\n  beats {\n    port => 5044   \n  }\n}\noutput {\n  elasticsearch {\n    hosts => ["http://192.168.110.130:9200"] #这里可以配置多个\n    index => "query-%{yyyyMMdd}" \n  }\n}\n\n')])])]),e("h1",{attrs:{id:"metricbeat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#metricbeat"}},[t._v("#")]),t._v(" Metricbeat")]),t._v(" "),e("p",[t._v("指标（收集系统、进程和文件系统级别的CPU和内存使用情况等数据）")]),t._v(" "),e("p",[t._v("module : ningx")]),t._v(" "),e("p",[t._v("metricset: cpu memory network")]),t._v(" "),e("p",[t._v("redis-cli  info")]),t._v(" "),e("p",[t._v("修改es的链接")]),t._v(" "),e("p",[t._v("启动")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./metricbeat -e\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后台运行")]),t._v("\n./metricbeat -e "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("fg")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 放入后台")]),t._v("\nctrl +z\n")])])]),e("p",[t._v("开启nginx的状态查询")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./configure --prefix"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx --with-http_stub_status_module\n")])])]),e("h2",{attrs:{id:"配置-nginx-状态统计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx-状态统计"}},[t._v("#")]),t._v(" 配置 nginx 状态统计")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("status "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("stub_status")]),t._v(" on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" off"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("启用nginx modules")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./metricbeat modules "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("disable nginx\n")])])]),e("p",[t._v("配置nginx module 地址 "),e("code",[t._v("modules.d/nginx.yml")])]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server_status_path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' "nginx'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('status" // nginx 配置的状态查询一致\n')])])]),e("p",[t._v("metricbeat配置kibana")]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.kibana")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\thost"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kibana_host:5601"')]),t._v("\n")])])]),e("p",[t._v("metricbeat 安装仪表盘到kibana")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./metricbeat setup\n")])])]),e("p",[t._v("常见的状态")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("名称")]),t._v(" "),e("th",[t._v("示例")]),t._v(" "),e("th",[t._v("备注")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("agent.hostname")]),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("log.file.path ：日志文件路径")]),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("source.ip ：来源ip")]),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("http.request.method")]),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("user_agent.name 系统名称")]),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("user_agent_os.version  系统版本")]),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("user_agent.devive.name  设备名称")]),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td")])])]),t._v(" "),e("h1",{attrs:{id:"kibana配置账号密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kibana配置账号密码"}},[t._v("#")]),t._v(" Kibana配置账号密码")]),t._v(" "),e("p",[t._v("在 "),e("code",[t._v("kibana.yml")]),t._v("中配置用户名和密码")]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("elasticsearch.username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kibana"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("elasticsearch.password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*****"')]),t._v("\n")])])]),e("p",[t._v("账号密码为 "),e("code",[t._v("es初始化中设置的密码")]),t._v(" elastic")]),t._v(" "),e("p",[t._v("重启kibana")]),t._v(" "),e("p",[t._v("输入http://ip:5601打开登录页面，使用elastic账号登录，并在角色和用户管理中添加用户指定 索引用于访问ES.")]),t._v(" "),e("h1",{attrs:{id:"logstash配置账号密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logstash配置账号密码"}},[t._v("#")]),t._v(" Logstash配置账号密码")]),t._v(" "),e("p",[t._v("在logstash.yml中配置用户名和密码")]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.elasticsearch.username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" logstash_system\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.elasticsearch.password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token important"}},[t._v("*****")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xpack.monitoring.elasticsearch.hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://ip:9200"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("p",[t._v("Api访问")]),t._v(" "),e("p",[t._v("http请求方式，在请求链接中添加账号和密码，注:密码中不要带@。")]),t._v(" "),e("p",[t._v("http://{userName}:{passwords}@ip:port")]),t._v(" "),e("h1",{attrs:{id:"logstash同步mysql-到es"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logstash同步mysql-到es"}},[t._v("#")]),t._v(" logstash同步mysql 到es")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('# Sample Logstash configuration for creating a simple\n# Beats -> Logstash -> Elasticsearch pipeline.\n\ninput {\n  jdbc {\n    jdbc_driver_library => "/home/orangbus/Code/Docker/Elk/Package/mysql-connector-java-8.0.28.jar"\n    jdbc_driver_class => "com.mysql.cj.jdbc.Driver"\n    jdbc_connection_string => "jdbc:mysql://127.0.0.1:3306/laravel9"\n    jdbc_user => "root"\n    jdbc_password => "root"\n    jdbc_page_size => "1000"\n    schedule => "* * * * *"\n    statement => "SELECT * FROM brain_teasers WHERE updated_at >= :sql_last_value"\n    use_column_value => true\n    tracking_column_type => "timestamp"\n    tracking_column => "updated_at"\n#    last_run_metadata_path => "syncpoint_table"\n  }\n}\n\n  output {\n#    elasticsearch {\n#      hosts => ["http://localhost:9200"]\n#      index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"\n      #user => "elastic"\n      #password => "changeme"\n#  }\n  stdout {\n    codec => json_lines\n  }\n  \n}\n\n')])])]),e("ul",[e("li",[e("p",[e("code",[t._v("jdbc_driver_library")]),t._v(": jdbc mysql 驱动的路径，在上一步中已经下载")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("jdbc_driver_class")]),t._v(": 驱动类的名字，mysql 填 "),e("code",[t._v("com.mysql.jdbc.Driver")]),t._v(" 就好了")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("jdbc_connection_string")]),t._v(": mysql 地址")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("jdbc_user")]),t._v(": mysql 用户")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("jdbc_password")]),t._v(": mysql 密码")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("schedule")]),t._v(": 执行 sql 时机，类似 crontab 的调度")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("statement")]),t._v(': 要执行的 sql，以 ":" 开头是定义的变量，可以通过 parameters 来设置变量，这里的 '),e("code",[t._v("sql_last_value")]),t._v(" 是内置的变量，表示上一次 sql 执行中 update_time 的值，这里 "),e("code",[t._v("update_time")]),t._v(" 条件是 "),e("code",[t._v(">=")]),t._v(" 因为时间有可能相等，没有等号可能会漏掉一些增量")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("use_column_value")]),t._v(": 使用递增列的值")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("tracking_column_type")]),t._v(": 递增字段的类型，"),e("code",[t._v("numeric")]),t._v(" 表示数值类型, "),e("code",[t._v("timestamp")]),t._v(" 表示时间戳类型")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("tracking_column")]),t._v(": 递增字段的名称，这里使用 update_time 这一列，这列的类型是 "),e("code",[t._v("timestamp")])])]),t._v(" "),e("li",[e("p",[e("code",[t._v("last_run_metadata_path")]),t._v(": 同步点文件，这个文件记录了上次的同步点，重启时会读取这个文件，这个文件可以手动修改")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("hosts")]),t._v(": es 集群地址")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("user")]),t._v(": es 用户名")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("password")]),t._v(": es 密码")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("index")]),t._v(": 导入到 es 中的 index 名，这里我直接设置成了 mysql 表的名字")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("document_id")]),t._v(": 导入到 es 中的文档 id，这个需要设置成主键，否则同一条记录更新后在 es 中会出现两条记录，"),e("code",[t._v("%{id}")]),t._v(" 表示引用 mysql 表中 "),e("code",[t._v("id")]),t._v(" 字段的值")])])]),t._v(" "),e("p",[t._v("启动")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("./bin/logstash -f config/mysql.yml\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);