---
title: 农贸市场接口说明
---

# 农贸市场

需要准备4个域名
1：前端: web.nmsc.com
2：后端管理页面: admin.nmsc.com
3、接口端的: api.nmsc.com
4:、图片存储的: cdn.nmsc.com

## 开发环境

uniapp端：http://162.14.72.65:8083

接口端：http://162.14.72.65:8082

后台管理端：http://1.14.63.64:8084

接口端：http://1.14.63.64:9003

文件存储：

## 初始化数据

删除已有的数据，重新新建初始化数据
```bash
php artisan db:seed --class=InitDataSeeder
```


测试数据

```bash
php artisan db:seed --class=FakerSeeder
```

# uniapp

ftp地址：http://162.14.72.65 

端口： 22

账号：uniapp_nmsc

密码：uniapp_nmsc666

## 接口状态码

| 状态码 | 说明       |
| ------ | ---------- |
| 200    | 返回成功   |
| 202    | 错误提示   |
| 419    | 登录时失效 |

返回成功

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "token": "1|Kx13BnRBItUtKCSsQPKQHMpEBbpXDxEFxOOdO730",
        "user": {
            "id": 1,
            "name": "OrangBus",
            "created_at": "2023-05-05 20:13:12",
            "updated_at": "2023-05-05 20:13:18"
        }
    }
    "total":100 // 仅仅在获取数据列表的时候会存在
}
```

返回失败

```json
{
    "code": 202,
    "msg": "错误信息"
}
```


## 图片存储测试
```bash
# minio 如果需要分离，需要将下面的文件一起复制
MINIO_PORT=9000
MINIO_ADMIN_PORT=9001
MINIO_ACCESS_KEY=admin
MINIO_SECRET_KEY=admin666
MINIO_DATE=./data/minio/data
MINIO_CONFIG=./data/minio/config

AWS_ACCESS_KEY_ID="${MINIO_ACCESS_KEY}"
AWS_SECRET_ACCESS_KEY="${MINIO_SECRET_KEY}"
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=nmsc
AWS_USE_PATH_STYLE_ENDPOINT=false
AWS_ENDPOINT=http://162.14.72.65:9000
AWS_URL=http://162.14.72.65:9000
```



## 小程序登录流程

第一次登录需要使用账号密码登录，成功登录后当用户【绑定了微信小程序之后】才能走下面的流程。

### 1、通过当前用户的手机号查询用户信息

```html
 <button
        style="margin-top: 20rpx"
        open-type="getPhoneNumber"
        class="wx-btn round-40"
        @getphonenumber="bindMini2"
    >
        授权微信手机号
    </button>
```

```javascript
// 获取到code 换取微信手机号
bindMini2(e){
    phoneLogin({
        code: e.detail.code, // 留意这里的code，用户换取用户手机号的
    }).then(res=>{
        console.log(res)
    });
},
```

### 2、通过微信的code获取到用户的openid

```html
 <button
        class="wx-btn round-40"
        @click="bindMini"
    >
        微信登录
    </button>
```

```javascript
 bindMini(){
     uni.login({ // 留意这个方法
         provider: 'weixin',
         success: (res) => {
             userBindMini({
                 code: res.code, // 关键的code
             }).then(res=>{
                 console.log(res)
             });
         },
     });
 },
```

### 3、手机号绑定微信openid

以上两个步骤走完之后及可获得登录信息了。

### 完整流程

```html
 <button
         style="margin-top: 20rpx"
         open-type="getPhoneNumber"
         class="wx-btn round-40"
         @getphonenumber="minilogin"
         >
     授权微信手机号登录
</button>
```

```javascript
minilogin(e){
    // 获取当前用户的手机号
    getLoginPhone({
        code: e.detail.code, // 用户换取手机号
    }).then(res=>{
        let {code,data,msg} = res;
        if (code === 200){
            // todo 此处可加一个 【正在登录中】的提示
            uni.login({
                provider: 'weixin',
                success: (result) => {
                    userBindMini({
                        code: result.code, // 通过code换取微信的 openid
                        phone: data.phone // openid + phone 判断该用户时候存在，同时返回登陆信息
                    }).then(response=>{
                        let {code,data,msg} = response; // data 里面包含了用户的登录信息
                        if (code === 200){
                            console.log(res)
                            Message.success(msg);
                            // 跳转下一个页面
                        }else{
                            Message.error(msg);
                        }
                    });
                },
            });
        }else{
            Message.error(msg);
        }
    });
},
```





## 支付流程

1、创建对应的订单

2、获取支付参数

3、查询支付结果

支付固定写法

```javascript
getProvider() {
    return new Promise((resolve, reject) => {
        uni.getProvider({
            service: 'payment',
            success: (res) => {
                console.log(res);
                resolve(res.provider);
            },
            fail: (err) => {
                console.log(err);
                reject(err);
            },
        });
    });
},
```

充值支付案例

```javascript
// 1、创建一个订单
            userCash({
                money:this.formData.value
            }).then(res=>{
                let {code,data,msg} = res;
                if (code === 200){
                    // 2、得到订单id后获取支付参数信息
                    payParam({
                        order_id: data.id,
                        order_type: EnumData.payTypeCash
                    }).then(res=>{
                        if (res.code === 200){
                            const provider = this.getProvider();
                            uni.requestPayment({
                                provider, // 固定参数
                                service: 5, // 固定值：5（拉起小程序收银台）
                                ...res.data, // 支付信息
                                success: (res) => {
                                    console.log(res)
                                    // 用户在手机端支付成功后的页面回调 = 用户真实付了钱
                                },
                                fail: (err) => {
                                    console.log(err)
                                    
                                    // 用户唤起了支付，但是没有支付前直接返回
                                    // this.orderFail();
                                },
                            });
                        }else{
                            Message.error(res.msg);
                        }
                    });
                }else{
                    Message.error(msg);
                }
            });
```







# 百度短信

https://cloud.baidu.com/doc/SMS/s/lkijy5wvf

## 配置格式

短信示例：【 鹅鹅鹅网络科技有限公司】您的验证码是${code}，请完成验证。

短信签名：【 鹅鹅鹅网络科技有限公司】

短信模板：您的验证码是${code}，请完成验证。

## 登录

【 鹅鹅鹅网络科技有限公司】您的验证码是:${code}，有效期${expire_at}分钟。

## 修改支付密码

【 鹅鹅鹅网络科技有限公司】您本次修改密码的验证码是:${code},，有效期${expire_at}分钟。

# 高德地图接口

https://lbs.amap.com/api/webservice/guide/api/direction#bicycling



## linux服务器需要的必要软件

php8.0+ 开启ssl模块 （如果你需要7.4版本，你需要安装两个版本共存，默认使用php8.0）

nginx: 最新版本

mysql:5.7|8.0

redis: 最新版本

Supervisor：最新版本

docker:最新版本

fpt:最新

以及对应文件的配置目录

```
IP Address: 192.168.159.166  root/k1k1k1k1
mysql 本地， root/nmsc2023!

Nginx_File_Dir="nginx-1.24.0"
Nginx_Prefix="/usr/local/nginx"
Nginx_Dir="/usr/local/nginx/html"

Mysql_File="mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz"
Mysql_File_Dir="mysql-5.7.38-linux-glibc2.12-x86_64"
Mysql_Config_File="/etc/my.cnf"
Mysql_Prefix="/usr/local/mysql57"
Mysql_Dir="/data/mysql"
Mysql_User="mysql"

PHP_Eight_File="php-8.0.26.tar.gz"
PHP_Seven_File="php-7.3.33.tar.gz"
PHP_Eight_File_Dir="php-8.0.26"
PHP_Seven_File_Dir="php-7.3.33"
PHP_Eight_Prefix="/usr/local/php80"
PHP_Seven_Prefix="/usr/local/php73"
PHP_User="nginx"

Oniguruma_File="oniguruma-6.9.7.1.tar.gz"
Oniguruma_File_Dir="onig-6.9.7"

Redis_File="redis-7.0.11.tar.gz"
Redis_File_Dir="redis-7.0.11"
Redis_Prefix="/usr/local/redis"

Elasticsearch_File="elasticsearch-7.17.10-x86_64.rpm"
Elasticsearch_Dir="/data/elasticsearch"

==========================
应用文件，已复制到了 /www/下。
4个主要的数据库已导入，你可以直接使用navicat访问的。

ssl也更新了，是可以直接放到测试环境中的（sd.msadb.cn)，申请了两个证书放在/data/https下。

php 8.0.26 是9000端口。
php 7.3.33 是9001端口。

CREATE DATABASE IF NOT EXISTS nmsc  DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci;
我们一般都用这个CHARSET  和 COLLATE 

你在远程电脑上hosts上改记录就可以对应好sd.msadb.cn与nmsc.msadb.cn。模拟测试环境sd.msadb.cn上的操作。
```



# 升级python3版本到最新

```shell
https://www.python.org/ftp/python/3.11.3/Python-3.11.3.tgz
tar zxvf Python-3.11.3.tgz

./configure --prefix=/usr/local/python3 --enable-optimizations
make 
make install
# 删除原先的Python3和pip3
rm -rf /usr/bin/python3
ln -s /usr/local/python3/bin/python3 /usr/bin/python3
rm -rf /usr/bin/pip3
ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3
```

## 安装pip

https://www.runoob.com/w3cnote/python-pip-install-usage.html

```bash
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
python3 get-pip.py
```

## 安装docker-compose

```bash
pip3 install docker-compose
```

## 终端提示

```bash
yum install zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
git clone https://github.com/zsh-users/zsh-autosuggestions ~/.zsh/zsh-autosuggestions --depth 1
```

## 快捷别名

```
# vim ~/.zshrc

alias cls="clear && ls"
alias server="cd ~/server"


alias nginx-res="systemctl restart nginx"
alias ncf="cd /usr/local/nginx/conf/conf.d"
alias server="cd && cd server"

alias dc='docker-compose'
alias dca='dc up -d nginx phpmyadmin'
alias dcps='docker-compose ps'
alias dcres='docker-compose restart && dcps'
alias dcn='docker-compose restart nginx && dcps'
alias dcd='dc down'

alias pa="php artisan"
alias paqw="pa queue:list"
alias paqs="pa queue:restart"

source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
```

## 自定义软连接

```
# nginx
ln -s /usr/local/nginx/html 
# mkdir nginx
ln -s /usr/local/nginx/conf/conf.d

# mkdir supervisord
ln -s 
```



## nginx php重要配置

```nginx
location ~* \.php$ {
        root "/www/wwwroot/nmsc/nmsc-api/public";
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
        fastcgi_pass    127.0.0.1:9000;
        fastcgi_index   index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; // linux 正确配置
        include fastcgi_params;
}
```

## Supervisor配置

```
touch nmsc-queue.ini
```

```ini
[program:nmsc-queue]
command=php artisan queue:work
directory=/usr/local/nginx/html/nmsc/nmsc-api
autorestart=true
startsecs=3
startretries=3
stdout_logfile=/root/server/supervisord/logs/nmsc-queue.out.log
stderr_logfile=/root/server/supervisord/logs/nmsc-queue.err.log
stdout_logfile_maxbytes=2MB
stderr_logfile_maxbytes=2MB
user=root
priority=999
numprocs=3
process_name=%(program_name)s_%(process_num)02d
```

```bash
touch nmsc-schedule.ini
```

```ini
[program:nmsc-schedule]
command=php artisan schedule:work
directory=/usr/local/nginx/html/nmsc/nmsc-api
autorestart=true
startsecs=1
startretries=1
stdout_logfile=/root/server/supervisord/logs/nmsc-schedule.out.log
stderr_logfile=/root/server/supervisord/logs/nmsc-schedule.err.log
stdout_logfile_maxbytes=2MB
stderr_logfile_maxbytes=2MB
user=root
priority=999
numprocs=1
process_name=%(program_name)s_%(process_num)02d
```

重启

```bash
systemctl restart supervisord
```

其它操作

```bash
supervisorctl status
supervisorctl update
```





## minio

```yml

```





# 一、Nginx使用说明

```
1、Nginx安装目录：/usr/local/nginx
2、发布目录：/usr/local/nginx/html
3、证书文件目录：/data/https
4、主配置文件：/usr/local/nginx/conf/nginx.conf，配置文件引用目录：/usr/local/nginx/conf/conf.d
5、服务管理：
1）启动Nginx
systemctl start nginx
2）停止Nginx
systemctl stop nginx
3）重启Nginx
systemctl restart nginx
4）重载Nginx
systemctl reload nginx 或者 nginx -s reload
```

# 二、MySQL使用说明

```
1、MySQL安装目录：/usr/local/mysql57
2、数据目录：/data/mysql
3、主配置文件：/etc/my.cnf
4、服务管理：
1）启动MySQL
/etc/init.d/mysql57 start
2）停止MySQL
/etc/init.d/mysql57 stop
3）重启MySQL
/etc/init.d/mysql57 restart
```

# 三、PHP使用说明

```
1、PHP-8.0安装目录：/usr/local/php80
2、PHP-7.3安装目录：/usr/local/php73
3、主配置文件：
PHP-8.0：/usr/local/php80/etc/php.ini
PHP-7.3：/usr/local/php73/etc/php.ini
4、服务管理：
1）启动PHP
PHP-8.0：systemctl start php80.service
PHP-7.3：systemctl start php73.service
2）停止PHP
PHP-8.0：systemctl stop php80.service
PHP-7.3：systemctl stop php73.service
3）重启PHP
PHP-8.0：systemctl restart php80.service
PHP-7.3：systemctl restart php73.service
5、PHP版本切换：
1）PHP-8.0
ln -sf /usr/local/php80/bin/php /usr/bin/php
2）PHP-7.3
ln -sf /usr/local/php73/bin/php /usr/bin/php
```

# 四、Redis使用说明

```
1、Redis安装目录：/usr/local/redis
2、数据目录：/data/redis
3、主配置文件：/usr/local/redis/redis.conf
4、Redis密码：执行grep ^requirepass /usr/local/redis/redis.conf |awk ‘{print $2}’获取
5、服务管理：
1）启动Redis
systemctl start redis
2）停止Redis
systemctl stop redis
3）重启Redis
systemctl restart redis
```

# 五、Docker使用说明

```
1、查看Docker版本：docker version
```

# 六、ES使用说明

```
1、Elasticsearch安装目录：/etc/elasticsearch
2、数据目录：/data/elasticsearch
3、主配置文件：/etc/elasticsearch/elasticsearch.yml
4、服务管理：
1）启动Elasticsearch
systemctl start elasticsearch
2）停止Elasticsearch
systemctl stop elasticsearch
3）重启Elasticsearch
systemctl restart elasticsearch
5、查看集群状态
curl -XGET "http://127.0.0.1:9200/_cluster/health?pretty"
```

# 七、FTP使用说明

```
1、FTP安装目录：/etc/vsftpd/
2、主配置文件：/etc/vsftpd/vsftpd.conf
3、服务管理：
1）启动vsftpd
systemctl start vsftpd
2）停止vsftpd
systemctl stop vsftpd
3）重启vsftpd
systemctl restart vsftpd
4、用户管理：
1）新增用户
useradd 用户名
家目录：/home/用户名
2）删除用户
userdel 用户名
```

# 八、Supervisor使用说明

```
1、主配置文件：/etc/supervisord.conf
2、服务管理：
1）启动Supervisord
systemctl start supervisord
2）停止Supervisord
systemctl stop supervisord
3）重启Supervisord
systemctl restart supervisord
```

# 九、Composer使用说明

```
1、查看版本：composer -V
2、添加阿里云composer镜像源：composer config -g repo.packagist composer https://mirrors.aliyun.com/composer
```

# 站点配置

准备了5个域名：8.135.20.182

## 线上正式环境 

1、前端: https://web.klnm.msadb.cn 
2、后端管理页面: http://admin.klnm.msadb.cn
3、接口端的: https://api.klnm.msadb.cn
4、图片存储的: https://tp.klnm.msadb.cn
5、对外正式：http://klnm.msadb.cn （未使用）

数据库：nmsc2023!

## 测试环境：

1：前端: https://web.nmsc.msadb.cn 
2：后端管理页面: https://admin.nmsc.msadb.cn
3、接口端的: https://api.nmsc.msadb.cn
4:、图片存储的:  http://tp.nmsc.msadb.cn

5、gitea: http://gitea.msadb.cn

# nginx配置文件-正式

```nginx
server {
    listen 80;
    server_name nmsc.test;
    # Access Restrictions
    allow       127.0.0.1;
    deny        all;

   root "/www/wwwroot/nmsc/nmsc-api/public";

   location / {
           try_files $uri $uri/ /index.php$is_args$args;
           index index.php index.htm index.html;
        }

    location ~* \.php$ {
        root "/www/wwwroot/nmsc/nmsc-api/public";
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
        fastcgi_pass    127.0.0.1:9000;
        fastcgi_index   index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}

```



## 图片

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name tp.klnm.msadb.cn;

    ssl_certificate /usr/local/nginx/ssl/nmsc-tp.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-tp.key;

    location / {
         proxy_pass http://127.0.0.1:9010;
         proxy_set_header Host $host;
         proxy_set_header X-Real-IP $remote_addr;
         root /usr/local/nginx/html/nmsc/nmsc-tp;
    }
    
    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```

## 前端

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name web.klnm.msadb.cn;

    ssl_certificate /usr/local/nginx/ssl/nmsc-web.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-web.key;

    location / {
         root /usr/local/nginx/html/nmsc/nmsc-web;
    }
    
    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```



## 接口

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name api.klnm.msadb.cn;
    
    ssl_certificate /usr/local/nginx/ssl/nmsc-api.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-api.key;

   root /usr/local/nginx/html/nmsc/nmsc-api/public;

   location / {
           try_files $uri $uri/ /index.php$is_args$args;
           index index.php index.htm index.html;
        }

    location ~* \.php$ {
        root /usr/local/nginx/html/nmsc/nmsc-api/public;
        fastcgi_pass    127.0.0.1:9000;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
        fastcgi_index   index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```

## 后台

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name admin.klnm.msadb.cn;
    # Access Restrictions
    allow       127.0.0.1;
    deny        all;
    
    ssl_certificate /usr/local/nginx/ssl/nmsc-admin.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-admin.key;

   root /usr/local/nginx/html/nmsc/nmsc-admin;

   location / {
       try_files $uri $uri/ /index.html;
   }
    
    location /nmsc {
        proxy_pass https://api.klnm.msadb.cn;
    }

    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```



# nginx配置文件-测试

## 图片

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name tp.nmsc.msadb.cn;

    ssl_certificate /usr/local/nginx/ssl/nmsc-tp.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-tp.key;

    location / {
         proxy_pass http://127.0.0.1:9010;
         proxy_set_header Host $host;
         proxy_set_header X-Real-IP $remote_addr;
         root /usr/local/nginx/html/nmsc/nmsc-tp;
    }
    
    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```

## 前端

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name web.nmsc.msadb.cn ;

    ssl_certificate /usr/local/nginx/ssl/nmsc-web.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-web.key;

    location / {
         root /usr/local/nginx/html/nmsc/nmsc-web;
    }
    
    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```



## 接口

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name api.nmsc.msadb.cn;
    
    ssl_certificate /usr/local/nginx/ssl/nmsc-api.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-api.key;

   root /usr/local/nginx/html/nmsc/nmsc-api/public;

   location / {
           try_files $uri $uri/ /index.php$is_args$args;
           index index.php index.htm index.html;
        }

    location ~* \.php$ {
        root /usr/local/nginx/html/nmsc/nmsc-api/public;
        fastcgi_pass    127.0.0.1:9000;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
        fastcgi_index   index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```

## 后台

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name admin.msadb.cn;
    # Access Restrictions
    allow       127.0.0.1;
    deny        all;
    
    ssl_certificate /usr/local/nginx/ssl/nmsc-admin.pem;
    ssl_certificate_key /usr/local/nginx/ssl/nmsc-admin.key;

   root /usr/local/nginx/html/nmsc/nmsc-admin;

   location / {
       try_files $uri $uri/ /index.html;
   }
    
    location /nmsc {
        proxy_pass https://api.nmsc.msadb.cn;
    }

    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```

## Gitea

```nginx
server {
    listen 80;
    server_name gitea.msadb.cn;
    
    #listen 443 ssl;
    #ssl_certificate /usr/local/nginx/ssl/nmsc-tp.pem;
    #ssl_certificate_key /usr/local/nginx/ssl/nmsc-tp.key;

    location / {
         proxy_pass http://127.0.0.1:3000;
         proxy_set_header Host $host;
         proxy_set_header X-Real-IP $remote_addr;
         root /usr/local/nginx/html/nmsc/nmsc-tp;
    }
    
    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht {
        deny all;
    }
}
```

# 错误汇总

## 文件上传错误

```ini
# php.ini
file_uploads = On
# 文件上传的路径
upload_tmp_dir =/tmp 
# 文件上传的大小
upload_max_filesize = 50M
max_file_uploads = 20
```

```bash
systemctl restart php80.service
```



## 备注

https://modao.cc/app/a9iWROjrq1suskYpWrqFL #农贸市场销售子系统-分享  密码: y55whh



食品经营许可证编号是什么?

根据《食品经营许可管理办法》第二十四条的规定、食品马许可证编号由JY(“经营”的汉语拼音字母缩写)和14位阿拉伯数组成。数字从左至右依次为:

1位主体业态代码、2位省(自治区、直辖市）代码、2位市(地)代码、2位县(区)代码、6位顺序码、1位校验码。

如上面链接中显示的食品经营许可证号码：JY14406060934587
JY代表的是经营，是经营类的许可证。
1代表的是这是销售类的如档口，注，如果是2代表的是餐馆类的。
后6位440606代表的是广东省佛山市顺德区。
093458代表的是顺序码。
最后一位7代表的是校验码。但具体如何校验，我暂时也忘记了。至时有需要时再找找。



# 议论问题

> 入驻时候 添加一个【超级管理员】  

这个【超级管理员】 可以新增 【子运营人员】（身份 同超级管理员）



> 配送入驻

1、先油入驻助手 



> 短信服务商



> 轮播图模块可以关闭



> 常用推荐

根据当前用户常卖的得商品进行推荐

小程序登录流程

1、使用code获取到用户的手机号码

2、在通过登录的方式，code + 手机号进行登录，获取openid，微信用户的账号id （后面支付需要用到）

3、将 openai 与手机号进行绑定











支付流程

1、【支付】获取订单

2、【支付订单详情页面】用户支付

3、【支付结果】查询支付结果



微信登录返回结果

```
errcode: 0
errmsg: "ok"
phone_info: {phoneNumber: "18388112576", purePhoneNumber: "18388112576", countryCode: "86",…}
countryCode: "86"
phoneNumber: "18388112576"
purePhoneNumber: "18388112576"
watermark: {timestamp: 1684472462, appid: "wxe41cc4a21e9e22d0"}
appid: "wxe41cc4a21e9e22d0"
timestamp: 1684472462
```



```
"return_code" => "SUCCESS"
  "return_msg" => "OK"
  "result_code" => "SUCCESS"
  "mch_id" => "1542303231"
  "appid" => "wxe41cc4a21e9e22d0"
  "nonce_str" => "GvkTO8Mb5WhQvZda"
  "sign" => "A6FC0C66045867A810D6A9C5BA86B636"
  "prepay_id" => "wx1915472980601784846828c6e21d330000"
  "trade_type" => "JSAPI"
```



















